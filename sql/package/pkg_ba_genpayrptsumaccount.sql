prompt
prompt Creating package BA.PKG_BA_GENPAYRPTSUMACCOUNT
prompt ===========================================
prompt
CREATE OR REPLACE Package BA.PKG_BA_genPayRPTSUMAccount
/********************************************************************************
    PROJECT:         BLI-BaWeb 勞保年金給付系統
    NAME:            PKG_BA_genPayRPTSUMAccount
    PURPOSE:         產生月核付撥付報表

    PARAMETER(IN):

    PARAMETER(OUT):

    USAGE:
    I/O   (Type)Object Name
    ----  -----------------------------------------------------------------------

    REVISIONS:
    Ver   Date        Author       Description
    ----  ----------  -----------  ----------------------------------------------
    1.0   2012/03/20  ChungYu Wu    Created this Package.

    NOTES:
    1.各 Procedure 所需傳入資料請參考 Package Body 中各 Procedure 的註解說明。

********************************************************************************/
 is
    v_g_ProgName             varChar2(200);
    v_g_errMsg               varChar2(4000);
    v_g_genFlag              Number;
    v_g_flag                 varchar2(1);
    /********************************************************************************
    事故者扣減資料(勞貸、另案扣減(同類保險)、另案扣減(非年金保險))
    ********************************************************************************/
    TYPE TYP_REC_DEDUCT IS RECORD(
        EVTOFFSETAMT  BAPAYRPTSUM.PAYAMT%TYPE,    --  事故者本次扣減勞貸金額
        EVTOTHERAAMT  BAPAYRPTSUM.PAYAMT%TYPE,    --  事故者另案扣減(同類保險)金額
        EVTOTHERBAMT  BAPAYRPTSUM.PAYAMT%TYPE     --  事故者另案扣減(非年金保險)金額
    );

    Procedure sp_BA_genPaySUMRPT_1_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_1_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_1_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_1_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_mtestmk             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_1_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_1_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_mtestmk             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_5 (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_5_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_5_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_5_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_6 (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_6_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_6_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_6_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_7_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_7_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_7_K(
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_7_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_7_S(
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_7_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_8_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_8_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_8_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_8_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_8_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_8_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_12_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_12_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_12_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_12_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_12_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_12_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_13_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_13_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_13_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_13_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_13_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_13_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_14_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_14_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_14_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_14_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_14_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_14_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_15_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_15_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_15_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_15_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPaySUMRPT_15_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_15_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    );
    Procedure sp_BA_genPaySUMRPT_16_L (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_16_L (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_16_K(
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_16_K (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_16_S(
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_16_S (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    );
     Procedure sp_BA_genPaySUMRPT_17_L (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_17_L (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_17_K(
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_17_K (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_17_S(
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_17_S (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPaySUMRPT_19_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    Procedure sp_BA_genPayACCOUNTRPT_19_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    );

    function fn_BA_transIssuTypSTR
    (
        v_IssuTyp               in      varChar2
    ) return varchar2;

    function fn_BA_transNAChgTypSTR
    (
        v_NAChgTyp              in      varChar2
    ) return varchar2;
End;
/

prompt
prompt Creating package body BA.PKG_BA_GENPAYRPTSUMACCOUNT
prompt ================================================
prompt
CREATE OR REPLACE Package Body BA.PKG_BA_genPayRPTSUMAccount
is

 /* \********************************************************************************
       事故者扣減資料(勞貸、另案扣減(同類保險)、另案扣減(非年金保險))
  ********************************************************************************\
  TYPE TYP_REC_DEDUCT IS RECORD(
       EVTOFFSETAMT  BAPAYRPTSUM.PAYAMT%TYPE,    --  事故者本次扣減勞貸金額
       EVTOTHERAAMT  BAPAYRPTSUM.PAYAMT%TYPE,    --  事故者另案扣減(同類保險)金額
       EVTOTHERBAMT  BAPAYRPTSUM.PAYAMT%TYPE     --  事故者另案扣減(非年金保險)金額
  );*/

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_1_L
        PURPOSE:         產生月核定撥付總表(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_updflag       (varChar2)       --是否回押註記
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_1_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                     -- 應付金額
        v_count    NUMBER                       := 0;                     -- 筆數

        --月核定撥付總表(老年)
        Cursor c_dataCur_SUMrpt1 is
            SELECT DECODE(T.ISSUTYP,'4',(SELECT COUNT(DISTINCT T1.APNO)
                                           FROM BAPAYRPTRECORD T1
                                          WHERE T1.RPTTYP = '1'
                                            AND T1.ISSUTYP = '4'
                                            AND T1.ISSUYM = v_i_issuym
                                            AND T1.APNO LIKE (v_i_paycode || '%')
                                            AND T1.CHKDATE = v_i_chkdate
                                            AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                            AND T1.BENEVTREL NOT IN ('F', 'N', 'Z')
                                            AND T1.PAYTYP = T.PAYTYP
                                            AND T1.APNO NOT IN (SELECT DISTINCT T2.APNO
                                                                  FROM BAPAYRPTRECORD T2
                                                                 WHERE T2.RPTTYP = '1'
                                                                   AND T2.ISSUTYP = '4'
                                                                   AND T2.ISSUYM = v_i_issuym
                                                                   AND T2.APNO LIKE (v_i_paycode || '%')
                                                                   AND T2.CHKDATE = v_i_chkdate
                                                                   AND T2.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                                   AND T2.BENEVTREL NOT IN ('F', 'N', 'Z')
                                                                   AND T2.PAYTYP < T.PAYTYP)),
                                         COUNT(DISTINCT T.APNO)) AS APNOAMT,         --件數  2012/07/16 Modify By ChungYu 詹小姐重新定義件數，
                                                                                     --      若該筆受理編號已於其他給付方式呈現過，則於後續給
                                                                                     --      付方式再次呈現時不納入統計。
                                         COUNT(*) AS DATAAMT,                        --筆數
                 --  COUNT(DISTINCT APNO)   AS APNOAMT,                         --件數
                 --  COUNT(*) AS DATAAMT,                                       --筆數
                   NVL(SUM(T.ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   NVL(SUM(T.OTHERAAMT), 0) AS OTHERAAMT,                       --另案扣減同保險(B)
                   NVL(SUM(T.OTHERBAMT), 0) AS OTHERBAMT,                       --另案扣減他保險(C)
                   NVL(SUM(T.MITRATE), 0)   AS MITRATE,                         --匯費(D)
                   NVL(SUM(T.OFFSETAMT), 0) AS OFFSETAMT,                       --抵銷紓困(E)
                   NVL(SUM(T.COMPENAMT), 0) AS COMPENAMT,                       --代扣補償金(F)
                   NVL(SUM(T.INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   NVL(SUM(T.ITRTTAX), 0)  AS ITRTTAX,                          --代扣利息所得稅(H)
                   NVL(SUM(T.OTHERAMT), 0) AS OTHERAMT,                         --其他(I)
                   T.ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                                --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                                --(1~5；依照給付核定檔月核案件類別)
                   T.PAYTYP,                                                    --給付方式
                   T.CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   T.CPRNDATE,                                                  --
                   T.RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   T.PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD T
             WHERE T.RPTTYP = '1'
               AND T.ISSUYM = v_i_issuym
               AND T.APNO LIKE (v_i_paycode||'%')
               AND T.CHKDATE = v_i_chkdate
               AND T.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T.BENEVTREL NOT IN ('F','N','Z')
          GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP, PAYSEQNO
          ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP, PAYSEQNO;

        --月核定撥付總表(補償金資料) 僅有老年
        Cursor c_dataCur_SUMrptZ1 is
            SELECT COUNT(DISTINCT APNO)   AS APNOAMT,                         --件數
                   COUNT(*) AS DATAAMT,                                       --筆數
                   NVL(SUM(ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   NVL(SUM(OTHERAAMT), 0) AS OTHERAAMT,                       --另案扣減同保險(B)
                   NVL(SUM(OTHERBAMT), 0) AS OTHERBAMT,                       --另案扣減他保險(C)
                   NVL(SUM(MITRATE), 0)   AS MITRATE,                         --匯費(D)
                   NVL(SUM(OFFSETAMT), 0) AS OFFSETAMT,                       --抵銷紓困(E)
                   NVL(SUM(COMPENAMT), 0) AS COMPENAMT,                       --代扣補償金(F)
                   NVL(SUM(INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   NVL(SUM(ITRTTAX), 0)  AS ITRTTAX,                          --代扣利息所得稅(H)
                   NVL(SUM(OTHERAMT), 0) AS OTHERAMT,                         --其他(I)
                   ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                              --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                              --(1~5；依照給付核定檔月核案件類別)
                   PAYTYP,                                                    --給付方式
                   CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   CPRNDATE,                                                  --
                   RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND BENEVTREL = 'Z'
             GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP, PAYSEQNO
             ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP, PAYSEQNO;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_1_L';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --月核定撥付總表資料(老年)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                v_count := 0;
                --v_payamt := 0;                              --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)

                v_payamt := v_dataSUMCur1.ISSUEAMT          --  核定金額(A)
                          - v_dataSUMCur1.OTHERAAMT         --  另案扣減(同類保險)金額(B)
                          - v_dataSUMCur1.OTHERBAMT         --  另案扣減(他類保險)金額(C)
                          - v_dataSUMCur1.MITRATE           --  匯款匯費(D)
                          - v_dataSUMCur1.OFFSETAMT         --  抵銷紓困費用(E)
                          - v_dataSUMCur1.COMPENAMT         --  代扣補償金(F)
                          - v_dataSUMCur1.INHERITORAMT      --  保留遺屬津貼(G)
                          - v_dataSUMCur1.ITRTTAX           --  代扣利息所得稅(H)
                          - v_dataSUMCur1.OTHERAMT;         --  其他費用(I)

                v_g_genFlag := 1;

                If v_dataSUMCur1.ISSUTYP = '4' Then
                    --    筆數  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數，
                    --    若該筆受理編號該給付年月已於其他給付方式呈現過，則於後續給
                    --    付方式再次呈現時不納入統計。
                    SELECT COUNT(APNO) Into v_count
                      FROM (SELECT T3.APNO
                              FROM BAPAYRPTRECORD T3
                             WHERE T3.RPTTYP = '1'
                               AND T3.ISSUTYP = '4'
                               AND T3.ISSUYM = v_i_issuym
                               AND T3.APNO LIKE (v_i_paycode || '%')
                               AND T3.CHKDATE = v_i_chkdate
                               AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                               AND T3.BENEVTREL NOT IN ('F', 'N', 'Z')
                               AND T3.PAYTYP = v_dataSUMCur1.PAYTYP
                               AND T3.APNO NOT IN (SELECT T4.APNO
                                                     FROM BAPAYRPTRECORD T4
                                                    WHERE T4.RPTTYP = '1'
                                                      AND T4.ISSUTYP = '4'
                                                      AND T4.ISSUYM = v_i_issuym
                                                      AND T4.APNO LIKE (v_i_paycode || '%')
                                                      AND T4.CHKDATE = v_i_chkdate
                                                      AND T4.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                      AND T4.APNO = T3.APNO
                                                      AND T4.PAYYM = T3.PAYYM
                                                      AND T4.BENEVTREL NOT IN ('F', 'N', 'Z')
                                                      AND T4.PAYTYP < v_dataSUMCur1.PAYTYP)
                            GROUP BY T3.APNO, T3.PAYYM);
                else
                    v_count := v_dataSUMCur1.DATAAMT;
                End if;

                --寫入月核定撥付總表資料(老年)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         --,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur1.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur1.PAYTYP
                                       --,''PAYDATE
                                         ,v_dataSUMCur1.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur1.ISSUTYP
                                      -- ,CASETYP
                                         ,v_i_issuym
                                         ,''
                                         ,v_dataSUMCur1.APNOAMT
                                         ,v_count
                                         ,v_dataSUMCur1.ISSUEAMT
                                         ,v_dataSUMCur1.OTHERAAMT
                                         ,v_dataSUMCur1.OTHERBAMT
                                         ,v_dataSUMCur1.MITRATE
                                         ,v_dataSUMCur1.OFFSETAMT
                                         ,v_dataSUMCur1.COMPENAMT
                                         ,v_dataSUMCur1.INHERITORAMT
                                         ,v_dataSUMCur1.ITRTTAX
                                         ,v_dataSUMCur1.OTHERAMT
                                         ,v_payamt
                                         ,v_i_payseqno
                                         ,Decode(v_dataSUMCur1.RPTTYP,'1',fn_BA_transIssuTypSTR(v_dataSUMCur1.ISSUTYP),'')   --備註
                                         --,''  --普職互改註記
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;

            --月核定撥付總表資料(補償金資料)
            for v_dataSUMCurZ1 in c_dataCur_SUMrptZ1 Loop
                     v_count   := 0;
         --            v_payamt := 0;                              -- 計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)
                     v_payamt := v_dataSUMCurZ1.ISSUEAMT          --  核定金額(A)
                                 - v_dataSUMCurZ1.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                                 - v_dataSUMCurZ1.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                                 - v_dataSUMCurZ1.MITRATE         --  匯款匯費(D)
                                 - v_dataSUMCurZ1.OFFSETAMT       --  抵銷紓困費用(E)
                                 - v_dataSUMCurZ1.COMPENAMT       --  代扣補償金(F)
                                 - v_dataSUMCurZ1.INHERITORAMT    --  保留遺屬津貼(G)
                                 - v_dataSUMCurZ1.ITRTTAX         --  代扣利息所得稅(H)
                                 - v_dataSUMCurZ1.OTHERAMT;       --  其他費用(I)

                     v_g_genFlag := 1;

                  If v_dataSUMCurZ1.ISSUTYP = '4' Then
                     --    筆數  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數，
                     --    若該筆受理編號該給付年月已於其他給付方式呈現過，則於後續給
                     --    付方式再次呈現時不納入統計。
                    SELECT COUNT(APNO) Into v_count
                      FROM (SELECT T3.APNO
                              FROM BAPAYRPTRECORD T3
                             WHERE T3.RPTTYP = '1'
                               AND T3.ISSUTYP = '4'
                               AND T3.ISSUYM = v_i_issuym
                               AND T3.APNO LIKE (v_i_paycode || '%')
                               AND T3.CHKDATE = v_i_chkdate
                               AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                               AND T3.BENEVTREL = 'Z'
                               AND T3.PAYTYP = v_dataSUMCurZ1.PAYTYP
                               AND T3.APNO NOT IN (SELECT T4.APNO
                                                     FROM BAPAYRPTRECORD T4
                                                    WHERE T4.RPTTYP = '1'
                                                      AND T4.ISSUTYP = '4'
                                                      AND T4.ISSUYM = v_i_issuym
                                                      AND T4.APNO LIKE (v_i_paycode || '%')
                                                      AND T4.CHKDATE = v_i_chkdate
                                                      AND T4.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                      AND T4.APNO = T3.APNO
                                                      AND T4.PAYYM = T3.PAYYM
                                                      AND T4.BENEVTREL = 'Z'
                                                      AND T4.PAYTYP < v_dataSUMCurZ1.PAYTYP)
                            GROUP BY T3.APNO, T3.PAYYM);
                  else
                    v_count := v_dataSUMCurZ1.DATAAMT;
                  End if;

                   --寫入月核定撥付總表資料(補償金資料)
                   insert into BAPAYRPTSUM ( RPTTYP
                                            ,CPRNDATE
                                            ,PAYTYP
                                            ,CHKDATE
                                            ,PAYCODE
                                            ,ISSUTYP
                                            ,ISSUYM
                                            ,BENEVTREL
                                            ,APNOAMT
                                            ,DATAAMT
                                            ,ISSUEAMT
                                            ,OTHERAAMT
                                            ,OTHERBAMT
                                            ,MITRATE
                                            ,OFFSETAMT
                                            ,COMPENAMT
                                            ,INHERITORAMT
                                            ,ITRTTAX
                                            ,OTHERAMT
                                            ,PAYAMT
                                            ,PAYSEQNO
                                            ,RPTNOTE
                                            --,NACHGMK
                                            ,PROCTIME
                                   ) values (
                                             v_dataSUMCurZ1.RPTTYP
                                            ,v_i_cprndt
                                            ,v_dataSUMCurZ1.PAYTYP
                                            ,v_dataSUMCurZ1.CHKDATE
                                            ,v_i_paycode
                                            ,v_dataSUMCurZ1.ISSUTYP
                                            ,v_i_issuym
                                            ,'Z'
                                            ,v_dataSUMCurZ1.APNOAMT
                                            ,v_count
                                            ,v_dataSUMCurZ1.ISSUEAMT
                                            ,v_dataSUMCurZ1.OTHERAAMT
                                            ,v_dataSUMCurZ1.OTHERBAMT
                                            ,v_dataSUMCurZ1.MITRATE
                                            ,v_dataSUMCurZ1.OFFSETAMT
                                            ,v_dataSUMCurZ1.COMPENAMT
                                            ,v_dataSUMCurZ1.INHERITORAMT
                                            ,v_dataSUMCurZ1.ITRTTAX
                                            ,v_dataSUMCurZ1.OTHERAMT
                                            ,v_payamt
                                            ,v_i_payseqno
                                            ,Decode(v_dataSUMCurZ1.RPTTYP,'1',fn_BA_transIssuTypSTR(v_dataSUMCurZ1.ISSUTYP),'')  --備註
                                            --,''  --普職互改註記
                                            ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                   );
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表(老年)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '月核定撥付總表(老年)資料處理完成['||v_i_paycode||']',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'1',
               '月核定撥付總表(老年)資料處理完成['||v_i_paycode||']',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genSUMPayRPT_1 End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_1_L
        PURPOSE:         產生月核定撥付總表會計科目(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_1_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;
        v_PAYTYP           BAPAYRPTACCOUNT.PAYTYP%TYPE         := '';
        v_BENEVTREL        BAPAYRPTACCOUNT.BENEVTREL%TYPE      := '';

        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

        --月核定撥付總表(老年)
        Cursor c_dataCur_SUMrpt1 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,               -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,                 -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,              -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,              -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,                -- 匯款匯費
                   PAYTYP,
                   NVL(SUM(COMPENAMT), 0) AS COMPENAMT                --代扣補償金   add by 20121029 Angela
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND (trim(BENEVTREL) IS NULL Or BENEVTREL <> 'Z')
             GROUP BY PAYTYP
             ORDER BY PAYTYP;

        --月核定撥付總表(補償金資料) 僅有老年
        Cursor c_dataCur_SUMrptZ1 is
             SELECT NVL(SUM(ISSUEAMT), 0)  AS ISSUEAMT,               -- 核定金額
                    NVL(SUM(PAYAMT), 0)     AS PAYAMT,                -- 應付金額
                    NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,             -- 另案扣減他保險
                    NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,             -- 抵銷紓困
                    PAYTYP
               FROM BAPAYRPTSUM
              WHERE RPTTYP = '1'
                AND ISSUYM = v_i_issuym
                AND PAYCODE = v_i_paycode
                AND CHKDATE = v_i_chkdate
                AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
                AND BENEVTREL = 'Z'
              GROUP BY PAYTYP
              ORDER BY PAYTYP;

         --其他應收款(另案扣減同保險)
         Cursor c_dataCur_OTHERAAMT is
                SELECT SUBSTR(T1.MAPNO, 1, 1) AS MPAYTYP,
                       DISPAYKIND,
                       MNLWKMK,
                       MADWKMK,
                       SUM(T1.DISAMT) AS DISAMT
                  FROM BACUTREC T1, (SELECT T21.APNO,
                                            T21.ISSUYM,
                                            T21.PAYYM,
                                            T21.PAYKIND
                                       FROM BAPAYRPTRECORD T21
                                      WHERE T21.RPTTYP = '1'
                                        AND T21.APNO LIKE (v_i_paycode||'%')
                                        AND T21.ISSUYM = v_i_issuym
                                        AND CHKDATE = v_i_chkdate
                                        AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                        AND T21.PAYTYP = v_PAYTYP
                                        AND T21.OTHERAAMT > 0) T2
                 WHERE T1.APNO LIKE (v_i_paycode||'%')
                   AND T1.ISSUYM = v_i_issuym
                   AND T1.MTESTMK = 'F'
                   AND T1.APNO = T2.APNO
                   AND T1.APNO = T2.APNO
                   AND T1.ISSUYM = T2.ISSUYM
                   AND T1.PAYYM = T2.PAYYM
                   AND T1.PAYKIND = T2.PAYKIND
                 GROUP BY SUBSTR(T1.MAPNO, 1, 1), DISPAYKIND, MNLWKMK, MADWKMK
                 ORDER BY SUBSTR(T1.MAPNO, 1, 1), DISPAYKIND, MNLWKMK, MADWKMK;

         --應付代收款(補償金資料)(老年)
         Cursor c_dataCur_COMP is
               SELECT DECODE(BENEVTREL, '1', NVL(SUM(COMPENAMT),0), 'Z', NVL(SUM(ISSUEAMT),0)) AS COMPENAMT
                     ,COMPID1
                     ,COMPNAME1
                FROM BAPAYRPTRECORD
               WHERE RPTTYP = '1'
                 AND ISSUYM = v_i_issuym
                 AND CHKDATE = v_i_chkdate
                 AND APNO LIKE (v_i_paycode||'%')
                 AND PAYTYP = v_PAYTYP
                 AND COMPID1 IS NOT NULL
                 AND BENEVTREL = v_BENEVTREL
               GROUP BY COMPID1,COMPNAME1,BENEVTREL
               ORDER BY COMPID1;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_1_L';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --月核定撥付總表資料(老年)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                  v_count          := 0;
                  v_g_genFlag      := 1;
                  v_ACCOUNTSEQ     := null;
                  v_ACCOUNTNO      := '';
                  v_ACCOUNTNAME    := '';

                  --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                for i in 1..5 LOOP
--                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ     := 1;

                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    if i = 1 then
                       v_ACCOUNTSEQ     := 0;
                       v_ACCOUNTNO      := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_ACCOUNTNAME    := '保險給付－普通－老年給付（年金）';
                       v_tmpAMT         := v_dataSUMCur1.ISSUEAMT;

                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       if (v_dataSUMCur1.Paytyp = '4') then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ABA';
                       v_DATACD             := '1';
                       v_DECIDEAMT          := v_dataSUMCur1.ISSUEAMT-v_dataSUMCur1.OTHERBAMT
                                              -v_dataSUMCur1.OFFSETAMT-v_dataSUMCur1.MITRATE
                                              -v_dataSUMCur1.COMPENAMT;
                       v_CASHAMT            := v_dataSUMCur1.PAYAMT;
                       v_CUTAMT             := 0;
                       v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_dataSUMCur1.Paytyp
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1');
                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       if (v_dataSUMCur1.Paytyp = '4') then
                           v_ACCOUNTNO      := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_ACCOUNTNAME    := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;
                       v_tmpAMT         := v_dataSUMCur1.PAYAMT;

                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 3 then
                       v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（另案扣減他保險）';
                       v_tmpAMT        := v_dataSUMCur1.OTHERBAMT;

                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '另案扣減他保險';
                       v_OPPACCOUNTNO   := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_OPPACCOUNTNAME := '保險給付－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'ABA';
                       v_DATACD         := 'A';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := v_tmpAMT;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '9';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 4 then
                       v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（紓困）';
                       v_tmpAMT         := v_dataSUMCur1.OFFSETAMT;

                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '紓困';
                       v_OPPACCOUNTNO   := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_OPPACCOUNTNAME := '保險給付－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'ABA';
                       v_DATACD         := 'F';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := v_tmpAMT;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '3';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 5 then
                       v_ACCOUNTNO      := '';
                       v_ACCOUNTNAME    := '';
                       v_tmpAMT         := 0;

                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                       if (v_dataSUMCur1.Paytyp = '5' or v_dataSUMCur1.Paytyp = '6') then
                           v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（國外匯款之手續費）';
                           v_tmpAMT         := v_dataSUMCur1.MITRATE;

                           --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '國外匯款之手續費';
                           v_OPPACCOUNTNO   := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                           v_OPPACCOUNTNAME := '保險給付－普通－老年給付（年金）';
                           v_ACTTITLEAPCODE := 'ABA';
                           v_DATACD         := 'H';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := v_tmpAMT;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := 'H';
                           v_CNT            := 0;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->
                       end if;
                    end if;

                    --寫入月核定撥付總表會計科目資料(借：保險給付，貸：銀行存款)(老年)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121029
                                                    ,OPPACCOUNTNO      --add by Angela 20121029
                                                    ,OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,DATACD            --add by Angela 20121029
                                                    ,DECIDEAMT         --add by Angela 20121029
                                                    ,CASHAMT           --add by Angela 20121029
                                                    ,CUTAMT            --add by Angela 20121029
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,CNT               --add by Angela 20121029
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values ( '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                     ,v_DATACD            --add by Angela 20121029
                                                     ,v_DECIDEAMT         --add by Angela 20121029
                                                     ,v_CASHAMT           --add by Angela 20121029
                                                     ,v_CUTAMT            --add by Angela 20121029
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                     ,v_CNT               --add by Angela 20121029
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --寫入月核定撥付總表會計科目資料(貸：其他應收款)(老年)
                v_PAYTYP := v_dataSUMCur1.PAYTYP;
                v_BENEVTREL := '1';
                for v_dataCur_OTHERAAMT in c_dataCur_OTHERAAMT Loop
                    v_ACCOUNTSEQ     := 1;
                    v_tmpAMT         := v_dataCur_OTHERAAMT.Disamt;
         --           v_count          := v_count + 1;
                    v_ACCOUNTNAME    := '其他應收款－';

                    if v_dataCur_OTHERAAMT.Mpaytyp = 'L' then
                       v_ACCOUNTNO      := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－老年給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '1' or trim(v_dataCur_OTHERAAMT.Mnlwkmk) is null) and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO     := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO      := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'職災－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO      := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'加職－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO      := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'職災－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO      := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'加職－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '1' or trim(v_dataCur_OTHERAAMT.Mnlwkmk) is null)  then
                           v_ACCOUNTNO      := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  then
                           v_ACCOUNTNO      := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'職災－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  then
                           v_ACCOUNTNO      := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME    := v_ACCOUNTNAME||'加職－本人死亡給付（遺屬年金）';
                    end if;

                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;
                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    if v_tmpAMT > 0 then
                        v_count       := v_count + 1;
                        insert into BAPAYRPTACCOUNT( RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121029
                                                    ,OPPACCOUNTNO      --add by Angela 20121029
                                                    ,OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,DATACD            --add by Angela 20121029
                                                    ,DECIDEAMT         --add by Angela 20121029
                                                    ,CASHAMT           --add by Angela 20121029
                                                    ,CUTAMT            --add by Angela 20121029
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,CNT               --add by Angela 20121029
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values ( '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                     ,v_DATACD            --add by Angela 20121029
                                                     ,v_DECIDEAMT         --add by Angela 20121029
                                                     ,v_CASHAMT           --add by Angela 20121029
                                                     ,v_CUTAMT            --add by Angela 20121029
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                     ,v_CNT               --add by Angela 20121029
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --寫入月核定撥付總表會計科目資料(貸：應付代收款)(老年)
                for v_dataCur_COMP in c_dataCur_COMP Loop
                    v_ACCOUNTSEQ     := 1;
                    v_ACCOUNTNO      := '212312  12'||v_dataCur_COMP.COMPID1;  --Modify by Angela 20141225 配合104年會計科目轉換(原：214512  12)
                    v_ACCOUNTNAME    := '應付代收款－代扣補償金－'||v_dataCur_COMP.COMPNAME1;
                    v_tmpAMT         := v_dataCur_COMP.Compenamt;
                    v_count          := v_count + 1;

                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                    v_OPPACCOUNTNAME := '保險給付－普通－老年給付（年金）';
                    v_ACTTITLEAPCODE := 'ABD';
                    v_DATACD         := '6';
                    v_DECIDEAMT      := v_tmpAMT;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := v_dataSUMCur1.PAYTYP;
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'Y';
                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121029
                                                    ,OPPACCOUNTNO      --add by Angela 20121029
                                                    ,OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,DATACD            --add by Angela 20121029
                                                    ,DECIDEAMT         --add by Angela 20121029
                                                    ,CASHAMT           --add by Angela 20121029
                                                    ,CUTAMT            --add by Angela 20121029
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,CNT               --add by Angela 20121029
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values ( '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                     ,v_DATACD            --add by Angela 20121029
                                                     ,v_DECIDEAMT         --add by Angela 20121029
                                                     ,v_CASHAMT           --add by Angela 20121029
                                                     ,v_CUTAMT            --add by Angela 20121029
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                     ,v_CNT               --add by Angela 20121029
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;
            end Loop;

            --月核定撥付總表資料(補償金資料)(老年)
            for v_dataSUMCurZ1 in c_dataCur_SUMrptZ1 Loop
                v_count          := 0;
                v_g_genFlag      := 1;
                v_ACCOUNTNO      := '';
                v_ACCOUNTNAME    := '';
                v_PAYTYP         := v_dataSUMCurZ1.PAYTYP;
                v_BENEVTREL      := 'Z';

                --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                for v_dataCur_COMP in c_dataCur_COMP Loop
                    v_ACCOUNTSEQ     := 0;
                    v_ACCOUNTNO      := '212312  12'||v_dataCur_COMP.COMPID1;  --Modify by Angela 20141225 配合104年會計科目轉換(原：214512  12)
                    v_ACCOUNTNAME    := '應付代收款－代扣補償金－'||v_dataCur_COMP.COMPNAME1;
                    v_tmpAMT         := v_dataCur_COMP.Compenamt;
                    v_count          := v_count + 1;

                    /*--add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    if (v_dataSUMCurZ1.PAYTYP = '4') then
                        v_OPPACCOUNTNO      := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME    := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE := 'DZD';
                    v_DATACD         := '6';
                    v_DECIDEAMT      := v_tmpAMT;
                    v_CASHAMT        := v_tmpAMT;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := v_dataSUMCurZ1.PAYTYP;

                    select nvl(Sum(t.APNOAMT),0) into v_CNT
                      from BAPAYRPTSUM t
                     where t.RPTTYP = '1'
                       and t.ISSUYM = v_i_issuym
                       and t.PAYCODE = v_i_paycode
                       and t.CHKDATE = v_i_chkdate
                       and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                       and t.PAYSEQNO = v_i_payseqno
                       and nvl(t.PAYTYP,' ') = v_dataSUMCurZ1.Paytyp
                       and t.BENEVTREL = v_BENEVTREL
                       and v_count = 1;
                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->*/

                    --add by Angela 20121128 回寫PFM&PFD時所需資訊 Start-->
                    --此段不回寫PFM&PFD(將回寫資訊清空)
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121128 回寫PFM&PFD時所需資訊 End-->

                    --寫入月核定撥付總表(補償金資料)會計科目資料(借：保險給付，貸：銀行存款)(老年)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121029
                                                    ,OPPACCOUNTNO      --add by Angela 20121029
                                                    ,OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,DATACD            --add by Angela 20121029
                                                    ,DECIDEAMT         --add by Angela 20121029
                                                    ,CASHAMT           --add by Angela 20121029
                                                    ,CUTAMT            --add by Angela 20121029
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,CNT               --add by Angela 20121029
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCurZ1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,'Z'
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                     ,v_DATACD            --add by Angela 20121029
                                                     ,v_DECIDEAMT         --add by Angela 20121029
                                                     ,v_CASHAMT           --add by Angela 20121029
                                                     ,v_CUTAMT            --add by Angela 20121029
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                     ,v_CNT               --add by Angela 20121029
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶';
                v_tmpAMT         := v_dataSUMCurZ1.Issueamt;

                --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                --此段不回寫PFM&PFD(將回寫資訊清空)
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                v_count          := v_count + 1;
                v_ACCOUNTSEQ     := 1;

                --寫入月核定撥付總表(補償金資料)會計科目資料(借：保險給付，貸：銀行存款)(老年)
                if v_tmpAMT > 0 then
                    insert into BAPAYRPTACCOUNT( RPTTYP
                                                ,CPRNDATE
                                                ,PAYCODE
                                                ,ISSUYM
                                                ,PAYTYP
                                                ,CHKDATE
                                                ,BENEVTREL
                                                ,ACCOUNTSEQ
                                                ,SEQNO
                                                ,ACCOUNTNO
                                                ,ACCOUNTNAME
                                                ,PAYAMT
                                                ,PAYSEQNO
                                                --,NACHGMK
                                                ,PROCTIME
                                                ,ACCOUNTMEMO       --add by Angela 20121029
                                                ,OPPACCOUNTNO      --add by Angela 20121029
                                                ,OPPACCOUNTNAME    --add by Angela 20121029
                                                ,ACTTITLEAPCODE    --add by Angela 20121029
                                                ,DATACD            --add by Angela 20121029
                                                ,DECIDEAMT         --add by Angela 20121029
                                                ,CASHAMT           --add by Angela 20121029
                                                ,CUTAMT            --add by Angela 20121029
                                                ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                ,CNT               --add by Angela 20121029
                                                ,ACCOUNTTOPFMK     --add by Angela 20130731
                                      ) values (  '1'
                                                 ,v_i_cprndt
                                                 ,v_i_paycode
                                                 ,v_i_issuym
                                                 ,v_dataSUMCurZ1.PAYTYP
                                                 ,v_i_chkdate
                                                 ,'Z'
                                                 ,v_ACCOUNTSEQ
                                                 ,v_count
                                                 ,v_ACCOUNTNO
                                                 ,v_ACCOUNTNAME
                                                 ,v_tmpAMT
                                                 ,v_i_payseqno
                                                 --,''--NACHGMK
                                                 ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                 ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                 ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                 ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                 ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                 ,v_DATACD            --add by Angela 20121029
                                                 ,v_DECIDEAMT         --add by Angela 20121029
                                                 ,v_CASHAMT           --add by Angela 20121029
                                                 ,v_CUTAMT            --add by Angela 20121029
                                                 ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                 ,v_CNT               --add by Angela 20121029
                                                 ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                       );
                end if;
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '月核定撥付總表會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_1_L End

   /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_1_K
        PURPOSE:         產生月核定撥付總表(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_updflag       (varChar2)       --是否回押註記
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_1_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

          v_payamt                    BAPAYRPTSUM.PAYAMT%TYPE      := 0;     -- 應付金額
          v_Count                     NUMBER      := 0;                      -- 筆數
          v_PayymCount                NUMBER      := 0;                      -- 給付年月核發筆數
          v_BAPAYRPTSUM                           BAPAYRPTSUM%ROWTYPE;       -- 普職互改各類案件彙總資料
          v_BAPAYRPTSUM9                          BAPAYRPTSUM%ROWTYPE;       -- 普職互改衝抵
          v_PreIssuAmt                NUMBER      := 0;                      -- 前次核定金額
          v_DisAmt                    NUMBER      := 0;                      -- 扣減金額


        --月核定撥付總表(失能)
        Cursor c_dataCur_SUMrpt1 is
            SELECT DECODE(T.ISSUTYP,'4',(SELECT COUNT(DISTINCT T1.APNO)
                                           FROM BAPAYRPTRECORD T1
                                          WHERE T1.RPTTYP = '1'
                                            AND T1.ISSUTYP = '4'
                                            AND T1.ISSUYM = v_i_issuym
                                            AND T1.APNO LIKE (v_i_paycode || '%')
                                            AND T1.CHKDATE = v_i_chkdate
                                            AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                            AND T1.BENEVTREL NOT IN ('F', 'N', 'Z')
                                            AND T1.PAYTYP = T.PAYTYP
                                            AND T1.NLWKMK = T.NLWKMK
                                            AND T1.ADWKMK = T.ADWKMK
                                            AND T1.APNO NOT IN (SELECT DISTINCT T2.APNO
                                                                  FROM BAPAYRPTRECORD T2
                                                                 WHERE T2.RPTTYP = '1'
                                                                   AND T2.ISSUTYP = '4'
                                                                   AND T2.ISSUYM = v_i_issuym
                                                                   AND T2.APNO LIKE (v_i_paycode || '%')
                                                                   AND T2.CHKDATE = v_i_chkdate
                                                                   AND T2.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                                   AND T2.BENEVTREL NOT IN ('F', 'N', 'Z')
                                                                   AND T2.PAYTYP < T.PAYTYP
                                                                   AND T2.NLWKMK = T.NLWKMK
                                                                   AND T2.ADWKMK = T.ADWKMK)),
                                         COUNT(DISTINCT T.APNO)) AS APNOAMT,         --件數  2012/07/16 Modify By ChungYu 詹小姐重新定義件數，
                                                                                     --      若該筆受理編號已於其他給付方式呈現過，則於後續給
                                                                                     --      付方式再次呈現時不納入統計。

                                     COUNT(*) AS DATAAMT,                        --筆數  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數
                                                                                 --      於死亡結案時若該筆受理編號相同給付年月僅計算一筆，
                                                                                 --      死亡結案筆數計算於後續計算置換。

                   -- COUNT(DISTINCT APNO)   AS APNOAMT,                         --件數
                   -- COUNT(*) AS DATAAMT,                                       --筆數
                   NVL(SUM(T.ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   NVL(SUM(T.OTHERAAMT), 0) AS OTHERAAMT,                       --另案扣減同保險(B)
                   NVL(SUM(T.OTHERBAMT), 0) AS OTHERBAMT,                       --另案扣減他保險(C)
                   NVL(SUM(T.MITRATE), 0)   AS MITRATE,                         --匯費(D)
                   NVL(SUM(T.OFFSETAMT), 0) AS OFFSETAMT,                       --抵銷紓困(E)
                   0                      AS COMPENAMT,                         --代扣補償金(F)                        (失能無代扣補償金)
                   NVL(SUM(T.INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   NVL(SUM(T.ITRTTAX), 0)  AS ITRTTAX,                          --代扣利息所得稅(H)
                   NVL(SUM(T.OTHERAMT), 0) AS OTHERAMT,                         --其他(I)
                   T.ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                                --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                                --(1~5；依照給付核定檔月核案件類別)
                   T.PAYTYP,                                                    --給付方式
                   T.CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   T.NLWKMK,                                                    --普職註記
                   T.ADWKMK,                                                    --加職註記
                   T.NACHGMK,                                                   --普職互改註記
                   T.CPRNDATE,                                                  --
                   T.RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   T.PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD T
             WHERE T.RPTTYP = '1'
               AND T.ISSUYM = v_i_issuym
               AND T.APNO LIKE (v_i_paycode||'%')
               AND T.CHKDATE = v_i_chkdate
               AND T.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T.PAYSEQNO =  v_i_payseqno
               AND T.NACHGMK IS Null                                            --普職互改要另外出(非普職互改)
             GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, NACHGMK, RPTTYP, PAYSEQNO
             ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, NACHGMK, RPTTYP, PAYSEQNO;

        --月核定撥付總表(失能_普職互改) 給付方式、普職互改註記分類明細資料
        Cursor c_dataCur_NAChgSUM is
            SELECT DECODE(T.ISSUTYP,'4',(SELECT COUNT(DISTINCT T1.APNO)
                                           FROM BAPAYRPTRECORD T1
                                          WHERE T1.RPTTYP = '1'
                                            AND T1.ISSUTYP = '4'
                                            AND T1.ISSUYM = v_i_issuym
                                            AND T1.APNO LIKE (v_i_paycode || '%')
                                            AND T1.CHKDATE = v_i_chkdate
                                            AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                            AND T1.BENEVTREL NOT IN ('F', 'N', 'Z')
                                            AND T1.PAYTYP = T.PAYTYP
                                            AND T1.APNO NOT IN (SELECT DISTINCT T2.APNO
                                                                  FROM BAPAYRPTRECORD T2
                                                                 WHERE T2.RPTTYP = '1'
                                                                   AND T2.ISSUTYP = '4'
                                                                   AND T2.ISSUYM = v_i_issuym
                                                                   AND T2.APNO LIKE (v_i_paycode || '%')
                                                                   AND T2.CHKDATE = v_i_chkdate
                                                                   AND T2.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                                   AND T2.BENEVTREL NOT IN ('F', 'N', 'Z')
                                                                   AND T2.PAYTYP < T.PAYTYP)),
                                         COUNT(DISTINCT T.APNO)) AS APNOAMT,         --件數  2012/07/16 Modify By ChungYu 詹小姐重新定義件數，
                                                                                     --      若該筆受理編號已於其他給付方式呈現過，則於後續給
                                                                                     --      付方式再次呈現時不納入統計。

                                         COUNT(*) AS DATAAMT,                        --筆數
                   -- COUNT(DISTINCT APNO)   AS APNOAMT,                         --件數
                   -- COUNT(*) AS DATAAMT,                                       --筆數
                   NVL(SUM(T.ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   NVL(SUM(T.OTHERAAMT), 0) AS OTHERAAMT,                       --另案扣減同保險(B)
                   NVL(SUM(T.OTHERBAMT), 0) AS OTHERBAMT,                       --另案扣減他保險(C)
                   NVL(SUM(T.MITRATE), 0)   AS MITRATE,                         --匯費(D)
                   NVL(SUM(T.OFFSETAMT), 0) AS OFFSETAMT,                       --抵銷紓困(E)
                   0                      AS COMPENAMT,                       --代扣補償金(F)                        (失能無代扣補償金)
                   NVL(SUM(T.INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   NVL(SUM(T.ITRTTAX), 0)  AS ITRTTAX,                          --代扣利息所得稅(H)
                   NVL(SUM(T.OTHERAMT), 0) AS OTHERAMT,                         --其他(I)
                   T.ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                              --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                              --(1~5；依照給付核定檔月核案件類別)
                   T.PAYTYP,                                                    --給付方式
                   T.CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   T.NLWKMK,                                                    --普職註記
                   T.ADWKMK,                                                    --加職註記
                   T.NACHGMK,                                                   --普職互改註記
                   T.CPRNDATE,                                                  --
                   T.RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   T.PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD T
             WHERE T.RPTTYP = '1'
               AND T.ISSUYM = v_i_issuym
               AND T.APNO LIKE (v_i_paycode||'%')
               AND T.CHKDATE = v_i_chkdate
               AND T.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T.PAYSEQNO =  v_i_payseqno
               AND T.NACHGMK IS NOT Null                                        --普職互改要另外出
             GROUP BY PAYTYP, NACHGMK, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, RPTTYP, PAYSEQNO
             ORDER BY PAYTYP, NACHGMK, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, RPTTYP, PAYSEQNO;

        --月核定撥付總表(失能_普職互改) 給付方式、普職互改註記分類
        Cursor c_dataCur_NAChgTyp is
            SELECT NACHGMK,               --  普職互改註記
                   PAYTYP                 --  給付方式
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode || '%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK IS Not Null
             GROUP BY NACHGMK, PAYTYP;

        --月核定撥付總表(失能_普職互改) 給付方式、普職互改註記分類明細資料
        Cursor c_dataCur_NAChgDtl ( v_NACHGMK VARCHAR2, v_PAYTYP VARCHAR2 ) is
            SELECT APNO,                                   --件數
                   PAYYM,                                  --給付年月
                   NVL(ISSUEAMT, 0) AS ISSUEAMT,           --核定金額(A)
                   NVL(OTHERAAMT, 0) AS OTHERAAMT,         --另案扣減同保險(B)
                   NVL(OTHERBAMT, 0) AS OTHERBAMT,         --另案扣減他保險(C)
                   NVL(MITRATE, 0) AS MITRATE,             --匯費(D)
                   NVL(OFFSETAMT, 0) AS OFFSETAMT,         --抵銷紓困(E)
                   NVL(INHERITORAMT, 0) AS INHERITORAMT,   --保留遺屬津貼(G)
                   NVL(ITRTTAX, 0) AS ITRTTAX,             --代扣利息所得稅(H)
                   NVL(OTHERAMT, 0) AS OTHERAMT,           --其他(I)
                   NVL(UNACPAMT, 0) AS UNACPAMT,           --應收金額
                   PAYKIND,                                --給付種類
                   ISSUTYP,                                --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                           --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                           --(1~5；依照給付核定檔月核案件類別)
                   PAYTYP,                                 --給付方式
                   CHKDATE,                                --(月)核定日期/應收立帳日期
                   NLWKMK,                                 --普職註記
                   ADWKMK,                                 --加職註記
                   NACHGMK,                                --普職互改註記
                   CPRNDATE,                               --
                   RPTTYP,                                 --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   PAYSEQNO                                --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode || '%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK = v_NACHGMK
               AND PAYTYP = v_PAYTYP
             ORDER BY APNO, PAYYM;

       --  取得普職互改各類案件件數
        function fn_BA_getNAChgAPNOAMT
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2                              -- 給付方式
        ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT COUNT(DISTINCT T1.APNO) Into v_tmpCount
              FROM BAPAYRPTRECORD T1
             WHERE T1.RPTTYP = '1'
               AND T1.ISSUTYP = v_IssuTyp
               AND T1.ISSUYM = v_i_issuym
               AND T1.APNO LIKE (v_i_paycode || '%')
               AND T1.CHKDATE = v_i_chkdate
               AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T1.PAYTYP = v_PayTyp
               AND T1.NACHGMK = v_NAChgTyp
               AND T1.APNO NOT IN (SELECT DISTINCT T2.APNO
                                     FROM BAPAYRPTRECORD T2
                                    WHERE T2.RPTTYP = '1'
                                      AND T2.ISSUTYP = v_IssuTyp
                                      AND T2.ISSUYM = v_i_issuym
                                      AND T2.APNO LIKE (v_i_paycode || '%')
                                      AND T2.CHKDATE = v_i_chkdate
                                      AND T2.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                      AND T2.PAYTYP < v_PayTyp
                                      AND T2.NACHGMK = v_NAChgTyp);
           return v_tmpCount;
        end;

        --  取得普職互改各類案件筆數
        function fn_BA_getNAChgDATAAMT
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2                              -- 給付方式
        ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT COUNT(APNO) Into v_tmpCount
              FROM (SELECT T3.APNO
                      FROM BAPAYRPTRECORD T3
                     WHERE T3.RPTTYP = '1'
                       AND T3.ISSUTYP = v_IssuTyp
                       AND T3.ISSUYM = v_i_issuym
                       AND T3.APNO LIKE (v_i_paycode || '%')
                       AND T3.CHKDATE = v_i_chkdate
                       AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                       AND T3.PAYTYP = v_PayTyp
                       AND T3.NACHGMK = v_NAChgTyp
                       AND T3.APNO NOT IN (SELECT T4.APNO
                                             FROM BAPAYRPTRECORD T4
                                            WHERE T4.RPTTYP = '1'
                                              AND T4.ISSUTYP = v_IssuTyp
                                              AND T4.ISSUYM = v_i_issuym
                                              AND T4.APNO LIKE (v_i_paycode || '%')
                                              AND T4.CHKDATE = v_i_chkdate
                                              AND T4.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                              AND T4.APNO = T3.APNO
                                              AND T4.PAYYM = T3.PAYYM
                                              AND T4.PAYKIND = T3.PAYKIND
                                              AND T4.PAYTYP < v_PayTyp
                                              AND T4.NACHGMK = v_NAChgTyp)
                    GROUP BY T3.APNO, T3.PAYYM, T3.PAYKIND);
           return v_tmpCount;
        end;

        --  取得普職互改衝抵資料案件筆數
        function fn_BA_getNAChgDATAAMT_C
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            --v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2                              -- 給付方式
        ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT COUNT(APNO) Into v_tmpCount
              FROM (SELECT T3.APNO
                      FROM BAPAYRPTRECORD T3
                      WHERE T3.RPTTYP = '1'
                        AND T3.ISSUYM = v_i_issuym
                        AND T3.APNO LIKE (v_i_paycode || '%')
                        AND T3.CHKDATE = v_i_chkdate
                        AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                        AND T3.PAYTYP = v_PayTyp
                        AND T3.NACHGMK = v_NAChgTyp
                        AND T3.PAYYM IN ( SELECT T4.PAYYM FROM BADAPR T4
                                           WHERE T4.APNO = T3.APNO
                                             AND T4.SEQNO = T3.SEQNO
                                             AND T4.PAYYM = T3.PAYYM
                                             AND T4.PAYKIND = T3.PAYKIND
                                             AND T4.ISSUYM = (SELECT MAX(t41.ISSUYM) FROM BADAPR t41
                                                               WHERE t41.apno = t4.apno
                                                                 AND t41.mtestmk = 'F'
                                                                 AND t41.payym = t4.payym
                                                                 AND t41.issuym < v_i_issuym)
                        AND T4.MANCHKMK = 'Y'
                        AND T4.MTESTMK='F'
                        AND T4.APLPAYMK = '3'
                        AND TRIM(T4.APLPAYDATE) IS NOT NULL
                    )
                    GROUP BY T3.APNO, T3.PAYYM, T3.PAYKIND);
           return v_tmpCount;
        end;

       begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_1_K';
            v_g_genFlag := 0;
            v_g_flag := '0';
            --月核定撥付總表資料(失能)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                  v_Count  := 0;
                  --v_payamt := 0;                              --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)

                  v_payamt := v_dataSUMCur1.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur1.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur1.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur1.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur1.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur1.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur1.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur1.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur1.OTHERAMT;       --  其他費用(I)

                  v_g_genFlag := 1;

                  If v_dataSUMCur1.ISSUTYP = '4' Then
                     --    筆數  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數，
                     --    若該筆受理編號該給付年月已於其他給付方式呈現過，則於後續給
                     --    付方式再次呈現時不納入統計。
                    SELECT COUNT(APNO) Into v_count
                      FROM (SELECT T3.APNO
                              FROM BAPAYRPTRECORD T3
                             WHERE T3.RPTTYP = '1'
                               AND T3.ISSUTYP = '4'
                               AND T3.ISSUYM = v_i_issuym
                               AND T3.APNO LIKE (v_i_paycode || '%')
                               AND T3.CHKDATE = v_i_chkdate
                               AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                               AND T3.BENEVTREL NOT IN ('F', 'N', 'Z')
                               AND T3.PAYTYP = v_dataSUMCur1.PAYTYP
                               AND T3.NACHGMK IS NULL
                               AND T3.NLWKMK = v_dataSUMCur1.NLWKMK
                               AND T3.ADWKMK = v_dataSUMCur1.ADWKMK
                               AND T3.APNO NOT IN (SELECT T4.APNO
                                                     FROM BAPAYRPTRECORD T4
                                                    WHERE T4.RPTTYP = '1'
                                                      AND T4.ISSUTYP = '4'
                                                      AND T4.ISSUYM = v_i_issuym
                                                      AND T4.APNO LIKE (v_i_paycode || '%')
                                                      AND T4.CHKDATE = v_i_chkdate
                                                      AND T4.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                      AND T4.APNO = T3.APNO
                                                      AND T4.PAYYM = T3.PAYYM
                                                      AND T4.BENEVTREL NOT IN ('F', 'N', 'Z')
                                                      AND T4.PAYTYP < v_dataSUMCur1.PAYTYP)
                            GROUP BY T3.APNO, T3.PAYYM);
                  else
                    v_count := v_dataSUMCur1.DATAAMT;
                  End if;


                --寫入月核定撥付總表資料(失能)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur1.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur1.PAYTYP
                                       --,''PAYDATE
                                         ,v_dataSUMCur1.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur1.ISSUTYP
                                      -- ,CASETYP
                                         ,v_i_issuym
                                         ,''
                                         ,v_dataSUMCur1.APNOAMT
                                         ,v_count
                                         ,v_dataSUMCur1.ISSUEAMT
                                         ,v_dataSUMCur1.OTHERAAMT
                                         ,v_dataSUMCur1.OTHERBAMT
                                         ,v_dataSUMCur1.MITRATE
                                         ,v_dataSUMCur1.OFFSETAMT
                                         ,v_dataSUMCur1.COMPENAMT
                                         ,v_dataSUMCur1.INHERITORAMT
                                         ,v_dataSUMCur1.ITRTTAX
                                         ,v_dataSUMCur1.OTHERAMT
                                         ,v_payamt
                                         ,v_i_payseqno
                                         ,Decode(trim(v_dataSUMCur1.NACHGMK),null,fn_BA_transIssuTypSTR(v_dataSUMCur1.ISSUTYP),fn_BA_transNAChgTypSTR(v_dataSUMCur1.NACHGMK))   --備註
                                         ,v_dataSUMCur1.NLWKMK
                                         ,v_dataSUMCur1.ADWKMK
                                         ,v_dataSUMCur1.NACHGMK --普職互改註記
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;

            --月核定撥付總表資料(失能) 給付方式、普職互改註記分類
            for v_dataNAChgSUM in c_dataCur_NAChgSUM Loop
                v_BAPAYRPTSUM := null;

                --  v_BAPAYRPTSUM  Recode  初始化
                v_BAPAYRPTSUM.Rpttyp   := '1';
                v_BAPAYRPTSUM.Cprndate := v_dataNAChgSUM.CPRNDATE;
                v_BAPAYRPTSUM.Paytyp   := v_dataNAChgSUM.Paytyp;
                v_BAPAYRPTSUM.Chkdate  := v_dataNAChgSUM.Chkdate;
                v_BAPAYRPTSUM.Paycode  := v_i_paycode;
                v_BAPAYRPTSUM.Issutyp  := v_dataNAChgSUM.ISSUTYP;
                v_BAPAYRPTSUM.Issuym   := v_i_issuym;
                v_BAPAYRPTSUM.Proctime := to_Char(Sysdate,'YYYYMMDDHH24MISS');
                v_BAPAYRPTSUM.Payseqno := v_i_payseqno;
                v_BAPAYRPTSUM.Rptnote  := fn_BA_transIssuTypSTR(v_dataNAChgSUM.ISSUTYP);
                v_BAPAYRPTSUM.Nachgmk  := v_dataNAChgSUM.Nachgmk;
                v_BAPAYRPTSUM.Nlwkmk   := v_dataNAChgSUM.Nlwkmk;
                v_BAPAYRPTSUM.Adwkmk   := v_dataNAChgSUM.Adwkmk;
                v_BAPAYRPTSUM.UNACPAMT := 0;
                v_BAPAYRPTSUM.COMPENAMT := 0;

                --  續發案、結案、沖抵普職
                -- 件數
                v_BAPAYRPTSUM.APNOAMT := v_dataNAChgSUM.APNOAMT;
                -- 筆數
                v_BAPAYRPTSUM.DATAAMT := fn_BA_getNAChgDATAAMT(v_dataNAChgSUM.NACHGMK, v_dataNAChgSUM.ISSUTYP, v_dataNAChgSUM.PAYTYP);

                v_BAPAYRPTSUM.ISSUEAMT     := v_dataNAChgSUM.ISSUEAMT;
                v_BAPAYRPTSUM.OTHERAAMT    := v_dataNAChgSUM.OTHERAAMT;
                v_BAPAYRPTSUM.OTHERBAMT    := v_dataNAChgSUM.OTHERBAMT;
                v_BAPAYRPTSUM.MITRATE      := v_dataNAChgSUM.MITRATE;
                v_BAPAYRPTSUM.OFFSETAMT    := v_dataNAChgSUM.OFFSETAMT;
                v_BAPAYRPTSUM.INHERITORAMT := v_dataNAChgSUM.INHERITORAMT;
                v_BAPAYRPTSUM.ITRTTAX      := v_dataNAChgSUM.ITRTTAX;
                v_BAPAYRPTSUM.OTHERAMT     := v_dataNAChgSUM.OTHERAMT;

                v_BAPAYRPTSUM.PAYAMT := v_BAPAYRPTSUM.ISSUEAMT - v_BAPAYRPTSUM.OTHERAAMT - v_BAPAYRPTSUM.OTHERBAMT -
                                        v_BAPAYRPTSUM.MITRATE - v_BAPAYRPTSUM.OFFSETAMT - v_BAPAYRPTSUM.INHERITORAMT -
                                        v_BAPAYRPTSUM.ITRTTAX - v_BAPAYRPTSUM.OTHERAMT;

                If NVL(v_BAPAYRPTSUM.Issueamt,0) > 0 Then
                   Insert into BAPAYRPTSUM Values v_BAPAYRPTSUM;
                End If;
            end Loop;

            -- 普職互改衝抵   Recode
            for v_dataNAChgTyp in c_dataCur_NAChgTyp Loop
                v_BAPAYRPTSUM9 := null;

                for v_dataNAChgDtl in c_dataCur_NAChgDtl(v_dataNAChgTyp.NACHGMK, v_dataNAChgTyp.PAYTYP) Loop

                   --  普職互改衝抵   Recode  初始化
                   If ( v_BAPAYRPTSUM9.Rpttyp Is Null) Then
                        v_BAPAYRPTSUM9.Rpttyp := '1';
                        v_BAPAYRPTSUM9.Cprndate := v_dataNAChgDtl.CPRNDATE;

                        v_BAPAYRPTSUM9.Paytyp := v_dataNAChgDtl.Paytyp;
                        v_BAPAYRPTSUM9.Chkdate := v_dataNAChgDtl.Chkdate;
                        v_BAPAYRPTSUM9.Paycode := v_i_paycode;
                        v_BAPAYRPTSUM9.Issutyp  := '9';
                        v_BAPAYRPTSUM9.Issuym := v_i_issuym;
                        v_BAPAYRPTSUM9.Proctime := to_Char(Sysdate,'YYYYMMDDHH24MISS');
                        v_BAPAYRPTSUM9.Payseqno := v_i_payseqno;
                        v_BAPAYRPTSUM9.Nachgmk  := v_dataNAChgDtl.Nachgmk;
                        v_BAPAYRPTSUM9.Nlwkmk   := v_dataNAChgDtl.Nlwkmk;
                        v_BAPAYRPTSUM9.Adwkmk   := v_dataNAChgDtl.Adwkmk;
                        v_BAPAYRPTSUM9.UNACPAMT := 0;
                        v_BAPAYRPTSUM9.COMPENAMT := 0;

                        if SUBSTR(v_dataNAChgDtl.NACHGMK,1,1) = '1' Then
                           v_BAPAYRPTSUM9.Rptnote := '－沖普通';
                        elsif SUBSTR(v_dataNAChgDtl.NACHGMK,1,1) = '2' Then
                           v_BAPAYRPTSUM9.Rptnote := '－沖職災';
                        else
                           v_BAPAYRPTSUM9.Rptnote := '－沖加職';
                        end if;
                   End If;

                   -- 取得給付年月已核發筆數
                   Select Count(*) Into v_PayymCount From BADAPR
                    Where APNO = v_dataNAChgDtl.APNO
                      And ISSUYM < v_i_issuym
                      And PAYYM = v_dataNAChgDtl.PAYYM
                      And MTESTMK = 'F'
                      And APLPAYMK = '3'
                      And APLPAYDATE Is Not Null;

                   If v_PayymCount > 0 then

                      --  普職互改沖抵
                      v_PreIssuAmt := 0;
                      v_DisAmt     := 0;
                      Select Count(*) Into v_Count FROM BADAPR T
                       WHERE T.APNO = v_dataNAChgDtl.APNO
                         AND T.SEQNO = '0000'
                         AND T.PAYYM = v_dataNAChgDtl.PAYYM
                         AND T.ISSUYM < v_i_issuym
                         AND T.PAYKIND = v_dataNAChgDtl.PAYKIND
                         AND T.MTESTMK = 'F'
                         AND T.APLPAYMK = '3'
                         AND T.APLPAYDATE IS NOT NULL;

                      If v_Count > 0 Then

                         SELECT T.Befissueamt INTO v_PreIssuAmt FROM BADAPR T
                          WHERE T.APNO = v_dataNAChgDtl.APNO
                            AND T.SEQNO = '0000'
                            AND T.PAYYM = v_dataNAChgDtl.PAYYM
                            AND T.ISSUYM = (SELECT MAX(T1.ISSUYM) FROM BADAPR T1
                                             WHERE T1.APNO = v_dataNAChgDtl.APNO
                                               AND T1.SEQNO = '0000'
                                               AND T1.ISSUYM < v_i_issuym
                                               AND T1.PAYYM = T.PAYYM
                                               AND T1.PAYKIND = T.PAYKIND
                                               AND T1.MTESTMK = 'F'
                                               AND T1.APLPAYMK = '3'
                                               AND T1.APLPAYDATE IS NOT NULL
                                            )
                            AND T.PAYKIND = v_dataNAChgDtl.PAYKIND
                            AND T.MTESTMK = 'F'
                            AND T.APLPAYMK = '3'
                            AND T.APLPAYDATE IS NOT NULL;

                         -- 件數
                         IF v_BAPAYRPTSUM9.APNOAMT IS NULL THEN
                            v_BAPAYRPTSUM9.APNOAMT := fn_BA_getNAChgAPNOAMT(v_dataNAChgTyp.NACHGMK, '2', v_dataNAChgDtl.PAYTYP);
                         END IF;
                         -- 筆數
                         IF v_BAPAYRPTSUM9.DATAAMT IS NULL THEN
                            --v_BAPAYRPTSUM9.DATAAMT := fn_BA_getNAChgDATAAMT_C(v_dataNAChgTyp.NACHGMK, '2', v_dataNAChgDtl.PAYTYP);
                            v_BAPAYRPTSUM9.DATAAMT := fn_BA_getNAChgDATAAMT_C(v_dataNAChgTyp.NACHGMK, v_dataNAChgDtl.PAYTYP);
                         END IF;

                         Select Nvl(RECAMT,0) Into v_DisAmt FROM BADAPR T
                          WHERE T.APNO = v_dataNAChgDtl.APNO
                            AND T.SEQNO = '0000'
                            AND T.ISSUYM = v_i_issuym
                            AND T.PAYYM = v_dataNAChgDtl.PAYYM
                            AND T.MTESTMK = 'F'
                            AND T.PAYKIND = v_dataNAChgDtl.PAYKIND;

                         v_BAPAYRPTSUM9.ISSUEAMT     := Nvl(v_BAPAYRPTSUM9.ISSUEAMT,0) + v_PreIssuAmt;
                         v_BAPAYRPTSUM9.OTHERAAMT    := Nvl(v_BAPAYRPTSUM9.OTHERAAMT,0) + v_DisAmt;
                         v_BAPAYRPTSUM9.OTHERBAMT    := 0;
                         v_BAPAYRPTSUM9.MITRATE      := 0;
                         v_BAPAYRPTSUM9.OFFSETAMT    := 0;
                         v_BAPAYRPTSUM9.INHERITORAMT := 0;
                         v_BAPAYRPTSUM9.ITRTTAX      := 0;
                         v_BAPAYRPTSUM9.OTHERAMT     := 0;

                         v_BAPAYRPTSUM9.PAYAMT := v_BAPAYRPTSUM9.ISSUEAMT - v_BAPAYRPTSUM9.OTHERAAMT;
                      End if;

                   End if;
                End Loop;
                   If NVL(v_BAPAYRPTSUM9.Issueamt,0) > 0 Then
                      Insert into BAPAYRPTSUM Values v_BAPAYRPTSUM9;
                   End If;
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表(失能)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '月核定撥付總表(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genSUMPayRPT_1_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_1_K
        PURPOSE:         產生月核定撥付總表會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
         PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_1_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_mtestmk             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;
        v_PAYTYP           BAPAYRPTACCOUNT.PAYTYP%TYPE         := '';
        v_BENEVTREL        BAPAYRPTACCOUNT.BENEVTREL%TYPE      := '';
        v_NACHGMK          BAPAYRPTACCOUNT.NACHGMK%TYPE        := '';
        v_NLWKMK           BAPAYRPTACCOUNT.NLWKMK%TYPE         := '';
        v_ADWKMK           BAPAYRPTACCOUNT.ADWKMK%TYPE         := '';
        v_MNLWKMK          BAPAYRPTACCOUNT.NLWKMK%TYPE         := '';
        v_MADWKMK          BAPAYRPTACCOUNT.ADWKMK%TYPE         := '';
        v_tempUNACPAMT     BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;     -- 暫存扣減金額

        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

        --月核定撥付總表(失能)
        Cursor c_dataCur_SUMrpt1 is
            SELECT NVL(SUM(Decode(PAYKIND,'37',0,ISSUEAMT)), 0)   AS ISSUEAMTA,          --核定金額(失能年金)
                   NVL(SUM(Decode(PAYKIND,'37',ISSUEAMT,0)), 0)   AS ISSUEAMTB,          --核定金額(補償金)
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額(總金額)
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   PAYTYP,                                        -- 給付方式
                   NLWKMK,                                        -- 普職註記
                   ADWKMK,                                        -- 加職註記
                   NACHGMK,                                       -- 普職互改註記
                   NVL(SUM(Decode(PAYKIND,'37',0,PAYAMT)), 0)   AS PAYAMTA,              --應付金額(失能年金) add by 20121029 Angela
                   NVL(SUM(Decode(PAYKIND,'37',PAYAMT,0)), 0)   AS PAYAMTB               --應付金額(補償金)   add by 20121029 Angela
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK is null
             GROUP BY PAYTYP, NLWKMK, ADWKMK, NACHGMK
             ORDER BY PAYTYP, NLWKMK, ADWKMK, NACHGMK;

        --月核定撥付總表(普職互改)
        Cursor c_dataCur_SUMrptNAChg1 is
            SELECT NVL(SUM(Decode(PAYKIND,'37',0,ISSUEAMT)), 0) AS ISSUEAMTA,      -- 核定金額(失能年金)
                   NVL(SUM(Decode(PAYKIND,'37',ISSUEAMT,0)), 0) AS ISSUEAMTB,      -- 核定金額(失能補償金)        -- 2012/07/09 Mark By ChungYu 普職互改失能補償金，要依照受理編號個別抓。
                   NVL(SUM(Decode(PAYKIND,'37',0,UNACPAMT)), 0) AS UNACPAMTA,      -- 收回金額(失能年金)          -- 2012/08/17 Add By ChungYu
                   NVL(SUM(Decode(PAYKIND,'37',UNACPAMT,0)), 0) AS UNACPAMTB,      -- 收回金額(失能補償金)        -- 2012/08/17 Add By ChungYu
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,                           -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,                           -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,                             -- 匯款匯費
                   NLWKMK,                                                         -- 普職註記
                   ADWKMK,                                                         -- 加職註記
                   NACHGMK,                                                        -- 普職互改註記
                   PAYTYP,                                                         -- 給付方式
                   NVL(SUM(Decode(PAYKIND,'37',0,PAYAMT)), 0)   AS PAYAMTA,        --應付金額(失能年金) add by 20121030 Angela
                   NVL(SUM(Decode(PAYKIND,'37',PAYAMT,0)), 0)   AS PAYAMTB         --應付金額(補償金)   add by 20121030 Angela
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK Is Not Null
             GROUP BY PAYTYP, NLWKMK, ADWKMK, NACHGMK
             ORDER BY PAYTYP, NLWKMK, ADWKMK, NACHGMK;

         --其他應收款(另案扣減同保險)
         Cursor c_dataCur_OTHERAAMT is

                SELECT T.MPAYTYP,
                       T.DISPAYKIND,
                       T.MNLWKMK,
                       T.MADWKMK,
                       T.NLWKMK,
                       T.ADWKMK,
                       SUM(T.DISAMT) AS DISAMT
                  FROM
                (SELECT SUBSTR(T1.MAPNO, 1, 1) AS MPAYTYP,                            --  (扣前期)取得應收未收檔普職註記及加值註記的另案扣減金額
                       T3.PAYKIND AS DISPAYKIND,
                       T3.NLWKMK AS MNLWKMK,
                       T3.ADWKMK AS MADWKMK,
                       T1.NLWKMK,
                       T1.ADWKMK,
                       SUM(T1.DISAMT) AS DISAMT
                  FROM BACUTREC T1, (SELECT T21.APNO,
                                            T21.ISSUYM,
                                            T21.PAYYM,
                                            T21.PAYKIND,
                                            T21.NACHGMK
                                       FROM BAPAYRPTRECORD T21
                                      WHERE T21.RPTTYP = '1'
                                        AND T21.APNO LIKE (v_i_paycode||'%')
                                        AND T21.ISSUYM = v_i_issuym
                                        AND T21.CHKDATE = v_i_chkdate
                                        AND T21.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                        AND T21.PAYTYP = v_PAYTYP
                                        AND T21.OTHERAAMT > 0
                                        AND T21.PAYSEQNO = v_i_payseqno
                                        AND NVL(T21.NACHGMK,'00') = NVL(v_NACHGMK,'00')
                                        AND NVL(T21.NLWKMK ,'0') = NVL(v_NLWKMK,'0')
                                        AND NVL(T21.ADWKMK ,'0') = NVL(v_ADWKMK,'0')
                                        ) T2,
                                    (Select T31.BAUNACPDTLID,
                                            T31.PAYKIND,
                                            T31.NLWKMK,
                                            T31.ADWKMK
                                       From BAUNACPDTL T31
                                      WHERE T31.BAUNACPDTLID IN (SELECT T32.RECSEQ FROM BACUTREC T32
                                                                  WHERE T32.APNO LIKE (v_i_paycode||'%')
                                                                    AND T32.ISSUYM = v_i_issuym
                                                                    AND T32.MTESTMK = 'F'
                                                                )
                                    ) t3
                 WHERE T1.APNO LIKE (v_i_paycode||'%')
                   AND T1.ISSUYM = v_i_issuym
                   AND T1.MTESTMK = 'F'
                   AND T1.APNO = T2.APNO
                   AND (( T1.APNO <> T1.MAPNO AND T2.NACHGMK IS Not NULL) Or T2.NACHGMK IS NULL)
                   AND T1.ISSUYM = T2.ISSUYM
                   AND T1.PAYYM = T2.PAYYM
                   AND T1.PAYKIND = T2.PAYKIND
                   AND T1.RECSEQ IS NOT NULL
                   AND T1.RECSEQ = T3.BAUNACPDTLID
                 GROUP BY SUBSTR(T1.MAPNO, 1, 1), T3.PAYKIND, T3.NLWKMK, T3.ADWKMK, T1.NLWKMK, T1.ADWKMK
                UNION
                SELECT SUBSTR(T1.MAPNO, 1, 1) AS MPAYTYP,                             --  (扣本期)取得扣減紀錄檔普職註記及加值註記的另案扣減金額
                       DISPAYKIND,
                       MNLWKMK,
                       MADWKMK,
                       NLWKMK,
                       ADWKMK,
                       SUM(T1.DISAMT) AS DISAMT
                  FROM BACUTREC T1, (SELECT T21.APNO,
                                            T21.ISSUYM,
                                            T21.PAYYM,
                                            T21.PAYKIND,
                                            T21.NACHGMK
                                       FROM BAPAYRPTRECORD T21
                                      WHERE T21.RPTTYP = '1'
                                        AND T21.APNO LIKE (v_i_paycode||'%')
                                        AND T21.ISSUYM = v_i_issuym
                                        AND T21.CHKDATE = v_i_chkdate
                                        AND T21.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                        AND T21.PAYTYP = v_PAYTYP
                                        AND T21.OTHERAAMT > 0
                                        AND T21.PAYSEQNO = v_i_payseqno
                                        AND NVL(T21.NACHGMK,'00') = NVL(v_NACHGMK,'00')
                                        AND NVL(T21.NLWKMK ,'0') = NVL(v_NLWKMK,'0')
                                        AND NVL(T21.ADWKMK ,'0') = NVL(v_ADWKMK,'0')
                                        ) T2
                 WHERE T1.APNO LIKE (v_i_paycode||'%')
                   AND T1.ISSUYM = v_i_issuym
                   AND T1.MTESTMK = 'F'
                   AND T1.APNO = T2.APNO
                   AND (( T1.APNO <> T1.MAPNO AND T2.NACHGMK IS Not NULL) Or T2.NACHGMK IS NULL)
                   AND T1.ISSUYM = T2.ISSUYM
                   AND T1.PAYYM = T2.PAYYM
                   AND T1.PAYKIND = T2.PAYKIND
                   AND T1.RECSEQ IS NULL
                 GROUP BY SUBSTR(T1.MAPNO, 1, 1), DISPAYKIND, MNLWKMK, MADWKMK, NLWKMK, ADWKMK  ) T
                 GROUP BY T.MPAYTYP, T.DISPAYKIND, T.MNLWKMK, T.MADWKMK, T.NLWKMK, T.ADWKMK
                 ORDER BY T.MPAYTYP, T.DISPAYKIND, T.MNLWKMK, T.MADWKMK, T.NLWKMK, T.ADWKMK;


      --月核定撥付總表(失能_普職互改)要分別計算年金及補償金本期沖抵前期金額
      Cursor c_NAChgPreCase ( v_NACHGMK VARCHAR2, v_PAYTYP VARCHAR2 ) is
        SELECT NVL(SUM(T2.DISAMT), 0) As "DISAMT",
                   T3.NLWKMK,
                   T3.ADWKMK,
                   T3.PAYKIND AS DISPAYKIND
              FROM (SELECT Distinct T11.APNO
                      FROM BAPAYRPTRECORD T11
                     WHERE T11.RPTTYP = '1'
                       AND T11.APNO LIKE (v_i_paycode || '%')
                       AND T11.SEQNO = '0000'
                       AND T11.ISSUYM = v_i_issuym
                       AND T11.CHKDATE = v_i_chkdate
                       AND T11.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                       AND PAYTYP = v_PAYTYP
                       AND T11.PAYSEQNO = v_i_payseqno
                       AND T11.NACHGMK = v_NACHGMK) T1,
                   (SELECT T21.APNO,
                           T21.MAPNO,
                           T21.SEQNO,
                           T21.ISSUYM,
                           T21.MPAYYM,
                           DECODE(T21.DISPAYKIND, '37', T21.DISPAYKIND, '35') AS "DISPAYKIND",
                           T21.DISAMT,
                           T21.NLWKMK,
                           T21.ADWKMK,
                           T21.RECSEQ
                      FROM BACUTREC T21
                     WHERE T21.APNO LIKE (v_i_paycode || '%')
                        AND T21.SEQNO = '0000'
                        AND T21.ISSUYM = v_i_issuym
                        AND T21.MISSUYM < v_i_issuym
                        AND T21.MTESTMK = 'F'
                        AND T21.NACHGMK = v_NACHGMK) T2,
                   (Select T31.BAUNACPDTLID,
                           T31.PAYKIND,
                           T31.NLWKMK,
                           T31.ADWKMK
                      From BAUNACPDTL T31
                     WHERE T31.BAUNACPDTLID IN (SELECT T32.RECSEQ FROM BACUTREC T32
                                                 WHERE T32.APNO LIKE (v_i_paycode||'%')
                                                   AND T32.ISSUYM = v_i_issuym
                                                   AND T32.MTESTMK = 'F'
                                                   AND T32.NACHGMK = v_NACHGMK
                                               )
                   ) T3
             WHERE T1.APNO = T2.APNO
               AND T1.APNO = T2.MAPNO
               AND T2.RECSEQ = T3.BAUNACPDTLID
          GROUP BY T3.PAYKIND, T3.NLWKMK, T3.ADWKMK;

       --月核定撥付總表(失能_普職互改)要分別計算年金及補償金本期沖抵本期金額
        function fn_NAChgCase
        (
           v_PAYKIND  in  VARCHAR2,
           v_NACHGMK  in  VARCHAR2,
           v_PAYTYP   in  VARCHAR2
         ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT NVL(SUM(T2.DISAMT),0) Into v_tmpCount FROM
                                  (SELECT T11.APNO,
                                          T11.SEQNO,
                                          T11.ISSUYM,
                                          T11.PAYYM,
                                          T11.PAYKIND
                                     FROM BAPAYRPTRECORD T11
                                    WHERE T11.RPTTYP = '1'
                                      AND T11.APNO LIKE (v_i_paycode || '%')
                                      AND T11.SEQNO = '0000'
                                      AND T11.ISSUYM = v_i_issuym
                                      AND DECODE(T11.PAYKIND,'37',T11.PAYKIND,'35') = v_PAYKIND
                                      AND T11.CHKDATE = v_i_chkdate
                                      AND T11.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                      AND T11.PAYSEQNO = v_i_payseqno
                                      AND T11.NACHGMK = v_NACHGMK
                                      AND T11.PAYTYP = v_PAYTYP
                                      ) T1,
                                  (SELECT T21.APNO,
                                          T21.MAPNO,
                                          T21.SEQNO,
                                          T21.ISSUYM,
                                          T21.MPAYYM,
                                          T21.DISPAYKIND,
                                          T21.DISAMT
                                     FROM BACUTREC T21
                                    WHERE T21.APNO LIKE (v_i_paycode || '%')
                                      AND T21.SEQNO = '0000'
                                      AND T21.ISSUYM = v_i_issuym
                                      AND T21.MISSUYM = v_i_issuym
                                      AND T21.MTESTMK = v_i_mtestmk
                                      AND DECODE(T21.DISPAYKIND,'37',T21.DISPAYKIND,'35') = v_PAYKIND
                                      AND T21.NACHGMK = v_NACHGMK
                                     ) T2
           WHERE T1.APNO    = T2.APNO
             AND T1.APNO    = T2.MAPNO
             AND T1.SEQNO   = T2.SEQNO
             AND T1.ISSUYM  = T2.ISSUYM
             AND T1.PAYYM   = T2.MPAYYM
             AND T1.PAYKIND = T2.DISPAYKIND;

           return v_tmpCount;
        end;

       --月核定撥付總表(失能_普職互改)要分別計算年金及補償金已領金額
        function fn_NAChgPreAmt
        (
           v_PAYKIND  in  VARCHAR2,
           v_PAYTYP   in  VARCHAR2,
           v_NACHGMK  in  VARCHAR2
         ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
        SELECT SUM(T.BEFISSUEAMT) Into v_tmpCount FROM BADAPR T
                         WHERE T.APNO IN (SELECT DISTINCT T1.APNO FROM BAPAYRPTRECORD T1
                                           WHERE T1.RPTTYP = '1'
                                             AND T1.ISSUYM = v_i_issuym
                                             AND T1.APNO LIKE (v_i_paycode || '%')
                                             AND T1.CHKDATE = v_i_chkdate
                                             AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                             AND T1.PAYSEQNO = v_i_payseqno
                                             AND T1.PAYTYP = v_PAYTYP
                                             AND T1.NACHGMK = v_NACHGMK)
                           AND T.SEQNO = '0000'
                           AND T.ISSUYM = (SELECT MAX(T2.ISSUYM) FROM BADAPR T2
                                            WHERE T2.APNO = T.APNO
                                              AND T2.SEQNO = T.SEQNO
                                              AND T2.ISSUYM < v_i_issuym
                                              AND T2.MTESTMK = 'F'
                                              AND T2.APLPAYMK = '3'
                                              AND TRIM(T2.APLPAYDATE) IS NOT NULL
                                              AND T2.PAYYM = T.PAYYM)
                           AND T.MTESTMK = 'F'
                           AND DECODE(T.PAYKIND,'37',T.PAYKIND,'35') = v_PAYKIND
                           AND DECODE(T.PAYTYP,'2','1',T.PAYTYP) = v_PAYTYP
                           AND T.APLPAYMK = '3'
                           AND TRIM(T.APLPAYDATE) IS NOT NULL;
           return v_tmpCount;
        end;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_1_K';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --月核定撥付總表資料(失能)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                  v_count          := 0;
                  v_g_genFlag      := 1;
                  v_ACCOUNTSEQ     := null;
                  v_ACCOUNTNO      := '';
                  v_ACCOUNTNAME    := '';

                  --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                for i in 1..6 LOOP
--                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ     := 1;

                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    if i = 1 then
                        v_ACCOUNTSEQ   := 0;
                        v_tmpAMT       := v_dataSUMCur1.ISSUEAMTA;

                        if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                            v_ACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                            v_ACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                            v_ACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                            v_ACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                            v_ACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                            v_ACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                        end if;

                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO        := '';
                        if (v_dataSUMCur1.Paytyp = '4') then
                            v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                            v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                        else
                            v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                        end if;

                        v_ACTTITLEAPCODE     := 'ABA';
                        v_DATACD             := '1';
                        --v_DECIDEAMT        := v_dataSUMCur1.ISSUEAMTA-v_dataSUMCur1.OTHERBAMT
                        --                      -v_dataSUMCur1.OFFSETAMT-v_dataSUMCur1.MITRATE;
                        --判斷是否有（補償金）的資料，用以區分要將另案扣減他保險及紓困的金額扣在哪
                        if v_dataSUMCur1.ISSUEAMTB<=0 then
                            v_DECIDEAMT  := v_dataSUMCur1.ISSUEAMTA-v_dataSUMCur1.OTHERBAMT-v_dataSUMCur1.OFFSETAMT-v_dataSUMCur1.MITRATE;
                        else
                            v_DECIDEAMT  := v_dataSUMCur1.ISSUEAMTA-v_dataSUMCur1.MITRATE;
                        end if;
                        v_CASHAMT            := v_dataSUMCur1.PAYAMTA;
                        v_CUTAMT             := 0;
                        v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                        v_ACCOUNTTOPFMK      := 'Y';

                        select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_dataSUMCur1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP <> '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_dataSUMCur1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_dataSUMCur1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_dataSUMCur1.ADWKMK,' ');
                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur1.ISSUEAMTB;

                        if (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                            v_ACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                            v_ACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                            v_ACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                            v_ACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                        end if;

                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO        := '';
                        if (v_dataSUMCur1.Paytyp = '4') then
                            v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                            v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                        else
                            v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                        end if;

                        v_ACTTITLEAPCODE     := 'ABA';
                        v_DATACD             := '1';
                        --v_DECIDEAMT          := v_dataSUMCur1.ISSUEAMTB;
                        --判斷是否有（補償金）的資料，用以區分要將另案扣減他保險及紓困的金額扣在哪
                        if v_dataSUMCur1.ISSUEAMTB<=0 then
                           -- v_DECIDEAMT  := v_dataSUMCur1.ISSUEAMTB-v_dataSUMCur1.MITRATE;  2018/03/28 Modify By ChungYu 補償金不需扣匯費
                           v_DECIDEAMT  := v_dataSUMCur1.ISSUEAMTB;
                        else
                           -- v_DECIDEAMT  := v_dataSUMCur1.ISSUEAMTB-v_dataSUMCur1.OTHERBAMT-v_dataSUMCur1.OFFSETAMT-v_dataSUMCur1.MITRATE;
                           v_DECIDEAMT  := v_dataSUMCur1.ISSUEAMTB-v_dataSUMCur1.OTHERBAMT-v_dataSUMCur1.OFFSETAMT;
                        end if;
                        v_CASHAMT            := v_dataSUMCur1.PAYAMTB;
                        v_CUTAMT             := 0;
                        v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                        v_CNT                := 0;
                        v_ACCOUNTTOPFMK      := 'Y';
                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 3 then
                        if (v_dataSUMCur1.Paytyp = '4') then
                            v_ACCOUNTNO      := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                            v_ACCOUNTNAME    := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                        else
                            v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶';
                        end if;
                        v_tmpAMT         := v_dataSUMCur1.PAYAMT;

                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                        --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 4 then
                        v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（另案扣減他保險）';
                        v_tmpAMT         := v_dataSUMCur1.OTHERBAMT;

                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '另案扣減他保險';

                        --判斷是否有（補償金）的資料，用以區分要將另案扣減他保險的借方掛在哪
                        if v_dataSUMCur1.ISSUEAMTB<=0 then
                            if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                            end if;
                        else
                            if (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                            end if;
                        end if;

                        v_ACTTITLEAPCODE := 'ABA';
                        v_DATACD         := 'A';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := v_tmpAMT;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '9';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 5 then
                        v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（紓困）';
                        v_tmpAMT         := v_dataSUMCur1.OFFSETAMT;

                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '紓困';

                        --判斷是否有（補償金）的資料，用以區分要將紓困的借方掛在哪
                        if v_dataSUMCur1.ISSUEAMTB<=0 then
                            if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                            end if;
                        else
                            if (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                            end if;
                        end if;

                        v_ACTTITLEAPCODE := 'ABA';
                        v_DATACD         := 'F';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := v_tmpAMT;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '3';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 6 then
                        v_ACCOUNTNO      := '';
                        v_ACCOUNTNAME    := '';
                        v_tmpAMT         := 0;

                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                        if (v_dataSUMCur1.Paytyp = '5' or v_dataSUMCur1.Paytyp = '6') then
                            v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（國外匯款之手續費）';
                            v_tmpAMT         := v_dataSUMCur1.MITRATE;

                            --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                            v_ACCOUNTMEMO    := '國外匯款之手續費';

                            --判斷是否有（補償金）的資料，用以區分要將國外匯款之手續費的借方掛在哪
                            -- 2018/03/26 modify by ChungYu 國外匯款之手續費不會掛在補償金的會計科目上
                            if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                            end if;

                            /*if v_dataSUMCur1.ISSUEAMTB<=0 then
                                if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                                    v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                    v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                                elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                    v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                    v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                                elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                    v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                    v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                                end if;
                            else
                                if (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '1') then
                                    v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                    v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                                elsif (v_dataSUMCur1.Nlwkmk = '2' And v_dataSUMCur1.Adwkmk = '2') then
                                    v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                    v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                                end if;
                            end if;*/

                            v_ACTTITLEAPCODE := 'ABA';
                            v_DATACD         := 'H';
                            v_DECIDEAMT      := v_tmpAMT;
                            v_CASHAMT        := v_tmpAMT;
                            v_CUTAMT         := 0;
                            v_ACCEPTPAYTYPE  := 'H';
                            v_CNT            := 0;
                            v_ACCOUNTTOPFMK  := 'Y';
                            --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                        end if;
                    end if;

                    --寫入月核定撥付總表會計科目資料(借：保險給付，貸：銀行存款)(失能)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121029
                                                    ,OPPACCOUNTNO      --add by Angela 20121029
                                                    ,OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,DATACD            --add by Angela 20121029
                                                    ,DECIDEAMT         --add by Angela 20121029
                                                    ,CASHAMT           --add by Angela 20121029
                                                    ,CUTAMT            --add by Angela 20121029
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,CNT               --add by Angela 20121029
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values ('1'
                                                    ,v_i_cprndt
                                                    ,v_i_paycode
                                                    ,v_i_issuym
                                                    ,v_dataSUMCur1.PAYTYP
                                                    ,v_i_chkdate
                                                    ,''
                                                    ,v_ACCOUNTSEQ
                                                    ,v_count
                                                    ,v_ACCOUNTNO
                                                    ,v_ACCOUNTNAME
                                                    ,v_tmpAMT
                                                    ,v_i_payseqno
                                                    ,v_dataSUMCur1.NLWKMK
                                                    ,v_dataSUMCur1.ADWKMK
                                                    ,''
                                                    ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                    ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                    ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                    ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,v_DATACD            --add by Angela 20121029
                                                    ,v_DECIDEAMT         --add by Angela 20121029
                                                    ,v_CASHAMT           --add by Angela 20121029
                                                    ,v_CUTAMT            --add by Angela 20121029
                                                    ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,v_CNT               --add by Angela 20121029
                                                    ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --寫入月核定撥付總表會計科目資料(貸：其他應收款)(失能)
                v_PAYTYP := v_dataSUMCur1.PAYTYP;
                v_BENEVTREL := '1';
                v_NACHGMK := v_dataSUMCur1.NACHGMK;
                v_NLWKMK := v_dataSUMCur1.NLWKMK;
                v_ADWKMK := v_dataSUMCur1.ADWKMK;

                for v_dataCur_OTHERAAMT in c_dataCur_OTHERAAMT Loop
                    v_ACCOUNTSEQ  := 1;
                    v_tmpAMT      := v_dataCur_OTHERAAMT.Disamt;
                    v_MNLWKMK     := NVL(v_dataCur_OTHERAAMT.Mnlwkmk,v_dataCur_OTHERAAMT.Nlwkmk);
                    v_MADWKMK     := NVL(v_dataCur_OTHERAAMT.Madwkmk,v_dataCur_OTHERAAMT.Adwkmk);

--                    v_count       := v_count + 1;
                    v_ACCOUNTNAME    := '其他應收款－';

                    if v_dataCur_OTHERAAMT.Mpaytyp = 'L' then
                       v_ACCOUNTNO      := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－老年給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '1' or trim(v_MNLWKMK) is null) and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_MNLWKMK = '1' or trim(v_MNLWKMK) is null)  then
                           v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '1')  then
                           v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '2')  then
                           v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－本人死亡給付（遺屬年金）';
                    end if;

                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121029 回寫PFM&PFD時所需資訊 End-->

                    if v_tmpAMT > 0 then
                        v_count       := v_count + 1;

                        insert into BAPAYRPTACCOUNT( RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121029
                                                    ,OPPACCOUNTNO      --add by Angela 20121029
                                                    ,OPPACCOUNTNAME    --add by Angela 20121029
                                                    ,ACTTITLEAPCODE    --add by Angela 20121029
                                                    ,DATACD            --add by Angela 20121029
                                                    ,DECIDEAMT         --add by Angela 20121029
                                                    ,CASHAMT           --add by Angela 20121029
                                                    ,CUTAMT            --add by Angela 20121029
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121029
                                                    ,CNT               --add by Angela 20121029
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_dataSUMCur1.NLWKMK
                                                     ,v_dataSUMCur1.ADWKMK
                                                     ,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121029
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121029
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121029
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121029
                                                     ,v_DATACD            --add by Angela 20121029
                                                     ,v_DECIDEAMT         --add by Angela 20121029
                                                     ,v_CASHAMT           --add by Angela 20121029
                                                     ,v_CUTAMT            --add by Angela 20121029
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121029
                                                     ,v_CNT               --add by Angela 20121029
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;
            end Loop;

            --月核定撥付總表資料(普職互改)
            for v_SUMrptNAChg1 in c_dataCur_SUMrptNAChg1 Loop
                v_count          := 0;
                v_g_genFlag      := 1;
                v_ACCOUNTNO      := '';
                v_ACCOUNTNAME    := '';
                v_PAYTYP         := v_SUMrptNAChg1.PAYTYP;

                --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                for i in 1..7 LOOP
                    v_ACCOUNTSEQ     := 1;
                    v_tmpAMT         := 0;
                    v_ACCOUNTNO      := '';
                    v_ACCOUNTNAME    := '';

                    --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    if i = 1 then
                       v_ACCOUNTSEQ   := 0;
                       v_tmpAMT       := v_SUMrptNAChg1.ISSUEAMTA;
                       if (v_SUMrptNAChg1.Nlwkmk is null or v_SUMrptNAChg1.Nlwkmk = '1') then
                           v_ACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                           v_ACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                       elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                           v_ACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                           v_ACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                       elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                           v_ACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                           v_ACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                       end if;

                       --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       if (v_SUMrptNAChg1.Paytyp = '4') then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADA';
                       v_DATACD             := '1';
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;

                       -- Modify by ChungYu 2017/10/05，因普職互改發生前期核發無補償金(37)，但本期普職互改發生且新增補償金(37),
                       -- 造成寫入PFM&PFD金額錯誤，因此將前段判斷是否有（補償金）的資料條件加入。
                       -- 判斷是否有（補償金）的資料，用以區分要將另案扣減他保險及紓困的金額扣在哪
                       if v_SUMrptNAChg1.ISSUEAMTB<=0 then
                          v_DECIDEAMT := v_SUMrptNAChg1.ISSUEAMTA-v_SUMrptNAChg1.OTHERBAMT-v_SUMrptNAChg1.OFFSETAMT-v_SUMrptNAChg1.MITRATE;
                       else
                          v_DECIDEAMT := v_SUMrptNAChg1.ISSUEAMTA-v_SUMrptNAChg1.MITRATE;
                       end if;

                       /*v_DECIDEAMT          := v_SUMrptNAChg1.ISSUEAMTA-v_SUMrptNAChg1.OTHERBAMT
                                              -v_SUMrptNAChg1.OFFSETAMT-v_SUMrptNAChg1.MITRATE;*/

                       -- Modify by ChungYu 2017/10/05 以上

                       --Modify by Angela 20140917 計算應付金額時，需扣除已領金額
                       --v_CASHAMT            := v_SUMrptNAChg1.PAYAMTA
                       --Modify by Angela 20150204 直接讀取應付金額
                       --v_CASHAMT            := v_SUMrptNAChg1.PAYAMTA-fn_NAChgPreAmt('35',v_SUMrptNAChg1.PAYTYP,v_SUMrptNAChg1.NACHGMK);
                       v_CASHAMT            := v_SUMrptNAChg1.PAYAMTA;
                       v_CUTAMT             := 0;
                       v_CNT                := 0;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_SUMrptNAChg1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP <> '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_SUMrptNAChg1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_SUMrptNAChg1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_SUMrptNAChg1.ADWKMK,' ');
                       --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_ACCOUNTSEQ   := 0;
                       v_tempUNACPAMT := fn_NAChgCase('35', v_SUMrptNAChg1.NACHGMK, v_SUMrptNAChg1.PAYTYP);
                       v_tmpAMT := v_SUMrptNAChg1.UNACPAMTA - v_tempUNACPAMT;

                       if ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                           v_ACCOUNTNO      := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                           v_ACCOUNTNAME    := '其他應收款－普通－失能給付（年金）';

                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                           v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                           v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                       elsif (SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2') then
                           v_ACCOUNTNO      := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                           v_ACCOUNTNAME    := '其他應收款－職災－失能給付（年金）';

                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                           --判斷是否有（補償金）的資料，用以區分要將紓困的借方掛在哪
                           if v_SUMrptNAChg1.ISSUEAMTA>0 then
                               v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                           else
                               v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                               v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                           end if;
                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                       elsif (SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3') then
                           v_ACCOUNTNO      := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME    := '其他應收款－加職－失能給付（年金）';

                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                           --判斷是否有（補償金）的資料，用以區分要將紓困的借方掛在哪
                           if v_SUMrptNAChg1.ISSUEAMTA>0 then
                               v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                           else
                               v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                               v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                           end if;
                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->
                       end if;

                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       v_ACTTITLEAPCODE     := 'FFG';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_CNT                := 0;
                       v_ACCOUNTTOPFMK      := 'Y';
                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 3 then
                       v_ACCOUNTSEQ   := 0;
                       v_tmpAMT       := v_SUMrptNAChg1.ISSUEAMTB;
                       if (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                           v_ACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                           v_ACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                       elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                           v_ACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                           v_ACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                       end if;

                       --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       if (v_SUMrptNAChg1.Paytyp = '4') then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADA';
                       v_DATACD             := '1';

                       -- Modify by ChungYu 2017/10/05，因普職互改發生前期核發無補償金(37)，但本期普職互改發生且新增補償金(37),
                       -- 造成寫入PFM&PFD金額錯誤，因此將前段判斷是否有（補償金）的資料條件加入。
                       -- 判斷是否有（補償金）的資料，用以區分要將另案扣減他保險及紓困的金額扣在哪
                       if v_SUMrptNAChg1.ISSUEAMTB<=0 then
                          v_DECIDEAMT := v_SUMrptNAChg1.ISSUEAMTB-v_SUMrptNAChg1.MITRATE;
					             else
                          v_DECIDEAMT := v_SUMrptNAChg1.ISSUEAMTB-v_SUMrptNAChg1.OTHERBAMT-v_SUMrptNAChg1.OFFSETAMT-v_SUMrptNAChg1.MITRATE;
                       end if;
                       --v_DECIDEAMT          := v_SUMrptNAChg1.ISSUEAMTB;
                       -- Modify by ChungYu 2017/10/05 以上

                       --Modify by Angela 20140917 計算應付金額時，需扣除已領金額
                       --v_CASHAMT            := v_SUMrptNAChg1.PAYAMTB
                       --Modify by Angela 20150204 直接讀取應付金額
                       --v_CASHAMT            := v_SUMrptNAChg1.PAYAMTB-fn_NAChgPreAmt('37',v_SUMrptNAChg1.PAYTYP,v_SUMrptNAChg1.NACHGMK);
                       v_CASHAMT            := v_SUMrptNAChg1.PAYAMTB;
                       v_CUTAMT             := 0;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_CNT                := 0;
                       v_ACCOUNTTOPFMK      := 'Y';
                       --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 4 then
                       v_ACCOUNTSEQ   := 0;
                       v_tempUNACPAMT := fn_NAChgCase('37', v_SUMrptNAChg1.NACHGMK, v_SUMrptNAChg1.PAYTYP);
                       v_tmpAMT := v_SUMrptNAChg1.UNACPAMTB - v_tempUNACPAMT;
                       if ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                           v_ACCOUNTNO      := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                           v_ACCOUNTNAME    := '其他應收款－職災－失能給付（補償金）';

                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                           --判斷是否有（補償金）的資料，用以區分要將紓困的借方掛在哪
                           if v_SUMrptNAChg1.ISSUEAMTB>0 then
                               v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                               v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                           else
                               v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                           end if;
                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                       elsif (SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3') then
                           v_ACCOUNTNO      := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                           v_ACCOUNTNAME    := '其他應收款－加職－失能給付（補償金）';

                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                           --判斷是否有（補償金）的資料，用以區分要將紓困的借方掛在哪
                           if v_SUMrptNAChg1.ISSUEAMTB>0 then
                               v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                               v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                           else
                               v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                           end if;
                           --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->
                       end if;

                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       v_ACTTITLEAPCODE     := 'FFG';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_CNT                := 0;
                       v_ACCOUNTTOPFMK      := 'Y';
                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 5 then
                          v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                          v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（另案扣減他保險）';
                          v_tmpAMT         := v_SUMrptNAChg1.OTHERBAMT;

                          --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                          v_ACCOUNTMEMO    := '另案扣減他保險';

                          --判斷是否有（補償金）的資料，用以區分要將另案扣減他保險的借方掛在哪
                          if v_SUMrptNAChg1.ISSUEAMTB<=0 then
                              if (v_SUMrptNAChg1.Nlwkmk is null or v_SUMrptNAChg1.Nlwkmk = '1') then
                                  v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                  v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                              elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                                  v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                  v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                              elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                                  v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                  v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                              end if;
                          else
                              if (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                                  v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                  v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                              elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                                  v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                  v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                              end if;
                          end if;

                          v_ACTTITLEAPCODE := 'ADA';
                          v_DATACD         := 'A';
                          v_DECIDEAMT      := v_tmpAMT;
                          v_CASHAMT        := v_tmpAMT;
                          v_CUTAMT         := 0;
                          v_ACCEPTPAYTYPE  := '9';
                          v_CNT            := 0;
                          v_ACCOUNTTOPFMK  := 'Y';
                          --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 6 then
                          v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                          v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（紓困）';
                          v_tmpAMT         := v_SUMrptNAChg1.OFFSETAMT;

                          --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                          v_ACCOUNTMEMO    := '紓困';

                          --判斷是否有（補償金）的資料，用以區分要將紓困的借方掛在哪
                          if v_SUMrptNAChg1.ISSUEAMTB<=0 then
                              if (v_SUMrptNAChg1.Nlwkmk is null or v_SUMrptNAChg1.Nlwkmk = '1') then
                                  v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                  v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                              elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                                  v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                  v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                              elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                                  v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                  v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                              end if;
                          else
                              if (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                                  v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                  v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                              elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                                  v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                  v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                              end if;
                          end if;

                          v_ACTTITLEAPCODE := 'ADA';
                          v_DATACD         := 'F';
                          v_DECIDEAMT      := v_tmpAMT;
                          v_CASHAMT        := v_tmpAMT;
                          v_CUTAMT         := 0;
                          v_ACCEPTPAYTYPE  := '3';
                          v_CNT            := 0;
                          v_ACCOUNTTOPFMK  := 'Y';
                          --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 7 then
                          v_ACCOUNTNO      := '';
                          v_ACCOUNTNAME    := '';
                          v_tmpAMT         := 0;

                          --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                          v_ACCOUNTMEMO    := '';
                          v_OPPACCOUNTNO   := '';
                          v_OPPACCOUNTNAME := '';
                          v_ACTTITLEAPCODE := '';
                          v_DATACD         := '';
                          v_DECIDEAMT      := 0;
                          v_CASHAMT        := 0;
                          v_CUTAMT         := 0;
                          v_ACCEPTPAYTYPE  := '';
                          v_CNT            := 0;
                          v_ACCOUNTTOPFMK  := 'N';
                          --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                          if (v_SUMrptNAChg1.Paytyp = '5' or v_SUMrptNAChg1.Paytyp = '6') then
                              v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                              v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶（國外匯款之手續費）';
                              v_tmpAMT         := v_SUMrptNAChg1.MITRATE;

                              --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                              v_ACCOUNTMEMO    := '國外匯款之手續費';

                              --判斷是否有（補償金）的資料，用以區分要將國外匯款之手續費的借方掛在哪
                              if v_SUMrptNAChg1.ISSUEAMTB<=0 then
                                  if (v_SUMrptNAChg1.Nlwkmk is null or v_SUMrptNAChg1.Nlwkmk = '1') then
                                      v_OPPACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                      v_OPPACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                                  elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                                      v_OPPACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                      v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                                  elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                                      v_OPPACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                      v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                                  end if;
                              else
                                  if (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                                      v_OPPACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                      v_OPPACCOUNTNAME    := '保險給付－職災－失能給付（補償金）';
                                  elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                                      v_OPPACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                      v_OPPACCOUNTNAME    := '保險給付－加職－失能給付（補償金）';
                                  end if;
                              end if;

                              v_ACTTITLEAPCODE := 'ADA';
                              v_DATACD         := 'H';
                              v_DECIDEAMT      := v_tmpAMT;
                              v_CASHAMT        := v_tmpAMT;
                              v_CUTAMT         := 0;
                              v_ACCEPTPAYTYPE  := 'H';
                              v_CNT            := 0;
                              v_ACCOUNTTOPFMK  := 'Y';
                              --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->
                          end if;
                    end if;

                    --寫入月核定撥付總表會計科目資料(借：保險給付)(失能普職互改)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(
                                                     RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121030
                                                    ,OPPACCOUNTNO      --add by Angela 20121030
                                                    ,OPPACCOUNTNAME    --add by Angela 20121030
                                                    ,ACTTITLEAPCODE    --add by Angela 20121030
                                                    ,DATACD            --add by Angela 20121030
                                                    ,DECIDEAMT         --add by Angela 20121030
                                                    ,CASHAMT           --add by Angela 20121030
                                                    ,CUTAMT            --add by Angela 20121030
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121030
                                                    ,CNT               --add by Angela 20121030
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (
                                                     '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121030
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121030
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121030
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121030
                                                     ,v_DATACD            --add by Angela 20121030
                                                     ,v_DECIDEAMT         --add by Angela 20121030
                                                     ,v_CASHAMT           --add by Angela 20121030
                                                     ,v_CUTAMT            --add by Angela 20121030
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121030
                                                     ,v_CNT               --add by Angela 20121030
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --寫入月核定撥付總表會計科目資料(貸：保險給付)(失能普職互改)
                v_PAYTYP := v_SUMrptNAChg1.PAYTYP;
                v_NLWKMK := v_SUMrptNAChg1.NLWKMK;
                v_ADWKMK := v_SUMrptNAChg1.ADWKMK;

                --另案扣減同保險_非同案件(扣他案)(普職互改)
                v_BENEVTREL := '1';
                v_NACHGMK := v_SUMrptNAChg1.NACHGMK;
                for v_dataCur_OTHERAAMT in c_dataCur_OTHERAAMT Loop
                    v_ACCOUNTSEQ     := 1;
                    v_tmpAMT         := v_dataCur_OTHERAAMT.Disamt;
                    v_ACCOUNTNAME    := '其他應收款－';

                    if v_dataCur_OTHERAAMT.Mpaytyp = 'L' then
                        v_ACCOUNTNO      := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－老年給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '1' or trim(v_dataCur_OTHERAAMT.Mnlwkmk) is null) and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                        v_ACCOUNTNO      := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                        v_ACCOUNTNO      := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'職災－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                        v_ACCOUNTNO      := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'加職－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                        v_ACCOUNTNO      := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'職災－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                        v_ACCOUNTNO      := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'加職－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '1' or trim(v_dataCur_OTHERAAMT.Mnlwkmk) is null)  then
                        v_ACCOUNTNO      := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'普通－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  then
                        v_ACCOUNTNO      := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'職災－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  then
                        v_ACCOUNTNO      := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                        v_ACCOUNTNAME    := v_ACCOUNTNAME||'加職－本人死亡給付（遺屬年金）';
                    end if;

                    --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121030
                                                    ,OPPACCOUNTNO      --add by Angela 20121030
                                                    ,OPPACCOUNTNAME    --add by Angela 20121030
                                                    ,ACTTITLEAPCODE    --add by Angela 20121030
                                                    ,DATACD            --add by Angela 20121030
                                                    ,DECIDEAMT         --add by Angela 20121030
                                                    ,CASHAMT           --add by Angela 20121030
                                                    ,CUTAMT            --add by Angela 20121030
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121030
                                                    ,CNT               --add by Angela 20121030
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121030
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121030
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121030
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121030
                                                     ,v_DATACD            --add by Angela 20121030
                                                     ,v_DECIDEAMT         --add by Angela 20121030
                                                     ,v_CASHAMT           --add by Angela 20121030
                                                     ,v_CUTAMT            --add by Angela 20121030
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121030
                                                     ,v_CNT               --add by Angela 20121030
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --另案扣減同保險_同案件(普職互改本案衝抵衝本期)(普職互改)
                for i in 1..3 LOOP
                    v_ACCOUNTSEQ     := 1;
                    v_tmpAMT         := 0;
                    v_ACCOUNTNO      := '';
                    v_ACCOUNTNAME    := '';

                    --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    if i = 1 then
                       SELECT SUM(DECODE(T.ISSUTYP,'9',-T.PAYAMT, T.PAYAMT)) Into v_tmpAMT
                         FROM BAPAYRPTSUM T
                        WHERE T.RPTTYP = '1'
                          AND T.PAYTYP = v_SUMrptNAChg1.PAYTYP
                          AND T.PAYCODE = v_i_paycode
                          AND T.ISSUYM = v_i_issuym
                          AND T.NACHGMK = v_SUMrptNAChg1.NACHGMK;

                       if (v_SUMrptNAChg1.Paytyp = '4') then
                           v_ACCOUNTNO      := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_ACCOUNTNAME    := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       --add by Angela 20121030 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20121030 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_tmpAMT       := fn_NAChgPreAmt('35', v_SUMrptNAChg1.PAYTYP, v_SUMrptNAChg1.NACHGMK);
                       if ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                           v_ACCOUNTNO      := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                           v_ACCOUNTNAME    := '保險給付－普通－失能給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                             v_ACCOUNTNO      := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                             v_ACCOUNTNAME    := '保險給付－職災－失能給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                             v_ACCOUNTNO      := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                             v_ACCOUNTNAME    := '保險給付－加職－失能給付（年金）';
                       end if;

                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := fn_BA_transNAChgTypSTR(v_SUMrptNAChg1.NACHGMK);
                       if v_PAYTYP = '4' then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADC';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_SUMrptNAChg1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP = '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_SUMrptNAChg1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_SUMrptNAChg1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_SUMrptNAChg1.ADWKMK,' ');
                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 3 then
                       v_tmpAMT       := fn_NAChgPreAmt('37', v_SUMrptNAChg1.PAYTYP, v_SUMrptNAChg1.NACHGMK);
                       if ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                            v_ACCOUNTNO      := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                            v_ACCOUNTNAME    := '保險給付－職災-失能給付（補償金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                            v_ACCOUNTNO      := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                            v_ACCOUNTNAME    := '保險給付－加職-失能給付（補償金）';
                       end if;

                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := fn_BA_transNAChgTypSTR(v_SUMrptNAChg1.NACHGMK);
                       if v_PAYTYP = '4' then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADC';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_SUMrptNAChg1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP = '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_SUMrptNAChg1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_SUMrptNAChg1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_SUMrptNAChg1.ADWKMK,' ');
                       --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入月核定撥付總表會計科目資料(貸：保險給付)(失能普職互改)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121031
                                                    ,OPPACCOUNTNO      --add by Angela 20121031
                                                    ,OPPACCOUNTNAME    --add by Angela 20121031
                                                    ,ACTTITLEAPCODE    --add by Angela 20121031
                                                    ,DATACD            --add by Angela 20121031
                                                    ,DECIDEAMT         --add by Angela 20121031
                                                    ,CASHAMT           --add by Angela 20121031
                                                    ,CUTAMT            --add by Angela 20121031
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121031
                                                    ,CNT               --add by Angela 20121031
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121031
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121031
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121031
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121031
                                                     ,v_DATACD            --add by Angela 20121031
                                                     ,v_DECIDEAMT         --add by Angela 20121031
                                                     ,v_CASHAMT           --add by Angela 20121031
                                                     ,v_CUTAMT            --add by Angela 20121031
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121031
                                                     ,v_CNT               --add by Angela 20121031
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --  分別計算年金及補償金本期沖抵前期金額
                for v_NAChgPreCase in c_NAChgPreCase(v_SUMrptNAChg1.NACHGMK, v_SUMrptNAChg1.PAYTYP) LOOP
                    v_ACCOUNTSEQ     := 1;
                    --v_tmpAMT         := 0;
                    v_ACCOUNTNO      := '';
                    v_ACCOUNTNAME    := '';
                    v_tmpAMT := v_NAChgPreCase.Disamt;

                    if v_NAChgPreCase.DISPAYKIND <> '37' then
                       if ( v_NAChgPreCase.Nlwkmk = '1' ) then
                            v_ACCOUNTNO      := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_ACCOUNTNAME    := '其他應收款－普通－失能給付（年金）';
                       elsif (v_NAChgPreCase.Nlwkmk = '2' And v_NAChgPreCase.Adwkmk = '1') then
                            v_ACCOUNTNO      := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_ACCOUNTNAME    := '其他應收款－職災－失能給付（年金）';
                       elsif (v_NAChgPreCase.Nlwkmk = '2' And v_NAChgPreCase.Adwkmk = '2') then
                            v_ACCOUNTNO      := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                            v_ACCOUNTNAME    := '其他應收款－加職－失能給付（年金）';
                       end if;
                    elsif v_NAChgPreCase.DISPAYKIND = '37' then
                       if (v_NAChgPreCase.Nlwkmk = '2' And v_NAChgPreCase.Adwkmk = '1') then
                            v_ACCOUNTNO      := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_ACCOUNTNAME    := '其他應收款－職災－失能給付（補償金）';
                       elsif (v_NAChgPreCase.Nlwkmk = '2' And v_NAChgPreCase.Adwkmk = '2') then
                            v_ACCOUNTNO      := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_ACCOUNTNAME    := '其他應收款－加職－失能給付（補償金）';
                       end if;
                    end if;

                    --add by Angela 20121031 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121031 回寫PFM&PFD時所需資訊 End-->

                    --寫入月核定撥付總表會計科目資料(貸：保險給付)(失能普職互改_本期沖抵前期金額)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121031
                                                    ,OPPACCOUNTNO      --add by Angela 20121031
                                                    ,OPPACCOUNTNAME    --add by Angela 20121031
                                                    ,ACTTITLEAPCODE    --add by Angela 20121031
                                                    ,DATACD            --add by Angela 20121031
                                                    ,DECIDEAMT         --add by Angela 20121031
                                                    ,CASHAMT           --add by Angela 20121031
                                                    ,CUTAMT            --add by Angela 20121031
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121031
                                                    ,CNT               --add by Angela 20121031
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values ( '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121031
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121031
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121031
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121031
                                                     ,v_DATACD            --add by Angela 20121031
                                                     ,v_DECIDEAMT         --add by Angela 20121031
                                                     ,v_CASHAMT           --add by Angela 20121031
                                                     ,v_CUTAMT            --add by Angela 20121031
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121031
                                                     ,v_CNT               --add by Angela 20121031
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(失能)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '月核定撥付總表會計科目(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_1_K End

   /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_1_S
        PURPOSE:         產生月核定撥付總表(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_updflag       (varChar2)       --是否回押註記
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_1_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

          v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                      -- 應付金額
          v_Count                     NUMBER      := 0;
          v_ApnoCount                 NUMBER      := 0;                      -- 件數
          v_DataCount                 NUMBER      := 0;                      -- 筆數
          v_PayymCount                NUMBER      := 0;                      -- 給付年月核發筆數
          v_BAPAYRPTSUM                           BAPAYRPTSUM%ROWTYPE;       -- 普職互改各類案件彙總資料
          v_BAPAYRPTSUM9                          BAPAYRPTSUM%ROWTYPE;       -- 普職互改衝抵
          v_PreIssuAmt                NUMBER      := 0;                      -- 前次核定金額
          v_DisAmt                    NUMBER      := 0;                      -- 扣減金額
          --v_EvtDeduct                 TYP_REC_DEDUCT;                        -- 事故者扣項金額(紓困、另案扣減(同)、另案扣減(他))

        --月核定撥付總表(遺屬)
        Cursor c_dataCur_SUMrpt1 is
            SELECT
                   --COUNT(DISTINCT T.APNO)) AS APNOAMT,                        --件數(另行計算)  2012/07/16 Modify By ChungYu 詹小姐重新定義件數，
                                                                                --                若該筆受理編號已於其他給付方式呈現過，則於後續給
                                                                                --                付方式再次呈現時不納入統計。
                   --COUNT(*) AS DATAAMT,                                       --筆數(另行計算)  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數
                                                                                --                於死亡結案時若該筆受理編號相同給付年月僅計算一筆，
                                                                                --                死亡結案筆數計算於後續計算置換。
                   NVL(SUM(T.ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   NVL(SUM(T.OTHERAAMT), 0) AS OTHERAAMT,                       --另案扣減同保險(B)
                   NVL(SUM(T.OTHERBAMT), 0) AS OTHERBAMT,                       --另案扣減他保險(C)
                   NVL(SUM(T.MITRATE), 0)   AS MITRATE,                         --匯費(D)
                   NVL(SUM(T.OFFSETAMT), 0) AS OFFSETAMT,                       --抵銷紓困(E)
                   0                      AS COMPENAMT,                         --代扣補償金(F)                        (失能無代扣補償金)
                   NVL(SUM(T.INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   NVL(SUM(T.ITRTTAX), 0)  AS ITRTTAX,                          --代扣利息所得稅(H)
                   NVL(SUM(T.OTHERAMT), 0) AS OTHERAMT,                         --其他(I)
                   T.ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                                --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                                --(1~5；依照給付核定檔月核案件類別)
                   T.PAYTYP,                                                    --給付方式
                   T.CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   T.NLWKMK,                                                    --普職註記
                   T.ADWKMK,                                                    --加職註記
                   T.NACHGMK,                                                   --普職互改註記
                   T.CPRNDATE,                                                  --
                   T.RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   T.PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD T
             WHERE T.RPTTYP = '1'
               AND T.ISSUYM = v_i_issuym
               AND T.APNO LIKE (v_i_paycode||'%')
               AND T.CHKDATE = v_i_chkdate
               AND T.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T.PAYSEQNO =  v_i_payseqno
               AND T.NACHGMK IS Null                                            --普職互改要另外出(非普職互改)
               AND T.PAYTYP IS Not Null
             GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, NACHGMK, RPTTYP, PAYSEQNO
             ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, NACHGMK, RPTTYP, PAYSEQNO;

        --月核定撥付總表(遺屬_普職互改) 給付方式、普職互改註記分類
        Cursor c_dataCur_NAChgSUM is
            SELECT
                   --COUNT(DISTINCT T.APNO)) AS APNOAMT,                        --件數(另行計算)  2012/07/16 Modify By ChungYu 詹小姐重新定義件數，
                                                                                --                若該筆受理編號已於其他給付方式呈現過，則於後續給
                                                                                --                付方式再次呈現時不納入統計。
                   --COUNT(*) AS DATAAMT,                                       --筆數(另行計算)  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數
                                                                                --                於死亡結案時若該筆受理編號相同給付年月僅計算一筆，
                                                                                --                死亡結案筆數計算於後續計算置換。
                   NVL(SUM(T.ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   NVL(SUM(T.OTHERAAMT), 0) AS OTHERAAMT,                       --另案扣減同保險(B)
                   NVL(SUM(T.OTHERBAMT), 0) AS OTHERBAMT,                       --另案扣減他保險(C)
                   NVL(SUM(T.MITRATE), 0)   AS MITRATE,                         --匯費(D)
                   NVL(SUM(T.OFFSETAMT), 0) AS OFFSETAMT,                       --抵銷紓困(E)
                   0                      AS COMPENAMT,                       --代扣補償金(F)                        (失能無代扣補償金)
                   NVL(SUM(T.INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   NVL(SUM(T.ITRTTAX), 0)  AS ITRTTAX,                          --代扣利息所得稅(H)
                   NVL(SUM(T.OTHERAMT), 0) AS OTHERAMT,                         --其他(I)
                   NVL(SUM(T.UNACPAMT), 0) AS UNACPAMT,                         --普職互改衝抵金額
                   T.ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                              --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                              --(1~5；依照給付核定檔月核案件類別)
                   T.PAYTYP,                                                    --給付方式
                   T.CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   T.NLWKMK,                                                    --普職註記
                   T.ADWKMK,                                                    --加職註記
                   T.NACHGMK,                                                   --普職互改註記
                   T.CPRNDATE,                                                  --
                   T.RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   T.PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD T
             WHERE T.RPTTYP = '1'
               AND T.ISSUYM = v_i_issuym
               AND T.APNO LIKE (v_i_paycode||'%')
               AND T.CHKDATE = v_i_chkdate
               AND T.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T.PAYSEQNO =  v_i_payseqno
               AND T.NACHGMK IS NOT Null                                        --普職互改要另外出
               AND T.PAYTYP IS Not Null
             GROUP BY PAYTYP, NACHGMK, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, RPTTYP, PAYSEQNO
             ORDER BY PAYTYP, NACHGMK, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, RPTTYP, PAYSEQNO;

        --月核定撥付總表(遺屬_普職互改) 給付方式、普職互改註記分類
        Cursor c_dataCur_NAChgTyp is
            SELECT NACHGMK,               --  普職互改註記
                   PAYTYP                 --  給付方式
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode || '%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK IS Not Null
               AND PAYTYP IS Not Null
             GROUP BY NACHGMK, PAYTYP;

        --月核定撥付總表(遺屬_普職互改) 給付方式、普職互改註記分類明細資料
        Cursor c_dataCur_NAChgDtl ( v_NACHGMK VARCHAR2, v_PAYTYP VARCHAR2 ) is
            SELECT APNO,                                   --件數
                   SEQNO,                                  --序號
                   PAYYM,                                  --給付年月
                   NVL(ISSUEAMT, 0) AS ISSUEAMT,           --核定金額(A)
                   NVL(OTHERAAMT, 0) AS OTHERAAMT,         --另案扣減同保險(B)
                   NVL(OTHERBAMT, 0) AS OTHERBAMT,         --另案扣減他保險(C)
                   NVL(MITRATE, 0) AS MITRATE,             --匯費(D)
                   NVL(OFFSETAMT, 0) AS OFFSETAMT,         --抵銷紓困(E)
                   NVL(INHERITORAMT, 0) AS INHERITORAMT,   --保留遺屬津貼(G)
                   NVL(ITRTTAX, 0) AS ITRTTAX,             --代扣利息所得稅(H)
                   NVL(OTHERAMT, 0) AS OTHERAMT,           --其他(I)
                   NVL(UNACPAMT, 0) AS UNACPAMT,           --應收金額
                   PAYKIND,                                --給付種類
                   ISSUTYP,                                --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                           --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                           --(1~5；依照給付核定檔月核案件類別)
                   PAYTYP,                                 --給付方式
                   CHKDATE,                                --(月)核定日期/應收立帳日期
                   NLWKMK,                                 --普職註記
                   ADWKMK,                                 --加職註記
                   NACHGMK,                                --普職互改註記
                   CPRNDATE,                               --
                   RPTTYP,                                 --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   PAYSEQNO                                --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode || '%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK = v_NACHGMK
               AND PAYTYP = v_PAYTYP
             ORDER BY APNO, PAYYM, SEQNO;

        --  取得各類案件件數
        function fn_BA_getNAAPNOAMT
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2,                             -- 給付方式
            v_Nlwkmk        in     varChar2,                             -- 普職註記
            v_Adwkmk        in     varChar2                              -- 加職註記
        ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT COUNT(DISTINCT T1.APNO) Into v_tmpCount
              FROM BAPAYRPTRECORD T1
             WHERE T1.RPTTYP = '1'
               AND T1.ISSUTYP = v_IssuTyp
               AND T1.ISSUYM = v_i_issuym
               AND T1.APNO LIKE (v_i_paycode || '%')
               AND T1.CHKDATE = v_i_chkdate
               AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND T1.PAYTYP = v_PayTyp
               AND NVL(T1.NACHGMK,'00') = NVL(v_NAChgTyp,'00')
               AND T1.NLWKMK = v_Nlwkmk
               AND T1.ADWKMK = v_Adwkmk
               AND T1.APNO NOT IN (SELECT DISTINCT T2.APNO
                                     FROM BAPAYRPTRECORD T2
                                    WHERE T2.RPTTYP = '1'
                                      AND T2.ISSUTYP = v_IssuTyp
                                      AND T2.ISSUYM = v_i_issuym
                                      AND T2.APNO LIKE (v_i_paycode || '%')
                                      AND T2.CHKDATE = v_i_chkdate
                                      AND T2.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                      AND T2.PAYTYP < v_PayTyp
                                      AND NVL(T2.NACHGMK,'00') = NVL(v_NAChgTyp,'00')
                                      AND T2.NLWKMK = v_Nlwkmk
                                      AND T2.ADWKMK = v_Adwkmk
                                      );
           return v_tmpCount;
        end;

        --  取得普職互改各類案件筆數
        function fn_BA_getNADATAAMT
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2,                             -- 給付方式
            v_Nlwkmk        in     varChar2,                             -- 普職註記
            v_Adwkmk        in     varChar2                              -- 加職註記
        ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT COUNT(APNO) Into v_tmpCount
              FROM (SELECT T3.APNO
                      FROM BAPAYRPTRECORD T3
                     WHERE T3.RPTTYP = '1'
                       AND T3.ISSUTYP = v_IssuTyp
                       AND T3.ISSUYM = v_i_issuym
                       AND T3.APNO LIKE (v_i_paycode || '%')
                       AND T3.CHKDATE = v_i_chkdate
                       AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                       AND T3.PAYTYP = v_PayTyp
                       AND NVL(T3.NACHGMK,'00') = NVL(v_NAChgTyp,'00')
                       AND T3.NLWKMK = v_Nlwkmk
                       AND T3.ADWKMK = v_Adwkmk
                       AND T3.APNO NOT IN (SELECT T4.APNO
                                             FROM BAPAYRPTRECORD T4
                                            WHERE T4.RPTTYP = '1'
                                              AND T4.ISSUTYP = v_IssuTyp
                                              AND T4.ISSUYM = v_i_issuym
                                              AND T4.APNO LIKE (v_i_paycode || '%')
                                              AND T4.CHKDATE = v_i_chkdate
                                              AND T4.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                              AND T4.APNO = T3.APNO
                                              AND T4.PAYYM = T3.PAYYM
                                              AND T4.PAYKIND = T3.PAYKIND
                                              AND T4.PAYTYP < v_PayTyp
                                              AND NVL(T4.NACHGMK,'00') = NVL(v_NAChgTyp,'00')
                                              AND T4.NLWKMK = v_Nlwkmk
                                              AND T4.ADWKMK = v_Adwkmk)
                    GROUP BY T3.APNO, T3.PAYYM);
           return v_tmpCount;
        end;

        --  取得事故者各項扣減金額
        function fn_BA_getEVTDEDUCT
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2,                             -- 給付方式
            v_Nlwkmk        in     varChar2,                             -- 普職註記
            v_Adwkmk        in     varChar2                              -- 加職註記
        ) return TYP_REC_DEDUCT
        as
            v_tmpDeduct     TYP_REC_DEDUCT;
        begin
            v_tmpDeduct := null;
            SELECT NVL(SUM(T1.OFFSETAMT), 0),
                   NVL(SUM(T1.OTHERAAMT), 0),
                   NVL(SUM(T1.OTHERBAMT), 0)
                   Into v_tmpDeduct
              FROM BAPAYRPTRECORD T1
             WHERE T1.RPTTYP = '1'
               AND T1.ISSUTYP = v_IssuTyp
               AND T1.ISSUYM = v_i_issuym
               AND T1.APNO LIKE (v_i_paycode || '%')
               AND T1.SEQNO = '0000'
               AND T1.CHKDATE = v_i_chkdate
               AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NVL(T1.NACHGMK, '00') = NVL(v_NAChgTyp, '00')
               AND T1.NLWKMK = v_Nlwkmk
               AND T1.ADWKMK = v_Adwkmk
               AND T1.APNO NOT IN (SELECT DISTINCT T2.APNO
                                     FROM BAPAYRPTRECORD T2
                                    WHERE T2.RPTTYP = T1.RPTTYP
                                      AND T2.ISSUTYP = T1.ISSUTYP
                                      AND T2.ISSUYM = v_i_issuym
                                      AND T2.APNO LIKE (v_i_paycode || '%')
                                      AND T2.CHKDATE = v_i_chkdate
                                      AND T2.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                      AND T2.PAYTYP < v_PayTyp
                                      AND NVL(T2.NACHGMK, '00') = NVL(v_NAChgTyp, '00')
                                      AND T2.NLWKMK = T1.NLWKMK
                                      AND T2.ADWKMK = T1.NLWKMK);
           return v_tmpDeduct;
        end;

        --  取得普職互改衝抵資料案件筆數
        function fn_BA_getNAChgDATAAMT_C
        (
            v_NAChgTyp      in     varChar2,                             -- 普職互改註記
            --v_IssuTyp       in     varChar2,                             -- 核付分類
            v_PayTyp        in     varChar2                              -- 給付方式
        ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT COUNT(APNO) Into v_tmpCount
              FROM (SELECT T3.APNO
                      FROM BAPAYRPTRECORD T3
                      WHERE T3.RPTTYP = '1'
                        AND T3.ISSUYM = v_i_issuym
                        AND T3.APNO LIKE (v_i_paycode || '%')
                        AND T3.CHKDATE = v_i_chkdate
                        AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                        AND T3.PAYTYP = v_PayTyp
                        AND T3.NACHGMK = v_NAChgTyp
                        AND T3.PAYYM IN ( SELECT T4.PAYYM FROM BADAPR T4
                                           WHERE T4.APNO = T3.APNO
                                             AND T4.SEQNO = T3.SEQNO
                                             AND T4.PAYYM = T3.PAYYM
                                             AND T4.PAYKIND = T3.PAYKIND
                                             AND T4.ISSUYM = (SELECT MAX(t41.ISSUYM) FROM BADAPR t41
                                                               WHERE t41.apno = t4.apno
                                                                 AND t41.mtestmk = 'F'
                                                                 AND t41.payym = t4.payym
                                                                 AND t41.issuym < v_i_issuym)
                                             AND T4.MANCHKMK = 'Y'
                                             AND T4.MTESTMK='F'
                                             AND T4.APLPAYMK = '3'
                                             AND TRIM(T4.APLPAYDATE) IS NOT NULL )
                        AND T3.PAYYM NOT IN (SELECT T5.PAYYM FROM BAPAYRPTRECORD T5
                                              WHERE T5.RPTTYP = '1'
                                                AND T5.ISSUYM = v_i_issuym
                                                AND T5.APNO LIKE (v_i_paycode || '%')
                                                AND T5.CHKDATE = v_i_chkdate
                                                AND T5.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                AND T5.APNO = T3.APNO
                                                AND T5.PAYYM = T3.PAYYM
                                                AND T5.PAYKIND = T3.PAYKIND
                                                AND T5.PAYTYP < v_PayTyp
                                                AND NVL(T5.NACHGMK, '00') = NVL(v_NAChgTyp, '00')
                                                AND T5.NLWKMK = T3.NLWKMK
                                                AND T5.ADWKMK = T3.ADWKMK)
                    GROUP BY T3.APNO, T3.PAYYM, T3.PAYKIND);
           return v_tmpCount;
        end;

       begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_1_S';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --月核定撥付總表資料(遺屬)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                  --v_ApnoCount  := 0;
                  --v_DataCount  := 0;
                  --v_payamt     := 0;                          --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)

                  -- 取得事故者各項扣減金額(紓困、另案扣減(同)、、另案扣減(他))

                 /* v_EvtDeduct := fn_BA_getEVTDEDUCT(v_dataSUMCur1.NACHGMK,
                                                    v_dataSUMCur1.ISSUTYP,
                                                    v_dataSUMCur1.PAYTYP,
                                                    v_dataSUMCur1.NLWKMK,
                                                    v_dataSUMCur1.ADWKMK
                                                   );*/


                  v_payamt := v_dataSUMCur1.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur1.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur1.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur1.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur1.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur1.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur1.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur1.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur1.OTHERAMT;        --  其他費用(I)
--                              - v_EvtDeduct.EVTOFFSETAMT      --  事故者紓困貸款
--                              - v_EvtDeduct.EVTOTHERAAMT      --  事故者另案扣減(同類保險)金額
--                              - v_EvtDeduct.EVTOTHERBAMT;     --  事故者另案扣減(他類保險)金額

                  v_g_genFlag := 1;

                  -- 取得件數
                  v_ApnoCount := fn_BA_getNAAPNOAMT(v_dataSUMCur1.NACHGMK,
                                                    v_dataSUMCur1.ISSUTYP,
                                                    v_dataSUMCur1.PAYTYP,
                                                    v_dataSUMCur1.NLWKMK,
                                                    v_dataSUMCur1.ADWKMK);

                  -- 取得筆數
                  v_DataCount := fn_BA_getNADATAAMT(v_dataSUMCur1.NACHGMK,
                                                    v_dataSUMCur1.ISSUTYP,
                                                    v_dataSUMCur1.PAYTYP,
                                                    v_dataSUMCur1.NLWKMK,
                                                    v_dataSUMCur1.ADWKMK);


                  /*If v_dataSUMCur1.ISSUTYP = '4' Then
                     --    筆數  2012/07/16 Modify By ChungYu 詹小姐重新定義筆數，
                     --    若該筆受理編號該給付年月已於其他給付方式呈現過，則於後續給
                     --    付方式再次呈現時不納入統計。
                    SELECT COUNT(APNO) Into v_count
                      FROM (SELECT T3.APNO
                              FROM BAPAYRPTRECORD T3
                             WHERE T3.RPTTYP = '1'
                               AND T3.ISSUTYP = '4'
                               AND T3.ISSUYM = v_i_issuym
                               AND T3.APNO LIKE (v_i_paycode || '%')
                               AND T3.CHKDATE = v_i_chkdate
                               AND T3.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                               AND T3.BENEVTREL NOT IN ('F', 'N', 'Z')
                               AND T3.PAYTYP = v_dataSUMCur1.PAYTYP
                               AND T3.NACHGMK IS NULL
                               AND T3.NLWKMK = v_dataSUMCur1.NLWKMK
                               AND T3.ADWKMK = v_dataSUMCur1.ADWKMK
                               AND T3.APNO NOT IN (SELECT T4.APNO
                                                     FROM BAPAYRPTRECORD T4
                                                    WHERE T4.RPTTYP = '1'
                                                      AND T4.ISSUTYP = '4'
                                                      AND T4.ISSUYM = v_i_issuym
                                                      AND T4.APNO LIKE (v_i_paycode || '%')
                                                      AND T4.CHKDATE = v_i_chkdate
                                                      AND T4.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                                      AND T4.APNO = T3.APNO
                                                      AND T4.PAYYM = T3.PAYYM
                                                      AND T4.BENEVTREL NOT IN ('F', 'N', 'Z')
                                                      AND T4.PAYTYP < v_dataSUMCur1.PAYTYP)
                            GROUP BY T3.APNO, T3.PAYYM);
                  else
                    v_count := v_dataSUMCur1.DATAAMT;
                  End if;*/

                --寫入月核定撥付總表資料(遺屬)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur1.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur1.PAYTYP
                                       --,''PAYDATE
                                         ,v_dataSUMCur1.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur1.ISSUTYP
                                      -- ,CASETYP
                                         ,v_i_issuym
                                         ,''
                                         ,v_ApnoCount
                                         ,v_DataCount
                                         ,v_dataSUMCur1.ISSUEAMT
                                         ,v_dataSUMCur1.OTHERAAMT
                                         ,v_dataSUMCur1.OTHERBAMT
                                         ,v_dataSUMCur1.MITRATE
                                         ,v_dataSUMCur1.OFFSETAMT
                                         ,v_dataSUMCur1.COMPENAMT
                                         ,v_dataSUMCur1.INHERITORAMT
                                         ,v_dataSUMCur1.ITRTTAX
                                         ,v_dataSUMCur1.OTHERAMT
                                         ,v_payamt
                                         ,v_i_payseqno
                                         ,Decode(trim(v_dataSUMCur1.NACHGMK),null,fn_BA_transIssuTypSTR(v_dataSUMCur1.ISSUTYP),fn_BA_transNAChgTypSTR(v_dataSUMCur1.NACHGMK))   --備註
                                         ,v_dataSUMCur1.NLWKMK
                                         ,v_dataSUMCur1.ADWKMK
                                         ,v_dataSUMCur1.NACHGMK --普職互改註記
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;

            --月核定撥付總表資料(遺屬) 給付方式、普職互改註記分類
            for v_dataNAChgSUM in c_dataCur_NAChgSUM Loop
                v_BAPAYRPTSUM := null;

                --  v_BAPAYRPTSUM  Recode  初始化
                v_BAPAYRPTSUM.Rpttyp   := '1';
                v_BAPAYRPTSUM.Cprndate := v_dataNAChgSUM.CPRNDATE;
                v_BAPAYRPTSUM.Paytyp   := v_dataNAChgSUM.Paytyp;
                v_BAPAYRPTSUM.Chkdate  := v_dataNAChgSUM.Chkdate;
                v_BAPAYRPTSUM.Paycode  := v_i_paycode;
                v_BAPAYRPTSUM.Issutyp  := v_dataNAChgSUM.ISSUTYP;
                v_BAPAYRPTSUM.Issuym   := v_i_issuym;
                v_BAPAYRPTSUM.Proctime := to_Char(Sysdate,'YYYYMMDDHH24MISS');
                v_BAPAYRPTSUM.Payseqno := v_i_payseqno;
                v_BAPAYRPTSUM.Rptnote  := fn_BA_transIssuTypSTR(v_dataNAChgSUM.ISSUTYP);
                v_BAPAYRPTSUM.Nachgmk  := v_dataNAChgSUM.Nachgmk;
                v_BAPAYRPTSUM.Nlwkmk   := v_dataNAChgSUM.Nlwkmk;
                v_BAPAYRPTSUM.Adwkmk   := v_dataNAChgSUM.Adwkmk;
                v_BAPAYRPTSUM.UNACPAMT := v_dataNAChgSUM.UNACPAMT;
                v_BAPAYRPTSUM.COMPENAMT := 0;

                -- 取得件數
                  v_BAPAYRPTSUM.APNOAMT := fn_BA_getNAAPNOAMT(v_dataNAChgSUM.NACHGMK,
                                                              v_dataNAChgSUM.ISSUTYP,
                                                              v_dataNAChgSUM.PAYTYP,
                                                              v_dataNAChgSUM.NLWKMK,
                                                              v_dataNAChgSUM.ADWKMK);

                -- 取得筆數
                  v_BAPAYRPTSUM.DATAAMT := fn_BA_getNADATAAMT(v_dataNAChgSUM.NACHGMK,
                                                              v_dataNAChgSUM.ISSUTYP,
                                                              v_dataNAChgSUM.PAYTYP,
                                                              v_dataNAChgSUM.NLWKMK,
                                                              v_dataNAChgSUM.ADWKMK);

                -- 取得事故者各項扣減金額(紓困、另案扣減(同)、、另案扣減(他))

                  /*v_EvtDeduct := fn_BA_getEVTDEDUCT(v_dataNAChgSUM.NACHGMK,
                                                    v_dataNAChgSUM.ISSUTYP,
                                                    v_dataNAChgSUM.PAYTYP,
                                                    v_dataNAChgSUM.NLWKMK,
                                                    v_dataNAChgSUM.ADWKMK
                                                   );
            */

             /*--  續發案、結案、沖抵普職
                -- 件數
                v_BAPAYRPTSUM.APNOAMT := v_dataNAChgSUM.APNOAMT;
                -- 筆數
                v_BAPAYRPTSUM.DATAAMT := fn_BA_getNAChgDATAAMT(v_dataNAChgSUM.NACHGMK, v_dataNAChgSUM.ISSUTYP, v_dataNAChgSUM.PAYTYP);*/

                v_BAPAYRPTSUM.ISSUEAMT     := v_dataNAChgSUM.ISSUEAMT;
                v_BAPAYRPTSUM.OTHERAAMT    := v_dataNAChgSUM.OTHERAAMT; --+ v_EvtDeduct.EVTOTHERAAMT;
                v_BAPAYRPTSUM.OTHERBAMT    := v_dataNAChgSUM.OTHERBAMT; --+ v_EvtDeduct.EVTOTHERBAMT;
                v_BAPAYRPTSUM.MITRATE      := v_dataNAChgSUM.MITRATE;
                v_BAPAYRPTSUM.OFFSETAMT    := v_dataNAChgSUM.OFFSETAMT; --+ v_EvtDeduct.EVTOFFSETAMT;
                v_BAPAYRPTSUM.INHERITORAMT := v_dataNAChgSUM.INHERITORAMT;
                v_BAPAYRPTSUM.ITRTTAX      := v_dataNAChgSUM.ITRTTAX;
                v_BAPAYRPTSUM.OTHERAMT     := v_dataNAChgSUM.OTHERAMT;

                v_BAPAYRPTSUM.PAYAMT := v_BAPAYRPTSUM.ISSUEAMT - v_BAPAYRPTSUM.OTHERAAMT - v_BAPAYRPTSUM.OTHERBAMT -
                                        v_BAPAYRPTSUM.MITRATE - v_BAPAYRPTSUM.OFFSETAMT - v_BAPAYRPTSUM.INHERITORAMT -
                                        v_BAPAYRPTSUM.ITRTTAX - v_BAPAYRPTSUM.OTHERAMT; /*- v_EvtDeduct.EVTOTHERAAMT -
                                        v_EvtDeduct.EVTOTHERBAMT - v_EvtDeduct.EVTOFFSETAMT;*/

                If NVL(v_BAPAYRPTSUM.Issueamt,0) > 0 Then
                   Insert into BAPAYRPTSUM Values v_BAPAYRPTSUM;
                End If;
            end Loop;

            -- 普職互改衝抵   Recode
            for v_dataNAChgTyp in c_dataCur_NAChgTyp Loop
                v_BAPAYRPTSUM9 := null;

                for v_dataNAChgDtl in c_dataCur_NAChgDtl(v_dataNAChgTyp.NACHGMK, v_dataNAChgTyp.PAYTYP) Loop

                   --  普職互改衝抵   Recode  初始化
                   If ( v_BAPAYRPTSUM9.Rpttyp Is Null) Then
                        v_BAPAYRPTSUM9.Rpttyp := '1';
                        v_BAPAYRPTSUM9.Cprndate := v_dataNAChgDtl.CPRNDATE;

                        v_BAPAYRPTSUM9.Paytyp := v_dataNAChgDtl.Paytyp;
                        v_BAPAYRPTSUM9.Chkdate := v_dataNAChgDtl.Chkdate;
                        v_BAPAYRPTSUM9.Paycode := v_i_paycode;
                        v_BAPAYRPTSUM9.Issutyp  := '9';
                        v_BAPAYRPTSUM9.Issuym := v_i_issuym;
                        v_BAPAYRPTSUM9.Proctime := to_Char(Sysdate,'YYYYMMDDHH24MISS');
                        v_BAPAYRPTSUM9.Payseqno := v_i_payseqno;
                        v_BAPAYRPTSUM9.Nachgmk  := v_dataNAChgDtl.Nachgmk;
                        v_BAPAYRPTSUM9.Nlwkmk   := v_dataNAChgDtl.Nlwkmk;
                        v_BAPAYRPTSUM9.Adwkmk   := v_dataNAChgDtl.Adwkmk;
                        v_BAPAYRPTSUM9.UNACPAMT := 0;
                        v_BAPAYRPTSUM9.COMPENAMT := 0;

                        if SUBSTR(v_dataNAChgDtl.NACHGMK,1,1) = '1' Then
                           v_BAPAYRPTSUM9.Rptnote := '－沖普通';
                        elsif SUBSTR(v_dataNAChgDtl.NACHGMK,1,1) = '2' Then
                           v_BAPAYRPTSUM9.Rptnote := '－沖職災';
                        else
                           v_BAPAYRPTSUM9.Rptnote := '－沖加職';
                        end if;
                   End If;

                   -- 取得給付年月已核發筆數
                   Select Count(*) Into v_PayymCount From BADAPR
                    Where APNO = v_dataNAChgDtl.APNO
                      and SEQNO = v_dataNAChgDtl.SEQNO
                      And ISSUYM < v_i_issuym
                      And PAYYM = v_dataNAChgDtl.PAYYM
                      And MTESTMK = 'F'
                      And APLPAYMK = '3'
                      And APLPAYDATE Is Not Null;

                   If v_PayymCount > 0 then

                      --  普職互改沖抵
                      v_PreIssuAmt := 0;
                      v_DisAmt     := 0;
                      Select Count(*) Into v_Count FROM BADAPR T
                       WHERE T.APNO = v_dataNAChgDtl.APNO
                         AND T.SEQNO = '0000'
                         AND T.PAYYM = v_dataNAChgDtl.PAYYM
                         AND T.ISSUYM < v_i_issuym
                         AND T.PAYKIND = v_dataNAChgDtl.PAYKIND
                         AND T.MTESTMK = 'F'
                         AND T.APLPAYMK = '3'
                         AND T.APLPAYDATE IS NOT NULL;

                      If v_Count > 0 Then

                         SELECT sum(NVL(T.Befissueamt,0)) INTO v_PreIssuAmt FROM BADAPR T
                          WHERE T.APNO = v_dataNAChgDtl.APNO
                            AND T.SEQNO = v_dataNAChgDtl.SEQNO
                            AND T.PAYYM = v_dataNAChgDtl.PAYYM
                            AND T.ISSUYM = (SELECT MAX(T1.ISSUYM) FROM BADAPR T1
                                             WHERE T1.APNO = v_dataNAChgDtl.APNO
                                               AND T1.SEQNO = v_dataNAChgDtl.SEQNO
                                               AND T1.ISSUYM < v_i_issuym
                                               AND T1.PAYYM = T.PAYYM
                                               --AND T1.PAYKIND = T.PAYKIND
                                               AND T1.MTESTMK = 'F'
                                               AND T1.APLPAYMK = '3'
                                               AND T1.APLPAYDATE IS NOT NULL
                                            )
                            --AND T.PAYKIND = v_dataNAChgDtl.PAYKIND
                            AND T.MTESTMK = 'F'
                            AND T.APLPAYMK = '3'
                            AND T.APLPAYDATE IS NOT NULL;

                         -- 取得件數
                         if v_BAPAYRPTSUM9.APNOAMT is null Then
                            v_BAPAYRPTSUM9.APNOAMT := fn_BA_getNAAPNOAMT(v_dataNAChgDtl.NACHGMK,
                                                                      v_dataNAChgDtl.ISSUTYP,
                                                                      v_dataNAChgDtl.PAYTYP,
                                                                      v_dataNAChgDtl.NLWKMK,
                                                                      v_dataNAChgDtl.ADWKMK);
                         end if;

                         -- 取得筆數
                         if v_BAPAYRPTSUM9.DATAAMT is null Then
                            /*v_BAPAYRPTSUM9.DATAAMT := fn_BA_getNADATAAMT(v_dataNAChgDtl.NACHGMK,
                                                                         v_dataNAChgDtl.ISSUTYP,
                                                                         v_dataNAChgDtl.PAYTYP,
                                                                         v_dataNAChgDtl.NLWKMK,
                                                                         v_dataNAChgDtl.ADWKMK);*/
                            /*v_BAPAYRPTSUM9.DATAAMT := fn_BA_getNAChgDATAAMT_C( v_dataNAChgDtl.NACHGMK,
                                                                               v_dataNAChgDtl.ISSUTYP,
                                                                               v_dataNAChgDtl.PAYTYP  );*/
                            v_BAPAYRPTSUM9.DATAAMT := fn_BA_getNAChgDATAAMT_C( v_dataNAChgDtl.NACHGMK,
                                                                               v_dataNAChgDtl.PAYTYP  );
                         end if;

                         /*-- 件數
                         v_BAPAYRPTSUM9.APNOAMT := fn_BA_getNAChgAPNOAMT(v_dataNAChgTyp.NACHGMK, '2', v_dataNAChgDtl.PAYTYP);
                         -- 筆數
                         v_BAPAYRPTSUM9.DATAAMT := fn_BA_getNAChgDATAAMT_C(v_dataNAChgTyp.NACHGMK, '2', v_dataNAChgDtl.PAYTYP);*/

                         Select Nvl(RECAMT,0) Into v_DisAmt FROM BADAPR T
                          WHERE T.APNO = v_dataNAChgDtl.APNO
                            AND T.SEQNO = v_dataNAChgDtl.SEQNO
                            AND T.ISSUYM = v_i_issuym
                            AND T.PAYYM = v_dataNAChgDtl.PAYYM
                            AND T.MTESTMK = 'F'
                            AND T.PAYKIND = v_dataNAChgDtl.PAYKIND;

                         v_BAPAYRPTSUM9.ISSUEAMT     := Nvl(v_BAPAYRPTSUM9.ISSUEAMT,0) + v_PreIssuAmt;
                         v_BAPAYRPTSUM9.OTHERAAMT    := Nvl(v_BAPAYRPTSUM9.OTHERAAMT,0) + v_DisAmt;
                         v_BAPAYRPTSUM9.OTHERBAMT    := 0;
                         v_BAPAYRPTSUM9.MITRATE      := 0;
                         v_BAPAYRPTSUM9.OFFSETAMT    := 0;
                         v_BAPAYRPTSUM9.INHERITORAMT := 0;
                         v_BAPAYRPTSUM9.ITRTTAX      := 0;
                         v_BAPAYRPTSUM9.OTHERAMT     := 0;

                         v_BAPAYRPTSUM9.PAYAMT := v_BAPAYRPTSUM9.ISSUEAMT - v_BAPAYRPTSUM9.OTHERAAMT;
                      End if;

                   End if;
                End Loop;
                   If NVL(v_BAPAYRPTSUM9.Issueamt,0) > 0 Then
                      Insert into BAPAYRPTSUM Values v_BAPAYRPTSUM9;
                   End If;
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表(遺屬)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '月核定撥付總表(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                     sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genSUMPayRPT_1_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_1_S
        PURPOSE:         產生月核定撥付總表會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_1_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_mtestmk             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;
        v_PAYTYP           BAPAYRPTACCOUNT.PAYTYP%TYPE         := '';
        v_BENEVTREL        BAPAYRPTACCOUNT.BENEVTREL%TYPE      := '';
        v_NACHGMK          BAPAYRPTACCOUNT.NACHGMK%TYPE        := '';
        v_NLWKMK           BAPAYRPTACCOUNT.NLWKMK%TYPE         := '';
        v_ADWKMK           BAPAYRPTACCOUNT.ADWKMK%TYPE         := '';
        v_MNLWKMK          BAPAYRPTACCOUNT.NLWKMK%TYPE         := '';
        v_MADWKMK          BAPAYRPTACCOUNT.ADWKMK%TYPE         := '';
        v_tempUNACPAMT     BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;       -- 暫存扣減金額

        --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

        --月核定撥付總表(遺屬)
        Cursor c_dataCur_SUMrpt1 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額(遺屬年金)
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   NVL(SUM(INHERITORAMT), 0) AS INHERITORAMT,     -- 計息存儲金額    2017/09/08 Add by ChungYu
                   PAYTYP,                                        -- 給付方式
                   NLWKMK,                                        -- 普職註記
                   ADWKMK,                                        -- 加職註記
                   NACHGMK                                        -- 普職互改註記
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK is null
               AND PAYTYP Is Not null
             GROUP BY PAYTYP, NLWKMK, ADWKMK, NACHGMK
             ORDER BY PAYTYP, NLWKMK, ADWKMK, NACHGMK;

        --月核定撥付總表(普職互改)
        Cursor c_dataCur_SUMrptNAChg1 is
            SELECT NVL(SUM(ISSUEAMT), 0)    AS ISSUEAMT,                            -- 核定金額(遺屬年金)
                   NVL(SUM(UNACPAMT), 0)    AS UNACPAMT,                            -- 收回金額(遺屬年金)          -- 2012/08/20 Add By ChungYu
                   NVL(SUM(OTHERBAMT), 0)   AS OTHERBAMT,                           -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)   AS OFFSETAMT,                           -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)     AS MITRATE,                             -- 匯款匯費
                   NLWKMK,                                                          -- 普職註記
                   ADWKMK,                                                          -- 加職註記
                   NACHGMK,                                                         -- 普職互改註記
                   PAYTYP,                                                          -- 給付方式
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT                                --應付金額   add by 20121121 Angela
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '1'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND ISSUTYP <> '9'
           --    AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO =  v_i_payseqno
               AND NACHGMK is Not null                                              --普職互改要另外出
               AND PAYTYP Is Not null
             GROUP BY PAYTYP, NLWKMK, ADWKMK, NACHGMK
             ORDER BY PAYTYP, NLWKMK, ADWKMK, NACHGMK;

         --其他應收款(另案扣減同保險)
         Cursor c_dataCur_OTHERAAMT is
                SELECT T.MPAYTYP,
                       T.DISPAYKIND,
                       T.MNLWKMK,
                       T.MADWKMK,
                       T.NLWKMK,
                       T.ADWKMK,
                       SUM(T.DISAMT) AS DISAMT
                  FROM
                (SELECT SUBSTR(T1.MAPNO, 1, 1) AS MPAYTYP,                            --  (扣前期)取得應收未收檔普職註記及加值註記的另案扣減金額
                       T3.PAYKIND AS DISPAYKIND,
                       T3.NLWKMK AS MNLWKMK,
                       T3.ADWKMK AS MADWKMK,
                       T1.NLWKMK,
                       T1.ADWKMK,
                       SUM(T1.DISAMT) AS DISAMT
                  FROM BACUTREC T1, (SELECT T21.APNO,
                                            T21.SEQNO,                                              --  2013/08/27 Add By ChungYu
                                            T21.ISSUYM,
                                            T21.PAYYM,
                                            T21.PAYKIND,
                                            T21.NACHGMK
                                       FROM BAPAYRPTRECORD T21
                                      WHERE T21.RPTTYP = '1'
                                        AND T21.APNO LIKE (v_i_paycode||'%')
                                        AND T21.ISSUYM = v_i_issuym
                                        AND T21.CHKDATE = v_i_chkdate
                                        AND T21.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                        AND T21.PAYTYP = v_PAYTYP
                                        AND T21.OTHERAAMT > 0
                                        AND T21.PAYSEQNO = v_i_payseqno
                                        AND NVL(T21.NACHGMK,'00') = NVL(v_NACHGMK,'00')
                                        AND NVL(T21.NLWKMK ,'0') = NVL(v_NLWKMK,'0')
                                        AND NVL(T21.ADWKMK ,'0') = NVL(v_ADWKMK,'0')
                                        ) T2,
                                    (Select T31.BAUNACPDTLID,
                                            T31.PAYKIND,
                                            T31.NLWKMK,
                                            T31.ADWKMK
                                       From BAUNACPDTL T31
                                      WHERE T31.BAUNACPDTLID IN (SELECT T32.RECSEQ FROM BACUTREC T32
                                                                  WHERE T32.APNO LIKE (v_i_paycode||'%')
                                                                    AND T32.ISSUYM = v_i_issuym
                                                                    AND T32.MTESTMK = 'F'
                                                                )
                                    ) t3
                 WHERE T1.APNO LIKE (v_i_paycode||'%')
                   AND T1.ISSUYM = v_i_issuym
                   AND T1.MTESTMK = 'F'
                   AND T1.APNO = T2.APNO
                   AND T1.SEQNO = T2.SEQNO                                                          --  2013/08/27 Add By ChungYu
                   AND (( T1.APNO <> T1.MAPNO AND T2.NACHGMK IS Not NULL) Or T2.NACHGMK IS NULL)
                   AND T1.ISSUYM = T2.ISSUYM
                   AND T1.PAYYM = T2.PAYYM
                   AND T1.PAYKIND = T2.PAYKIND
                   AND T1.RECSEQ IS NOT NULL
                   AND T1.RECSEQ = T3.BAUNACPDTLID(+)
                 GROUP BY SUBSTR(T1.MAPNO, 1, 1), T3.PAYKIND, T3.NLWKMK, T3.ADWKMK, T1.NLWKMK, T1.ADWKMK
                UNION
                SELECT SUBSTR(T1.MAPNO, 1, 1) AS MPAYTYP,                             --  (扣本期)取得扣減紀錄檔普職註記及加值註記的另案扣減金額
                       DISPAYKIND,
                       MNLWKMK,
                       MADWKMK,
                       NLWKMK,
                       ADWKMK,
                       SUM(T1.DISAMT) AS DISAMT
                  FROM BACUTREC T1, (SELECT T21.APNO,
                                            T21.SEQNO,                                              --  2013/08/27 Add By ChungYu
                                            T21.ISSUYM,
                                            T21.PAYYM,
                                            T21.PAYKIND,
                                            T21.NACHGMK
                                       FROM BAPAYRPTRECORD T21
                                      WHERE T21.RPTTYP = '1'
                                        AND T21.APNO LIKE (v_i_paycode||'%')
                                        AND T21.ISSUYM = v_i_issuym
                                        AND T21.CHKDATE = v_i_chkdate
                                        AND T21.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                        AND T21.PAYTYP = v_PAYTYP
                                        AND T21.OTHERAAMT > 0
                                        AND T21.PAYSEQNO = v_i_payseqno
                                        AND NVL(T21.NACHGMK,'00') = NVL(v_NACHGMK,'00')
                                        AND NVL(T21.NLWKMK ,'0') = NVL(v_NLWKMK,'0')
                                        AND NVL(T21.ADWKMK ,'0') = NVL(v_ADWKMK,'0')
                                        ) T2
                 WHERE T1.APNO LIKE (v_i_paycode||'%')
                   AND T1.ISSUYM = v_i_issuym
                   AND T1.MTESTMK = 'F'
                   AND T1.APNO = T2.APNO
                   AND T1.SEQNO = T2.SEQNO                                                          --  2013/08/27 Add By ChungYu
                   AND (( T1.APNO <> T1.MAPNO AND T2.NACHGMK IS Not NULL) Or T2.NACHGMK IS NULL)
                   AND T1.ISSUYM = T2.ISSUYM
                   AND T1.PAYYM = T2.PAYYM
                   AND T1.PAYKIND = T2.PAYKIND
                   AND T1.RECSEQ IS NULL
                 GROUP BY SUBSTR(T1.MAPNO, 1, 1), DISPAYKIND, MNLWKMK, MADWKMK, NLWKMK, ADWKMK  ) T
                 GROUP BY T.MPAYTYP, T.DISPAYKIND, T.MNLWKMK, T.MADWKMK, T.NLWKMK, T.ADWKMK
                 ORDER BY T.MPAYTYP, T.DISPAYKIND, T.MNLWKMK, T.MADWKMK, T.NLWKMK, T.ADWKMK;

        --月核定撥付總表(遺屬_普職互改)要計算年金本期沖抵前期金額
      Cursor c_NAChgPreCase ( v_NACHGMK VARCHAR2, v_PAYTYP VARCHAR2 ) is

        SELECT NVL(SUM(T2.DISAMT), 0) As "DISAMT",
                   T2.NLWKMK,
                   T2.ADWKMK,
                   T2.DISPAYKIND
              FROM (SELECT Distinct T11.APNO
                      FROM BAPAYRPTRECORD T11
                     WHERE T11.RPTTYP = '1'
                       AND T11.APNO LIKE (v_i_paycode || '%')
                       AND T11.SEQNO = '0000'
                       AND T11.ISSUYM = v_i_issuym
                       AND T11.CHKDATE = v_i_chkdate
                       AND T11.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                       AND PAYTYP = v_PAYTYP
                       AND T11.PAYSEQNO = v_i_payseqno
                       AND T11.NACHGMK = v_NACHGMK) T1,
                   (SELECT T21.APNO,
                           T21.MAPNO,
                           T21.SEQNO,
                           T21.ISSUYM,
                           T21.MPAYYM,
                           T21.DISPAYKIND,
                           T21.DISAMT,
                           T21.NLWKMK,
                           T21.ADWKMK
                      FROM BACUTREC T21
                     WHERE T21.APNO LIKE (v_i_paycode || '%')
                        AND T21.SEQNO = '0000'
                        AND T21.ISSUYM = v_i_issuym
                        AND T21.MISSUYM < v_i_issuym
                        AND T21.MTESTMK = 'F'
                        AND T21.NACHGMK = v_NACHGMK) T2
             WHERE T1.APNO = T2.APNO
               AND T1.APNO = T2.MAPNO
          GROUP BY T2.DISPAYKIND, T2.NLWKMK, T2.ADWKMK;

       --月核定撥付總表(遺屬_普職互改)要分別計算年金沖抵本期金額
        function fn_NAChgCase
        (
           v_PAYTYP   in  VARCHAR2,
           v_NACHGMK  in  VARCHAR2
         ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
            SELECT NVL(SUM(T2.DISAMT),0) Into v_tmpCount FROM
                                  (SELECT T11.APNO,
                                          T11.SEQNO,
                                          T11.ISSUYM,
                                          T11.PAYYM,
                                          T11.PAYKIND
                                     FROM BAPAYRPTRECORD T11
                                    WHERE T11.RPTTYP = '1'
                                      AND T11.APNO LIKE (v_i_paycode || '%')
                                 --     AND T11.SEQNO = '0000'
                                      AND T11.ISSUYM = v_i_issuym
                                      AND T11.CHKDATE = v_i_chkdate
                                      AND T11.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                      AND T11.PAYTYP = v_PAYTYP
                                      AND T11.PAYSEQNO = v_i_payseqno
                                      AND T11.NACHGMK = v_NACHGMK
                                      ) T1,
                                  (SELECT T21.APNO,
                                          T21.MAPNO,
                                          T21.SEQNO,
                                          T21.ISSUYM,
                                          T21.MPAYYM,
                                          T21.DISPAYKIND,
                                          T21.DISAMT
                                     FROM BACUTREC T21
                                    WHERE T21.APNO LIKE (v_i_paycode || '%')
                                 --     AND T21.SEQNO = '0000'
                                      AND T21.ISSUYM = v_i_issuym
                                      AND T21.MISSUYM = v_i_issuym
                                      AND T21.MTESTMK = v_i_mtestmk
                                      AND T21.NACHGMK = v_NACHGMK
                                     ) T2
           WHERE T1.APNO    = T2.APNO
             AND T1.APNO    = T2.MAPNO
             AND T1.SEQNO   = T2.SEQNO
             AND T1.ISSUYM  = T2.ISSUYM
             AND T1.PAYYM   = T2.MPAYYM
             AND T1.PAYKIND = T2.DISPAYKIND;

           return v_tmpCount;
        end;

       --月核定撥付總表(遺屬_普職互改)要計算遺屬年金已領金額
        function fn_NAChgPreAmt
        (
           v_PAYTYP   in  VARCHAR2,
           v_NACHGMK  in  VARCHAR2
         ) return Number
        as
            v_tmpCount       Number;
        begin
            v_tmpCount := 0;
        SELECT SUM(T.BEFISSUEAMT) Into v_tmpCount FROM BADAPR T
                         WHERE T.APNO IN (SELECT DISTINCT T1.APNO FROM BAPAYRPTRECORD T1
                                           WHERE T1.RPTTYP = '1'
                                             AND T1.ISSUYM = v_i_issuym
                                             AND T1.APNO LIKE (v_i_paycode || '%')
                                             AND T1.CHKDATE = v_i_chkdate
                                             AND T1.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                                             AND T1.PAYSEQNO = v_i_payseqno
                                             AND T1.PAYTYP = v_PAYTYP
                                             AND T1.PAYTYP = v_PAYTYP
                                             AND T1.NACHGMK = v_NACHGMK)
                           AND T.SEQNO <> '0000'
                           AND T.ISSUYM = (SELECT MAX(T2.ISSUYM) FROM BADAPR T2
                                            WHERE T2.APNO = T.APNO
                                              AND T2.SEQNO = T.SEQNO
                                              AND T2.ISSUYM < v_i_issuym
                                              AND T2.MTESTMK = 'F'
                                              AND T2.APLPAYMK = '3'
                                              AND TRIM(T2.APLPAYDATE) IS NOT NULL
                                              AND T2.PAYYM = T.PAYYM)
                           AND T.MTESTMK = 'F'
                           AND DECODE(T.PAYTYP,'2','1',T.PAYTYP) = v_PAYTYP
                           AND T.APLPAYMK = '3'
                           AND TRIM(T.APLPAYDATE) IS NOT NULL;
           return v_tmpCount;
        end;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_1_S';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --月核定撥付總表資料(遺屬)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                for i in 1..6 LOOP
--                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ     := 1;
                    v_tmpAMT         := 0;     -- add by ChungYu 2017/12/26 修正遺屬國外及大陸匯款會計科目重覆

                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur1.ISSUEAMT;
                        if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                            v_ACCOUNTNO   := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                            v_ACCOUNTNAME := '保險給付－普通－本人死亡給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '1') then
                            v_ACCOUNTNO   := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                            v_ACCOUNTNAME := '保險給付－職災－本人死亡給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '2') then
                            v_ACCOUNTNO   := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                            v_ACCOUNTNAME := '保險給付－加職－本人死亡給付（年金）';
                        end if;

                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO        := '';
                        if (v_dataSUMCur1.Paytyp = '4') then
                            v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                            v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                        else
                            v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                        end if;

                        v_ACTTITLEAPCODE     := 'ABA';
                        v_DATACD             := '1';
                        v_DECIDEAMT          := v_dataSUMCur1.ISSUEAMT-v_dataSUMCur1.OTHERBAMT
                                               -v_dataSUMCur1.OFFSETAMT-v_dataSUMCur1.MITRATE;
                        v_CASHAMT            := v_dataSUMCur1.PAYAMT;
                        v_CUTAMT             := 0;
                        v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                        v_ACCOUNTTOPFMK      := 'Y';

                        select nvl(Sum(t.APNOAMT),0) into v_CNT
                          from BAPAYRPTSUM t
                         where t.RPTTYP = '1'
                           and t.ISSUYM = v_i_issuym
                           and t.PAYCODE = v_i_paycode
                           and t.CHKDATE = v_i_chkdate
                           and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                           and t.PAYSEQNO = v_i_payseqno
                           and nvl(t.PAYTYP,' ') = v_dataSUMCur1.PAYTYP
                           and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                           and t.ISSUTYP <> '9'
                           and nvl(t.NACHGMK,' ') = nvl(v_dataSUMCur1.NACHGMK,' ')
                           and nvl(t.NLWKMK,' ') = nvl(v_dataSUMCur1.NLWKMK,' ')
                           and nvl(t.ADWKMK,' ') = nvl(v_dataSUMCur1.ADWKMK,' ');
                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                        if (v_dataSUMCur1.Paytyp = '4') then
                            v_ACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                            v_ACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                        else
                            v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                        end if;
                        v_tmpAMT      := v_dataSUMCur1.PAYAMT;

                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                        --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 3 then
                        v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（另案扣減他保險）';
                        v_tmpAMT      := v_dataSUMCur1.OTHERBAMT;

                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '另案扣減他保險';

                        if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                            v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                            v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '1') then
                            v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                            v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '2') then
                            v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                            v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                        end if;

                        v_ACTTITLEAPCODE := 'ABA';
                        v_DATACD         := 'A';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := v_tmpAMT;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '9';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 4 then
                        v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（紓困）';
                        v_tmpAMT      := v_dataSUMCur1.OFFSETAMT;

                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '紓困';

                        if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                            v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                            v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '1') then
                            v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                            v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                        elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '2') then
                            v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                            v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                        end if;

                        v_ACTTITLEAPCODE := 'ABA';
                        v_DATACD         := 'F';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := v_tmpAMT;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '3';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 5 then
                        v_ACCOUNTNO   := '';
                        v_ACCOUNTNAME := '';
                        v_tmpAMT      := 0;

                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                        if (v_dataSUMCur1.Paytyp = '5' or v_dataSUMCur1.Paytyp = '6') then
                            v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                            v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（國外匯款之手續費）';
                            v_tmpAMT      := v_dataSUMCur1.MITRATE;

                            --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                            v_ACCOUNTMEMO    := '國外匯款之手續費';

                            if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                                v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '1') then
                                v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                                v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                            elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '2') then
                                v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                                v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                            end if;

                            v_ACTTITLEAPCODE := 'ABA';
                            v_DATACD         := 'H';
                            v_DECIDEAMT      := v_tmpAMT;
                            v_CASHAMT        := v_tmpAMT;
                            v_CUTAMT         := 0;
                            v_ACCEPTPAYTYPE  := 'H';
                            v_CNT            := 0;
                            v_ACCOUNTTOPFMK  := 'Y';
                            --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                        end if;
                    --以下計息存儲新增  add by ChungYu 2017/09/08 Start-->
                    elsif i = 6 then
                        if ( v_dataSUMCur1.Paytyp = '3' ) then
                           v_ACCOUNTNO   := '111212  00530 0';
                           v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（保留遺屬津貼年金）';
                           v_tmpAMT      := v_dataSUMCur1.INHERITORAMT;

                           v_ACCOUNTMEMO    := '保留遺屬津貼年金';

                           if (v_dataSUMCur1.Nlwkmk is null or v_dataSUMCur1.Nlwkmk = '1') then
                               v_OPPACCOUNTNO      := '5171121 11054 A';
                               v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                           elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '1') then
                               v_OPPACCOUNTNO      := '5171122 11054 4';
                               v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                           elsif (v_dataSUMCur1.Nlwkmk = '2' and v_dataSUMCur1.Adwkmk = '2') then
                               v_OPPACCOUNTNO      := '5171122 12054 5';
                               v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                           end if;

                           v_ACTTITLEAPCODE := 'AQE';
                           v_DATACD         := '4';
                           v_DECIDEAMT      := 0;             -- Modify By ChugnYu 2017/12/26 避免計息存儲轉入PFD金額重覆
                           v_CASHAMT        := v_tmpAMT;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '3';
                           v_CNT            := 0;
                           v_ACCOUNTTOPFMK  := 'Y';
                        --add by ChungYu 2017/09/08 計息存儲  End-->
                        end if;
                    end if;

                    --寫入月核定撥付總表會計科目資料(借：保險給付，貸：銀行存款)(遺屬)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121121
                                                    ,OPPACCOUNTNO      --add by Angela 20121121
                                                    ,OPPACCOUNTNAME    --add by Angela 20121121
                                                    ,ACTTITLEAPCODE    --add by Angela 20121121
                                                    ,DATACD            --add by Angela 20121121
                                                    ,DECIDEAMT         --add by Angela 20121121
                                                    ,CASHAMT           --add by Angela 20121121
                                                    ,CUTAMT            --add by Angela 20121121
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121121
                                                    ,CNT               --add by Angela 20121121
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (
                                                     '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_dataSUMCur1.NLWKMK
                                                     ,v_dataSUMCur1.ADWKMK
                                                     ,''
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121121
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121121
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121121
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121121
                                                     ,v_DATACD            --add by Angela 20121121
                                                     ,v_DECIDEAMT         --add by Angela 20121121
                                                     ,v_CASHAMT           --add by Angela 20121121
                                                     ,v_CUTAMT            --add by Angela 20121121
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121121
                                                     ,v_CNT               --add by Angela 20121121
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --寫入月核定撥付總表會計科目資料(貸：其他應收款)(遺屬)
                v_PAYTYP := v_dataSUMCur1.PAYTYP;
                v_BENEVTREL := '1';
                v_NACHGMK := v_dataSUMCur1.NACHGMK;
                v_NLWKMK := v_dataSUMCur1.NLWKMK;
                v_ADWKMK := v_dataSUMCur1.ADWKMK;
                for v_dataCur_OTHERAAMT in c_dataCur_OTHERAAMT Loop
                    v_ACCOUNTSEQ  := 1;
                    v_tmpAMT      := v_dataCur_OTHERAAMT.Disamt;
                    v_MNLWKMK     := NVL(v_dataCur_OTHERAAMT.Mnlwkmk,v_dataCur_OTHERAAMT.Nlwkmk);
                    v_MADWKMK     := NVL(v_dataCur_OTHERAAMT.Madwkmk,v_dataCur_OTHERAAMT.Adwkmk);
--                    v_count       := v_count + 1;
                    v_ACCOUNTNAME := '其他應收款－';

                    if v_dataCur_OTHERAAMT.Mpaytyp = 'L' then
                       v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－老年給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '1' or trim(v_MNLWKMK) is null) and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_MNLWKMK = '1' or trim(v_MNLWKMK) is null)  then
                           v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '1')  then
                           v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_MNLWKMK = '2' and v_MADWKMK = '2')  then
                           v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－本人死亡給付（遺屬年金）';
                    end if;

                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_dataSUMCur1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121121
                                                    ,OPPACCOUNTNO      --add by Angela 20121121
                                                    ,OPPACCOUNTNAME    --add by Angela 20121121
                                                    ,ACTTITLEAPCODE    --add by Angela 20121121
                                                    ,DATACD            --add by Angela 20121121
                                                    ,DECIDEAMT         --add by Angela 20121121
                                                    ,CASHAMT           --add by Angela 20121121
                                                    ,CUTAMT            --add by Angela 20121121
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121121
                                                    ,CNT               --add by Angela 20121121
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_dataSUMCur1.NLWKMK
                                                     ,v_dataSUMCur1.ADWKMK
                                                     ,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121121
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121121
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121121
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121121
                                                     ,v_DATACD            --add by Angela 20121121
                                                     ,v_DECIDEAMT         --add by Angela 20121121
                                                     ,v_CASHAMT           --add by Angela 20121121
                                                     ,v_CUTAMT            --add by Angela 20121121
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121121
                                                     ,v_CNT               --add by Angela 20121121
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;
            end Loop;

            --月核定撥付總表資料(普職互改)
            for v_SUMrptNAChg1 in c_dataCur_SUMrptNAChg1 Loop
                v_count     := 0;
                v_g_genFlag := 1;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';
                v_PAYTYP := v_SUMrptNAChg1.PAYTYP;

                --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                for i in 1..7 LOOP
                    v_ACCOUNTSEQ  := 1;
                    v_tmpAMT := 0;
                    v_ACCOUNTNO := '';
                    v_ACCOUNTNAME := '';

                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    if i = 1 then
                       v_ACCOUNTSEQ   := 0;
                       v_tmpAMT       := v_SUMrptNAChg1.ISSUEAMT;
                       if (v_SUMrptNAChg1.Nlwkmk is null or v_SUMrptNAChg1.Nlwkmk = '1') then
                            v_ACCOUNTNO   := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                            v_ACCOUNTNAME := '保險給付－普通－本人死亡給付（年金）';
                       elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '1') then
                            v_ACCOUNTNO   := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                            v_ACCOUNTNAME := '保險給付－職災－本人死亡給付（年金）';
                       elsif (v_SUMrptNAChg1.Nlwkmk = '2' And v_SUMrptNAChg1.Adwkmk = '2') then
                            v_ACCOUNTNO   := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                            v_ACCOUNTNAME := '保險給付－加職－本人死亡給付（年金）';
                       end if;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       if (v_SUMrptNAChg1.Paytyp = '4') then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADA';
                       v_DATACD             := '1';
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_DECIDEAMT          := v_SUMrptNAChg1.ISSUEAMT-v_SUMrptNAChg1.OTHERBAMT
                                              -v_SUMrptNAChg1.OFFSETAMT-v_SUMrptNAChg1.MITRATE;
                       --Modify by Angela 20140917 計算應付金額時，需扣除已領金額
                       --v_CASHAMT            := v_SUMrptNAChg1.PAYAMT
                       v_CASHAMT            := v_SUMrptNAChg1.PAYAMT-fn_NAChgPreAmt(v_SUMrptNAChg1.PAYTYP,v_SUMrptNAChg1.NACHGMK);
                       v_CUTAMT             := 0;
                       v_CNT                := 0;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_SUMrptNAChg1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP <> '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_SUMrptNAChg1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_SUMrptNAChg1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_SUMrptNAChg1.ADWKMK,' ');
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_ACCOUNTSEQ   := 0;
                       v_tempUNACPAMT := fn_NAChgCase( v_SUMrptNAChg1.PAYTYP, v_SUMrptNAChg1.NACHGMK);
                       v_tmpAMT := v_SUMrptNAChg1.UNACPAMT - v_tempUNACPAMT;
                       if ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                           v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';

                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                           v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                       elsif (SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2') then
                           v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';

                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                           v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                       elsif (SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3') then
                           v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';

                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                           v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->
                       end if;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := '';
                       v_ACTTITLEAPCODE     := 'FFG';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_CNT                := 0;
                       v_ACCOUNTTOPFMK      := 'Y';
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 3 then
                       SELECT SUM(DECODE(T.ISSUTYP,'9',-T.PAYAMT, T.PAYAMT)) Into v_tmpAMT
                         FROM BAPAYRPTSUM T
                        WHERE T.RPTTYP = '1'
                          AND T.PAYTYP = v_SUMrptNAChg1.PAYTYP
                          AND T.PAYCODE = v_i_paycode
                          AND T.ISSUYM = v_i_issuym
                          AND T.NACHGMK = v_SUMrptNAChg1.NACHGMK;

                       if (v_SUMrptNAChg1.Paytyp = '4') then
                           v_ACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_ACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 4 then
                       v_tmpAMT       := fn_NAChgPreAmt( v_SUMrptNAChg1.PAYTYP, v_SUMrptNAChg1.NACHGMK);
                       if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                             v_ACCOUNTNO   := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                             v_ACCOUNTNAME := '保險給付－普通－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                             v_ACCOUNTNO   := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                             v_ACCOUNTNAME := '保險給付－職災－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                             v_ACCOUNTNO   := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                             v_ACCOUNTNAME := '保險給付－加職－本人死亡給付（年金）';
                       end if;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := fn_BA_transNAChgTypSTR(v_SUMrptNAChg1.NACHGMK);
                       if v_PAYTYP = '4' then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADC';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_SUMrptNAChg1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP = '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_SUMrptNAChg1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_SUMrptNAChg1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_SUMrptNAChg1.ADWKMK,' ');
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 5 then
                       v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（另案扣減他保險）';
                       v_tmpAMT      := v_SUMrptNAChg1.OTHERBAMT;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '另案扣減他保險';

                       --Modify by 20150427 Angela 若為普職互改，則帳需掛至新案上。
                       /**
                       if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                             v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                             v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                             v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                             v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                             v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                             v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                       end if;
                       **/
                       if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '1' ) then
                             v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                             v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '2' ) then
                             v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                             v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '3' ) then
                             v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                             v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                       end if;

                       v_ACTTITLEAPCODE := 'ADA';
                       v_DATACD         := 'A';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := v_tmpAMT;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '9';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 6 then
                       v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（紓困）';
                       v_tmpAMT      := v_SUMrptNAChg1.OFFSETAMT;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '紓困';

                       --Modify by 20150427 Angela 若為普職互改，則帳需掛至新案上。
                       /**
                       if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                             v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                             v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                             v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                             v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                             v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                             v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                       end if;
                       **/
                       if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '1' ) then
                             v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                             v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '2' ) then
                             v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                             v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '3' ) then
                             v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                             v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                       end if;

                       v_ACTTITLEAPCODE := 'ADA';
                       v_DATACD         := 'F';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := v_tmpAMT;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '3';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 7 then
                       v_ACCOUNTNO   := '';
                       v_ACCOUNTNAME := '';
                       v_tmpAMT      := 0;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                       if (v_SUMrptNAChg1.Paytyp = '5' or v_SUMrptNAChg1.Paytyp = '6') then
                           v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（國外匯款之手續費）';
                           v_tmpAMT      := v_SUMrptNAChg1.MITRATE;

                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '國外匯款之手續費';

                           --Modify by 20150427 Angela 若為普職互改，則帳需掛至新案上。
                           /**
                           if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                                 v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                                 v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                           elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                                 v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                                 v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                           elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                                 v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                                 v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                           end if;
                           **/
                           if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '1' ) then
                                 v_OPPACCOUNTNO      := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                                 v_OPPACCOUNTNAME    := '保險給付－普通－本人死亡給付（年金）';
                           elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '2' ) then
                                 v_OPPACCOUNTNO      := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                                 v_OPPACCOUNTNAME    := '保險給付－職災－本人死亡給付（年金）';
                           elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,2,1) = '3' ) then
                                 v_OPPACCOUNTNO      := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                                 v_OPPACCOUNTNAME    := '保險給付－加職－本人死亡給付（年金）';
                           end if;

                           v_ACTTITLEAPCODE := 'ADA';
                           v_DATACD         := 'H';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := v_tmpAMT;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := 'H';
                           v_CNT            := 0;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->
                       end if;
                    end if;

                    --寫入月核定撥付總表會計科目資料(借：保險給付)(遺屬普職互改)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121121
                                                    ,OPPACCOUNTNO      --add by Angela 20121121
                                                    ,OPPACCOUNTNAME    --add by Angela 20121121
                                                    ,ACTTITLEAPCODE    --add by Angela 20121121
                                                    ,DATACD            --add by Angela 20121121
                                                    ,DECIDEAMT         --add by Angela 20121121
                                                    ,CASHAMT           --add by Angela 20121121
                                                    ,CUTAMT            --add by Angela 20121121
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121121
                                                    ,CNT               --add by Angela 20121121
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (
                                                     '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121121
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121121
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121121
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121121
                                                     ,v_DATACD            --add by Angela 20121121
                                                     ,v_DECIDEAMT         --add by Angela 20121121
                                                     ,v_CASHAMT           --add by Angela 20121121
                                                     ,v_CUTAMT            --add by Angela 20121121
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121121
                                                     ,v_CNT               --add by Angela 20121121
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                --寫入月核定撥付總表會計科目資料(貸：保險給付)(遺屬普職互改)
                v_PAYTYP := v_SUMrptNAChg1.PAYTYP;
                v_NLWKMK := v_SUMrptNAChg1.NLWKMK;
                v_ADWKMK := v_SUMrptNAChg1.ADWKMK;

                --另案扣減同保險_非同案件(扣他案)(普職互改)
                v_BENEVTREL := '1';
                v_NACHGMK := v_SUMrptNAChg1.NACHGMK;
                for v_dataCur_OTHERAAMT in c_dataCur_OTHERAAMT Loop
                    v_ACCOUNTSEQ  := 1;
                    v_tmpAMT      := v_dataCur_OTHERAAMT.Disamt;
                    v_ACCOUNTNAME := '其他應收款－';

                    if v_dataCur_OTHERAAMT.Mpaytyp = 'L' then
                       v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－老年給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '1' or trim(v_dataCur_OTHERAAMT.Mnlwkmk) is null) and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind <> '37')  then
                           v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－失能給付（年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'K' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  and
                          (v_dataCur_OTHERAAMT.Dispaykind = '37')  then
                           v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－失能給付（補償金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '1' or trim(v_dataCur_OTHERAAMT.Mnlwkmk) is null)  then
                           v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'普通－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '1')  then
                           v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'職災－本人死亡給付（遺屬年金）';
                    elsif  v_dataCur_OTHERAAMT.Mpaytyp = 'S' and
                          (v_dataCur_OTHERAAMT.Mnlwkmk = '2' and v_dataCur_OTHERAAMT.Madwkmk = '2')  then
                           v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := v_ACCOUNTNAME||'加職－本人死亡給付（遺屬年金）';
                    end if;

                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121121
                                                    ,OPPACCOUNTNO      --add by Angela 20121121
                                                    ,OPPACCOUNTNAME    --add by Angela 20121121
                                                    ,ACTTITLEAPCODE    --add by Angela 20121121
                                                    ,DATACD            --add by Angela 20121121
                                                    ,DECIDEAMT         --add by Angela 20121121
                                                    ,CASHAMT           --add by Angela 20121121
                                                    ,CUTAMT            --add by Angela 20121121
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121121
                                                    ,CNT               --add by Angela 20121121
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121121
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121121
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121121
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121121
                                                     ,v_DATACD            --add by Angela 20121121
                                                     ,v_DECIDEAMT         --add by Angela 20121121
                                                     ,v_CASHAMT           --add by Angela 20121121
                                                     ,v_CUTAMT            --add by Angela 20121121
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121121
                                                     ,v_CNT               --add by Angela 20121121
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;

                /*--另案扣減同保險_同案件(普職互改本案衝抵衝本期)(普職互改)
                for i in 1..2 LOOP
                    v_ACCOUNTSEQ  := 1;
                    v_tmpAMT      := 0;
                    v_ACCOUNTNO := '';
                    v_ACCOUNTNAME := '';
                    if i = 1 then
                           SELECT SUM(DECODE(T.ISSUTYP,'9',-T.PAYAMT, T.PAYAMT)) Into v_tmpAMT
                             FROM BAPAYRPTSUM T
                            WHERE T.RPTTYP = '1'
                              AND T.PAYTYP = v_SUMrptNAChg1.PAYTYP
                              AND T.PAYCODE = v_i_paycode
                              AND T.ISSUYM = v_i_issuym
                              AND T.NACHGMK = v_SUMrptNAChg1.NACHGMK;

                       if (v_SUMrptNAChg1.Paytyp = '4') then
                           v_ACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_ACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_tmpAMT       := fn_NAChgPreAmt( v_SUMrptNAChg1.PAYTYP, v_SUMrptNAChg1.NACHGMK);
                       if  ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '1' ) then
                             v_ACCOUNTNO   := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                             v_ACCOUNTNAME := '保險給付－普通－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '2' ) then
                             v_ACCOUNTNO   := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                             v_ACCOUNTNAME := '保險給付－職災－本人死亡給付（年金）';
                       elsif ( SUBSTR(v_SUMrptNAChg1.NACHGMK,1,1) = '3' ) then
                             v_ACCOUNTNO   := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                             v_ACCOUNTNAME := '保險給付－加職－本人死亡給付（年金）';
                       end if;

                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO        := fn_BA_transNAChgTypSTR(v_SUMrptNAChg1.NACHGMK);
                       if v_PAYTYP = '4' then
                           v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                           v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                       else
                           v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                           v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       end if;

                       v_ACTTITLEAPCODE     := 'ADC';
                       v_DATACD             := '5';
                       v_DECIDEAMT          := v_tmpAMT;
                       v_CASHAMT            := 0;
                       v_CUTAMT             := v_tmpAMT;
                       v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                       v_ACCOUNTTOPFMK      := 'Y';

                       select nvl(Sum(t.APNOAMT),0) into v_CNT
                         from BAPAYRPTSUM t
                        where t.RPTTYP = '1'
                          and t.ISSUYM = v_i_issuym
                          and t.PAYCODE = v_i_paycode
                          and t.CHKDATE = v_i_chkdate
                          and t.CPRNDATE = v_i_cprndt    --add by Angela 20130731
                          and t.PAYSEQNO = v_i_payseqno
                          and nvl(t.PAYTYP,' ') = v_SUMrptNAChg1.PAYTYP
                          and nvl(t.BENEVTREL,'1') = nvl(v_BENEVTREL,'1')
                          and t.ISSUTYP = '9'
                          and nvl(t.NACHGMK,' ') = nvl(v_SUMrptNAChg1.NACHGMK,' ')
                          and nvl(t.NLWKMK,' ') = nvl(v_SUMrptNAChg1.NLWKMK,' ')
                          and nvl(t.ADWKMK,' ') = nvl(v_SUMrptNAChg1.ADWKMK,' ');
                       --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入月核定撥付總表會計科目資料(貸：保險給付)(遺屬普職互改)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121121
                                                    ,OPPACCOUNTNO      --add by Angela 20121121
                                                    ,OPPACCOUNTNAME    --add by Angela 20121121
                                                    ,ACTTITLEAPCODE    --add by Angela 20121121
                                                    ,DATACD            --add by Angela 20121121
                                                    ,DECIDEAMT         --add by Angela 20121121
                                                    ,CASHAMT           --add by Angela 20121121
                                                    ,CUTAMT            --add by Angela 20121121
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121121
                                                    ,CNT               --add by Angela 20121121
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121121
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121121
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121121
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121121
                                                     ,v_DATACD            --add by Angela 20121121
                                                     ,v_DECIDEAMT         --add by Angela 20121121
                                                     ,v_CASHAMT           --add by Angela 20121121
                                                     ,v_CUTAMT            --add by Angela 20121121
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121121
                                                     ,v_CNT               --add by Angela 20121121
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;*/

                --  分別計算遺屬年金本期沖抵前期金額
                for v_NAChgPreCase in c_NAChgPreCase(v_SUMrptNAChg1.NACHGMK, v_SUMrptNAChg1.PAYTYP) LOOP
                    v_ACCOUNTSEQ  := 1;
                    --v_tmpAMT      := 0;
                    v_ACCOUNTNO   := '';
                    v_ACCOUNTNAME := '';
                    v_tmpAMT := v_NAChgPreCase.Disamt;

                    if ( v_NAChgPreCase.Nlwkmk = '1' ) then
                           v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                    elsif (v_NAChgPreCase.Nlwkmk = '2' And v_NAChgPreCase.Adwkmk = '1') then
                           v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                    elsif (v_NAChgPreCase.Nlwkmk = '2' And v_NAChgPreCase.Adwkmk = '2') then
                           v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                    end if;

                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO        := '另案扣減';
                    if v_PAYTYP = '4' then
                        v_OPPACCOUNTNO   := '111212  7002  3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  7002  6)
                        v_OPPACCOUNTNAME := '銀行存款－郵政劃撥儲金5009311-1帳戶';
                    else
                        v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                        v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    end if;

                    v_ACTTITLEAPCODE     := 'GGC';
                    v_DATACD             := '3';
                    v_DECIDEAMT          := v_tmpAMT;
                    v_CASHAMT            := 0;
                    v_CUTAMT             := v_tmpAMT;
                    v_ACCEPTPAYTYPE      := v_SUMrptNAChg1.PAYTYP;
                    v_CNT                := 0;
                    v_ACCOUNTTOPFMK      := 'Y';
                    --add by Angela 20121121 回寫PFM&PFD時所需資訊 End-->

                    --寫入月核定撥付總表會計科目資料(貸：保險給付)(失能普職互改_本期沖抵前期金額)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;

                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20121121
                                                    ,OPPACCOUNTNO      --add by Angela 20121121
                                                    ,OPPACCOUNTNAME    --add by Angela 20121121
                                                    ,ACTTITLEAPCODE    --add by Angela 20121121
                                                    ,DATACD            --add by Angela 20121121
                                                    ,DECIDEAMT         --add by Angela 20121121
                                                    ,CASHAMT           --add by Angela 20121121
                                                    ,CUTAMT            --add by Angela 20121121
                                                    ,ACCEPTPAYTYPE     --add by Angela 20121121
                                                    ,CNT               --add by Angela 20121121
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '1'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_SUMrptNAChg1.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_SUMrptNAChg1.NLWKMK
                                                     ,v_SUMrptNAChg1.ADWKMK
                                                     ,v_SUMrptNAChg1.NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20121121
                                                     ,v_OPPACCOUNTNO      --add by Angela 20121121
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20121121
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20121121
                                                     ,v_DATACD            --add by Angela 20121121
                                                     ,v_DECIDEAMT         --add by Angela 20121121
                                                     ,v_CASHAMT           --add by Angela 20121121
                                                     ,v_CUTAMT            --add by Angela 20121121
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20121121
                                                     ,v_CNT               --add by Angela 20121121
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
              '月核定撥付總表會計科目(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
              v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>月核定撥付總表會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_1_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_5
        PURPOSE:         產生退匯核定清單

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_5 (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                     -- 應付金額

        --退匯核定清單
        Cursor c_dataCur_SUMrpt5 is
            SELECT  COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) AS ISSUEAMT                         --核定金額(A)
                   ,NVL(SUM(OTHERAAMT),0) AS OTHERAAMT                       --另案扣減同保險(B)
                   ,NVL(SUM(OTHERBAMT),0) AS OTHERBAMT                       --另案扣減他保險(C)
                   ,NVL(SUM(MITRATE),0) AS MITRATE                           --匯費(D)
                   ,NVL(SUM(OFFSETAMT),0) AS OFFSETAMT                       --抵銷紓困(E)
                   ,NVL(SUM(COMPENAMT),0) AS COMPENAMT                       --代扣補償金(F)
                   ,NVL(SUM(INHERITORAMT),0) AS INHERITORAMT                 --保留遺屬津貼(G)
                   ,NVL(SUM(ITRTTAX),0) AS ITRTTAX                           --代扣利息所得稅(H)
                   ,NVL(SUM(OTHERAMT),0) AS OTHERAMT                         --其他(I)
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                  ,PAYTYP                                                   --給付方式
                  ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                  ,CPRNDATE                                                 --
                  ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                  ,deCode(v_i_paycode,'L','',NLWKMK) NLWKMK                 --普職註記  --add by Angela 20130731
                  ,deCode(v_i_paycode,'L','',ADWKMK) ADWKMK                 --加職註記  --add by Angela 20130731
             FROM BAPAYRPTRECORD
            WHERE RPTTYP = '5'
              AND ISSUYM = v_i_issuym
              AND APNO LIKE (v_i_paycode||'%')
              AND CHKDATE = v_i_chkdate
              AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
            GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP,NLWKMK,ADWKMK
            ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP,NLWKMK,ADWKMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_5';
            v_g_genFlag := 0;

            --退匯核定清單資料
            for v_dataSUMCur5 in c_dataCur_SUMrpt5 Loop
              --    v_payamt := 0;                            --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)
                  v_payamt := v_dataSUMCur5.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur5.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur5.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur5.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur5.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur5.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur5.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur5.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur5.OTHERAMT;       --  其他費用(I)

                  v_g_genFlag := 1;

                --寫入退匯核定清單資料
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NACHGMK
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur5.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur5.PAYTYP
                                         ,v_dataSUMCur5.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur5.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur5.APNOAMT
                                         ,v_dataSUMCur5.DATAAMT
                                         ,v_dataSUMCur5.ISSUEAMT
                                         ,v_dataSUMCur5.OTHERAAMT
                                         ,v_dataSUMCur5.OTHERBAMT
                                         ,v_dataSUMCur5.MITRATE
                                         ,v_dataSUMCur5.OFFSETAMT
                                         ,v_dataSUMCur5.COMPENAMT
                                         ,v_dataSUMCur5.INHERITORAMT
                                         ,v_dataSUMCur5.ITRTTAX
                                         ,v_dataSUMCur5.OTHERAMT
                                         ,v_payamt
                                         ,''  --指定核付序號
                                         ,Decode(v_dataSUMCur5.RPTTYP,'5',fn_BA_transIssuTypSTR(v_dataSUMCur5.ISSUTYP),'')  --備註
                                         ,''  --普職互改註記
                                         ,v_dataSUMCur5.NLWKMK
                                         ,v_dataSUMCur5.ADWKMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '退匯核定清單資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPaySUMRPT_5 End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_5_L
        PURPOSE:         產生退匯核定清單會計科目

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_5_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --退匯核定清單
        Cursor c_dataCur_SUMrpt5 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數    add by 20130711 Angela
                   PAYTYP
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '5'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP
             ORDER BY PAYTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_5_L';
            v_count     := 0;
            v_g_genFlag := 0;

            --退匯核定清單會計科目
            for v_dataSUMCur5 in c_dataCur_SUMrpt5 Loop
                  v_count          := 0;
                  v_g_genFlag      := 1;
                  v_ACCOUNTSEQ     := null;
                  v_ACCOUNTNO      := '';
                  v_ACCOUNTNAME    := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;

                    if i = 1 then
                       v_ACCOUNTSEQ     := 0;
                       v_ACCOUNTNO      := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_ACCOUNTNAME    := '銀行存款－土地銀行台北分行13986-2帳戶';
                       v_tmpAMT         := v_dataSUMCur5.ISSUEAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                       v_OPPACCOUNTNAME := '應付保管款－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'KKB';
                       v_DATACD         := '';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := v_tmpAMT;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur5.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_ACCOUNTNO      := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                       v_ACCOUNTNAME    := '應付保管款－普通－老年給付（年金）';
                       v_tmpAMT         := v_dataSUMCur5.PAYAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入退匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (
                                                     '5'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur5.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,''
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
             '退匯核定清單會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_5_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_5_K
        PURPOSE:         產生退匯核定清單會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.
        1.1   2023/12/22  William      依據babaweb-96,修正錯誤的sql

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_5_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --退匯核定清單(失能)
        Cursor c_dataCur_SUMrpt5 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   PAYTYP,                                        -- 給付方式
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數      --add by Angela 20130711
                   NLWKMK,                                        -- 普職註記  --add by Angela 20130731
                   ADWKMK                                         -- 加職註記  --add by Angela 20130731
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '5'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP,NLWKMK,ADWKMK
             ORDER BY PAYTYP,NLWKMK,ADWKMK;

         Cursor c_dataCur_SUMrptAccount5(v_i_nlwkmk varChar2,v_i_adwkmk varChar2) is
            SELECT NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   DECODE(PAYKIND,'37','37','35') AS PAYKIND,     -- 給付種類
                   NLWKMK,                                        -- 普職註記
                   ADWKMK                                         -- 加職註記
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '5'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NVL(TRIM(NLWKMK),' ') = NVL(TRIM(v_i_nlwkmk),' ')      --add by Angela 20130731
               AND NVL(TRIM(ADWKMK),' ') = NVL(TRIM(v_i_adwkmk),' ')      --add by Angela 20130731
             GROUP BY NLWKMK, ADWKMK, DECODE(PAYKIND,'37','37','35')   --BABAWEB-96 20231222
             ORDER BY NLWKMK, ADWKMK, PAYKIND;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_5_K';
            v_count     := 0;
            v_g_genFlag := 0;

            --退匯核定清單會計科目(失能)
            for v_dataSUMCur5 in c_dataCur_SUMrpt5 Loop
                v_count     := 0;
                v_g_genFlag := 1;

                v_count       := v_count + 1;
                v_ACCOUNTSEQ  := 0;--LOG BATCHJOB detail Add By Zehua 20140722
                v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                v_tmpAMT      := v_dataSUMCur5.ISSUEAMT;

                --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                --寫入退匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                if v_tmpAMT > 0 then
                   insert into BAPAYRPTACCOUNT(  RPTTYP
                                                ,CPRNDATE
                                                ,PAYCODE
                                                ,ISSUYM
                                                ,PAYTYP
                                                ,CHKDATE
                                                ,BENEVTREL
                                                ,ACCOUNTSEQ
                                                ,SEQNO
                                                ,ACCOUNTNO
                                                ,ACCOUNTNAME
                                                ,PAYAMT
                                                ,PAYSEQNO
                                                --,NACHGMK
                                                ,NLWKMK
                                                ,ADWKMK
                                                ,PROCTIME
                                                ,ACCOUNTMEMO       --add by Angela 20130711
                                                ,OPPACCOUNTNO      --add by Angela 20130711
                                                ,OPPACCOUNTNAME    --add by Angela 20130711
                                                ,ACTTITLEAPCODE    --add by Angela 20130711
                                                ,DATACD            --add by Angela 20130711
                                                ,DECIDEAMT         --add by Angela 20130711
                                                ,CASHAMT           --add by Angela 20130711
                                                ,CUTAMT            --add by Angela 20130711
                                                ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                ,CNT               --add by Angela 20130711
                                                ,ACCOUNTTOPFMK     --add by Angela 20130731
                                      ) values (  '5'
                                                 ,v_i_cprndt
                                                 ,v_i_paycode
                                                 ,v_i_issuym
                                                 ,v_dataSUMCur5.PAYTYP
                                                 ,v_i_chkdate
                                                 ,''
                                                 ,v_ACCOUNTSEQ
                                                 ,v_count
                                                 ,v_ACCOUNTNO
                                                 ,v_ACCOUNTNAME
                                                 ,v_tmpAMT
                                                 ,''
                                                 --,''--NACHGMK
                                                 ,v_dataSUMCur5.NLWKMK
                                                 ,v_dataSUMCur5.ADWKMK
                                                 ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                 ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                 ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                 ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                 ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                 ,v_DATACD            --add by Angela 20130711
                                                 ,v_DECIDEAMT         --add by Angela 20130711
                                                 ,v_CASHAMT           --add by Angela 20130711
                                                 ,v_CUTAMT            --add by Angela 20130711
                                                 ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                 ,v_CNT               --add by Angela 20130711
                                                 ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                       );
                end if;

                for v_dataSUMCurAccount5 in c_dataCur_SUMrptAccount5(v_dataSUMCur5.NLWKMK,v_dataSUMCur5.ADWKMK) Loop
                     v_ACCOUNTSEQ  := 1;
                     v_tmpAMT      := v_dataSUMCurAccount5.PAYAMT;    --Modify by Angela 20190401
                     v_count       := v_count + 1;
                     if (v_dataSUMCurAccount5.PAYKIND <> '37') and
                         ((v_dataSUMCurAccount5.NLWKMK = '1') or (v_dataSUMCurAccount5.NLWKMK is null)) then
                           v_ACCOUNTNO   := '2362121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11102 9)
                           v_ACCOUNTNAME := '應付保管款－普通－失能給付（年金）';
                     elsif (v_dataSUMCurAccount5.PAYKIND <> '37') and
                          ((v_dataSUMCurAccount5.NLWKMK = '2') And (v_dataSUMCurAccount5.ADWKMK = '1')) then
                            v_ACCOUNTNO   := '2362122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11102 2)
                            v_ACCOUNTNAME := '應付保管款－職災－失能給付（年金）';
                     elsif (v_dataSUMCurAccount5.PAYKIND <> '37') and
                          ((v_dataSUMCurAccount5.NLWKMK = '2') And (v_dataSUMCurAccount5.ADWKMK = '2')) then
                            v_ACCOUNTNO   := '2362122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12102 3)
                            v_ACCOUNTNAME := '應付保管款－加職－失能給付（年金）';
                     elsif (v_dataSUMCurAccount5.PAYKIND = '37') and
                          ((v_dataSUMCurAccount5.NLWKMK = '2') And (v_dataSUMCurAccount5.ADWKMK = '1')) then
                            v_ACCOUNTNO   := '2362122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11101 4)
                            v_ACCOUNTNAME := '應付保管款－職災－失能給付（補償金）';
                     elsif (v_dataSUMCurAccount5.PAYKIND = '37') and
                          ((v_dataSUMCurAccount5.NLWKMK = '2') And (v_dataSUMCurAccount5.ADWKMK = '2')) then
                            v_ACCOUNTNO   := '2362122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12101 5)
                            v_ACCOUNTNAME := '應付保管款－加職－失能給付（補償金）';
                     end if;

                     --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                     v_ACCOUNTMEMO    := '';
                     v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                     v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                     v_ACTTITLEAPCODE := 'KKB';
                     v_DATACD         := '';
                     v_DECIDEAMT      := v_tmpAMT;
                     v_CASHAMT        := v_tmpAMT;
                     v_CUTAMT         := 0;
                     v_ACCEPTPAYTYPE  := '1';
                     v_CNT            := v_dataSUMCur5.DATAAMT;
                     v_ACCOUNTTOPFMK  := 'Y';
                     --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                     --寫入退匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                     if v_tmpAMT > 0 then
                         insert into BAPAYRPTACCOUNT(  RPTTYP
                                                      ,CPRNDATE
                                                      ,PAYCODE
                                                      ,ISSUYM
                                                      ,PAYTYP
                                                      ,CHKDATE
                                                      ,BENEVTREL
                                                      ,ACCOUNTSEQ
                                                      ,SEQNO
                                                      ,ACCOUNTNO
                                                      ,ACCOUNTNAME
                                                      ,PAYAMT
                                                      ,PAYSEQNO
                                                      --,NACHGMK
                                                      ,NLWKMK
                                                      ,ADWKMK
                                                      ,PROCTIME
                                                      ,ACCOUNTMEMO       --add by Angela 20130711
                                                      ,OPPACCOUNTNO      --add by Angela 20130711
                                                      ,OPPACCOUNTNAME    --add by Angela 20130711
                                                      ,ACTTITLEAPCODE    --add by Angela 20130711
                                                      ,DATACD            --add by Angela 20130711
                                                      ,DECIDEAMT         --add by Angela 20130711
                                                      ,CASHAMT           --add by Angela 20130711
                                                      ,CUTAMT            --add by Angela 20130711
                                                      ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                      ,CNT               --add by Angela 20130711
                                                      ,ACCOUNTTOPFMK     --add by Angela 20130731
                                            ) values (  '5'
                                                       ,v_i_cprndt
                                                       ,v_i_paycode
                                                       ,v_i_issuym
                                                       ,v_dataSUMCur5.PAYTYP
                                                       ,v_i_chkdate
                                                       ,''
                                                       ,v_ACCOUNTSEQ
                                                       ,v_count
                                                       ,v_ACCOUNTNO
                                                       ,v_ACCOUNTNAME
                                                       ,v_tmpAMT
                                                       ,''
                                                       --,''--NACHGMK
                                                       ,v_dataSUMCur5.NLWKMK
                                                       ,v_dataSUMCur5.ADWKMK
                                                       ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                       ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                       ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                       ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                       ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                       ,v_DATACD            --add by Angela 20130711
                                                       ,v_DECIDEAMT         --add by Angela 20130711
                                                       ,v_CASHAMT           --add by Angela 20130711
                                                       ,v_CUTAMT            --add by Angela 20130711
                                                       ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                       ,v_CNT               --add by Angela 20130711
                                                       ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                             );
                      end if;
                      --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                      v_ACCOUNTMEMO    := '';
                      v_OPPACCOUNTNO   := '';
                      v_OPPACCOUNTNAME := '';
                      v_ACTTITLEAPCODE := '';
                      v_DATACD         := '';
                      v_DECIDEAMT      := 0;
                      v_CASHAMT        := 0;
                      v_CUTAMT         := 0;
                      v_ACCEPTPAYTYPE  := '';
                      v_CNT            := 0;
                      v_ACCOUNTTOPFMK  := 'N';
                      --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                  end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(失能)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '退匯核定清單會計科目(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                      RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_5_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_5_S
        PURPOSE:         產生退匯核定清單會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_5_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --退匯核定清單(遺屬)
        Cursor c_dataCur_SUMrpt5 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   PAYTYP,                                        -- 給付方式
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數      --add by Angela 20130711
                   NLWKMK,                                        -- 普職註記  --add by Angela 20130731
                   ADWKMK                                         -- 加職註記  --add by Angela 20130731
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '5'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP,NLWKMK,ADWKMK
             ORDER BY PAYTYP,NLWKMK,ADWKMK;

         Cursor c_dataCur_SUMrptAccount5(v_i_nlwkmk varChar2,v_i_adwkmk varChar2) is
            SELECT NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NLWKMK,                                        -- 普職註記
                   ADWKMK                                         -- 加職註記
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '5'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NVL(TRIM(NLWKMK),' ') = NVL(TRIM(v_i_nlwkmk),' ')      --add by Angela 20130731
               AND NVL(TRIM(ADWKMK),' ') = NVL(TRIM(v_i_adwkmk),' ')      --add by Angela 20130731
             GROUP BY NLWKMK, ADWKMK                                      --Modify by Angela 20190401
             ORDER BY NLWKMK, ADWKMK;                                     --Modify by Angela 20190401

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_5_S';
            v_count     := 0;
            v_g_genFlag := 0;

            --退匯核定清單會計科目(遺屬)
            for v_dataSUMCur5 in c_dataCur_SUMrpt5 Loop
                v_count     := 0;
                v_g_genFlag := 1;

                v_count       := v_count + 1;
                v_ACCOUNTSEQ  := 0;
                v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                v_tmpAMT      := v_dataSUMCur5.ISSUEAMT;

                --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                --寫入退匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                if v_tmpAMT > 0 then
                    insert into BAPAYRPTACCOUNT(  RPTTYP
                                                 ,CPRNDATE
                                                 ,PAYCODE
                                                 ,ISSUYM
                                                 ,PAYTYP
                                                 ,CHKDATE
                                                 ,BENEVTREL
                                                 ,ACCOUNTSEQ
                                                 ,SEQNO
                                                 ,ACCOUNTNO
                                                 ,ACCOUNTNAME
                                                 ,PAYAMT
                                                 ,PAYSEQNO
                                                 --,NACHGMK
                                                 ,NLWKMK
                                                 ,ADWKMK
                                                 ,PROCTIME
                                                 ,ACCOUNTMEMO       --add by Angela 20130711
                                                 ,OPPACCOUNTNO      --add by Angela 20130711
                                                 ,OPPACCOUNTNAME    --add by Angela 20130711
                                                 ,ACTTITLEAPCODE    --add by Angela 20130711
                                                 ,DATACD            --add by Angela 20130711
                                                 ,DECIDEAMT         --add by Angela 20130711
                                                 ,CASHAMT           --add by Angela 20130711
                                                 ,CUTAMT            --add by Angela 20130711
                                                 ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                 ,CNT               --add by Angela 20130711
                                                 ,ACCOUNTTOPFMK     --add by Angela 20130731
                                       ) values (
                                                  '5'
                                                  ,v_i_cprndt
                                                  ,v_i_paycode
                                                  ,v_i_issuym
                                                  ,v_dataSUMCur5.PAYTYP
                                                  ,v_i_chkdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,''
                                                  --,''--NACHGMK
                                                  ,v_dataSUMCur5.NLWKMK
                                                  ,v_dataSUMCur5.ADWKMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                  ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                  ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                  ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                  ,v_DATACD            --add by Angela 20130711
                                                  ,v_DECIDEAMT         --add by Angela 20130711
                                                  ,v_CASHAMT           --add by Angela 20130711
                                                  ,v_CUTAMT            --add by Angela 20130711
                                                  ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                  ,v_CNT               --add by Angela 20130711
                                                  ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                        );
                end if;

                for v_dataSUMCurAccount5 in c_dataCur_SUMrptAccount5(v_dataSUMCur5.NLWKMK,v_dataSUMCur5.ADWKMK) Loop
                     v_ACCOUNTSEQ  := 1;
                     v_tmpAMT      := v_dataSUMCurAccount5.PAYAMT;    --Modify by Angela 20190401
                     v_count       := v_count + 1;
                     if ((v_dataSUMCurAccount5.NLWKMK = '1') or (v_dataSUMCurAccount5.NLWKMK is null)) then
                         v_ACCOUNTNO   := '2362121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11054 A)
                         v_ACCOUNTNAME := '應付保管款－普通－本人死亡給付（年金）';
                     elsif ((v_dataSUMCurAccount5.NLWKMK = '2') And (v_dataSUMCurAccount5.ADWKMK = '1')) then
                         v_ACCOUNTNO   := '2362122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11054 4)
                         v_ACCOUNTNAME := '應付保管款－職災－本人死亡給付（年金）';
                     elsif ((v_dataSUMCurAccount5.NLWKMK = '2') And (v_dataSUMCurAccount5.ADWKMK = '2')) then
                         v_ACCOUNTNO   := '2362122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12054 5)
                         v_ACCOUNTNAME := '應付保管款－加職－本人死亡給付（年金）';
                     end if;

                     --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                     v_ACCOUNTMEMO    := '';
                     v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                     v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                     v_ACTTITLEAPCODE := 'KKB';
                     v_DATACD         := '';
                     v_DECIDEAMT      := v_tmpAMT;
                     v_CASHAMT        := v_tmpAMT;
                     v_CUTAMT         := 0;
                     v_ACCEPTPAYTYPE  := '1';
                     v_CNT            := v_dataSUMCur5.DATAAMT;
                     v_ACCOUNTTOPFMK  := 'Y';
                     --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                     --寫入退匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                     if v_tmpAMT > 0 then
                         insert into BAPAYRPTACCOUNT(  RPTTYP
                                                      ,CPRNDATE
                                                      ,PAYCODE
                                                      ,ISSUYM
                                                      ,PAYTYP
                                                      ,CHKDATE
                                                      ,BENEVTREL
                                                      ,ACCOUNTSEQ
                                                      ,SEQNO
                                                      ,ACCOUNTNO
                                                      ,ACCOUNTNAME
                                                      ,PAYAMT
                                                      ,PAYSEQNO
                                                      --,NACHGMK
                                                      ,NLWKMK
                                                      ,ADWKMK
                                                      ,PROCTIME
                                                      ,ACCOUNTMEMO       --add by Angela 20130711
                                                      ,OPPACCOUNTNO      --add by Angela 20130711
                                                      ,OPPACCOUNTNAME    --add by Angela 20130711
                                                      ,ACTTITLEAPCODE    --add by Angela 20130711
                                                      ,DATACD            --add by Angela 20130711
                                                      ,DECIDEAMT         --add by Angela 20130711
                                                      ,CASHAMT           --add by Angela 20130711
                                                      ,CUTAMT            --add by Angela 20130711
                                                      ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                      ,CNT               --add by Angela 20130711
                                                      ,ACCOUNTTOPFMK     --add by Angela 20130731
                                            ) values (
                                                       '5'
                                                       ,v_i_cprndt
                                                       ,v_i_paycode
                                                       ,v_i_issuym
                                                       ,v_dataSUMCur5.PAYTYP
                                                       ,v_i_chkdate
                                                       ,''
                                                       ,v_ACCOUNTSEQ
                                                       ,v_count
                                                       ,v_ACCOUNTNO
                                                       ,v_ACCOUNTNAME
                                                       ,v_tmpAMT
                                                       ,''
                                                       --,''--NACHGMK
                                                       ,v_dataSUMCur5.NLWKMK
                                                       ,v_dataSUMCur5.ADWKMK
                                                       ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                       ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                       ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                       ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                       ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                       ,v_DATACD            --add by Angela 20130711
                                                       ,v_DECIDEAMT         --add by Angela 20130711
                                                       ,v_CASHAMT           --add by Angela 20130711
                                                       ,v_CUTAMT            --add by Angela 20130711
                                                       ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                       ,v_CNT               --add by Angela 20130711
                                                       ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                             );
                      end if;
                      --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                      v_ACCOUNTMEMO    := '';
                      v_OPPACCOUNTNO   := '';
                      v_OPPACCOUNTNAME := '';
                      v_ACTTITLEAPCODE := '';
                      v_DATACD         := '';
                      v_DECIDEAMT      := 0;
                      v_CASHAMT        := 0;
                      v_CUTAMT         := 0;
                      v_ACCEPTPAYTYPE  := '';
                      v_CNT            := 0;
                      v_ACCOUNTTOPFMK  := 'N';
                      --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                  end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '退匯核定清單會計科目(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>退匯核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_5_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_6
        PURPOSE:         產生改匯核定清單

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_paydate       (varChar2)       --核付日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_6 (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                     -- 應付金額

        --改匯核定清單
        Cursor c_dataCur_SUMrpt6 is
            SELECT  COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) AS ISSUEAMT                         --核定金額(A)
                   ,NVL(SUM(OTHERAAMT),0) AS OTHERAAMT                       --另案扣減同保險(B)
                   ,NVL(SUM(OTHERBAMT),0) AS OTHERBAMT                       --另案扣減他保險(C)
                   ,NVL(SUM(MITRATE),0) AS MITRATE                           --匯費(D)
                   ,NVL(SUM(OFFSETAMT),0) AS OFFSETAMT                       --抵銷紓困(E)
                   ,NVL(SUM(COMPENAMT),0) AS COMPENAMT                       --代扣補償金(F)
                   ,NVL(SUM(INHERITORAMT),0) AS INHERITORAMT                 --保留遺屬津貼(G)
                   ,NVL(SUM(ITRTTAX),0) AS ITRTTAX                           --代扣利息所得稅(H)
                   ,NVL(SUM(OTHERAMT),0) AS OTHERAMT                         --其他(I)
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                   ,PAYTYP                                                   --給付方式
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   ,deCode(v_i_paycode,'L','',NLWKMK) NLWKMK                 --普職註記  --add by Angela 20130731
                   ,deCode(v_i_paycode,'L','',ADWKMK) ADWKMK                 --加職註記  --add by Angela 20130731
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '6'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP,NLWKMK,ADWKMK
             ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, RPTTYP,NLWKMK,ADWKMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_6';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --改匯核定清單資料
            for v_dataSUMCur6 in c_dataCur_SUMrpt6 Loop
           --       v_payamt := 0;                              --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)
                  v_payamt := v_dataSUMCur6.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur6.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur6.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur6.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur6.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur6.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur6.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur6.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur6.OTHERAMT;       --  其他費用(I)

                  v_g_genFlag := 1;

                --寫入改匯核定清單資料
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NACHGMK
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur6.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur6.PAYTYP
                                         ,v_dataSUMCur6.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur6.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur6.APNOAMT
                                         ,v_dataSUMCur6.DATAAMT
                                         ,v_dataSUMCur6.ISSUEAMT
                                         ,v_dataSUMCur6.OTHERAAMT
                                         ,v_dataSUMCur6.OTHERBAMT
                                         ,v_dataSUMCur6.MITRATE
                                         ,v_dataSUMCur6.OFFSETAMT
                                         ,v_dataSUMCur6.COMPENAMT
                                         ,v_dataSUMCur6.INHERITORAMT
                                         ,v_dataSUMCur6.ITRTTAX
                                         ,v_dataSUMCur6.OTHERAMT
                                         ,v_payamt
                                         ,''  --指定核付序號
                                         ,Decode(v_dataSUMCur6.RPTTYP,'6',fn_BA_transIssuTypSTR(v_dataSUMCur6.ISSUTYP),'')  --備註
                                         ,''  --普職互改註記
                                         ,v_dataSUMCur6.NLWKMK
                                         ,v_dataSUMCur6.ADWKMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '改匯核定清單資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_6 End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_6_L
        PURPOSE:         產生改匯核定清單會計科目

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)

                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

         PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_6_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --改匯核定清單
        Cursor c_dataCur_SUMrpt6 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數    add by 20130711 Angela
                   PAYTYP
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '6'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP
             ORDER BY PAYTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_6_L';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --改匯核定清單會計科目
            for v_dataSUMCur6 in c_dataCur_SUMrpt6 Loop
                  v_count          := 0;
                  v_g_genFlag      := 1;
                  v_ACCOUNTSEQ     := null;
                  v_ACCOUNTNO      := '';
                  v_ACCOUNTNAME    := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ     := 0;
                       v_ACCOUNTNO      := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                       v_ACCOUNTNAME    := '應付保管款－普通－老年給付（年金）';
                       v_tmpAMT         := v_dataSUMCur6.ISSUEAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       v_ACTTITLEAPCODE := 'KLA';
                       v_DATACD         := '';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := v_tmpAMT;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur6.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                       v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                       v_tmpAMT      := v_dataSUMCur6.PAYAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入改匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '6'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur6.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,''
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '改匯核定清單會計科目(老年)-資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_6_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_6_K
        PURPOSE:         產生改匯核定清單會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.
        1.1   2023/12/22  William      依據babaweb-96,修正錯誤的sql
        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_6_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --改匯核定清單
        Cursor c_dataCur_SUMrpt6 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   PAYTYP,                                        -- 給付方式
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數      --add by Angela 20130711
                   NLWKMK,                                        -- 普職註記  --add by Angela 20130731
                   ADWKMK                                         -- 加職註記  --add by Angela 20130731
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '6'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP,NLWKMK,ADWKMK
             ORDER BY PAYTYP,NLWKMK,ADWKMK;

        Cursor c_dataCur_SUMrptAccount6(v_i_nlwkmk varChar2,v_i_adwkmk varChar2) is
            SELECT NVL(SUM(ISSUEAMT), 0)     AS ISSUEAMT,         -- 應付金額
                   DECODE(PAYKIND,'37','37','35') AS PAYKIND,     -- 給付種類
                   NLWKMK,                                        -- 普職註記
                   ADWKMK                                         -- 加職註記
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '6'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NVL(TRIM(NLWKMK),' ') = NVL(TRIM(v_i_nlwkmk),' ')      --add by Angela 20130731
               AND NVL(TRIM(ADWKMK),' ') = NVL(TRIM(v_i_adwkmk),' ')      --add by Angela 20130731
             GROUP BY NLWKMK, ADWKMK, DECODE(PAYKIND,'37','37','35')   --BABAWEB-96 20231222
             ORDER BY NLWKMK, ADWKMK, PAYKIND;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_6_K';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --改匯核定清單會計科目
            for v_dataSUMCur6 in c_dataCur_SUMrpt6 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for v_dataSUMCurAccount6 in c_dataCur_SUMrptAccount6(v_dataSUMCur6.NLWKMK,v_dataSUMCur6.ADWKMK) Loop
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 0;
                    v_tmpAMT      := v_dataSUMCur6.ISSUEAMT;
                    if (v_dataSUMCurAccount6.PAYKIND <> '37') and
                      ((v_dataSUMCurAccount6.NLWKMK = '1') or (v_dataSUMCurAccount6.NLWKMK is null)) then
                        v_ACCOUNTNO   := '2362121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11102 9)
                        v_ACCOUNTNAME := '應付保管款－普通－失能給付（年金）';
                    elsif (v_dataSUMCurAccount6.PAYKIND <> '37') and
                         ((v_dataSUMCurAccount6.NLWKMK = '2') And (v_dataSUMCurAccount6.ADWKMK = '1')) then
                           v_ACCOUNTNO   := '2362122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11102 2)
                           v_ACCOUNTNAME := '應付保管款－職災－失能給付（年金）';
                    elsif (v_dataSUMCurAccount6.PAYKIND <> '37') and
                         ((v_dataSUMCurAccount6.NLWKMK = '2') And (v_dataSUMCurAccount6.ADWKMK = '2')) then
                           v_ACCOUNTNO   := '2362122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12102 3)
                           v_ACCOUNTNAME := '應付保管款－加職－失能給付（年金）';
                    elsif (v_dataSUMCurAccount6.PAYKIND = '37') and
                         ((v_dataSUMCurAccount6.NLWKMK = '2') And (v_dataSUMCurAccount6.ADWKMK = '1')) then
                           v_ACCOUNTNO   := '2362122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11101 4)
                           v_ACCOUNTNAME := '應付保管款－職災－失能給付（補償金）';
                    elsif (v_dataSUMCurAccount6.PAYKIND = '37') and
                         ((v_dataSUMCurAccount6.NLWKMK = '2') And (v_dataSUMCurAccount6.ADWKMK = '2')) then
                           v_ACCOUNTNO   := '2362122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12101 5)
                           v_ACCOUNTNAME := '應付保管款－加職－失能給付（補償金）';
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                    v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    v_ACTTITLEAPCODE := 'KLA';
                    v_DATACD         := '';
                    v_DECIDEAMT      := v_tmpAMT;
                    v_CASHAMT        := v_tmpAMT;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '1';
                    v_CNT            := v_dataSUMCur6.DATAAMT;
                    v_ACCOUNTTOPFMK  := 'Y';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                    --寫入改匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '6'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur6.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,''
                                                     --,''--NACHGMK
                                                     ,v_dataSUMCur6.NLWKMK
                                                     ,v_dataSUMCur6.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;

                v_count       := v_count + 1;
                v_ACCOUNTSEQ  := 1;
                v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                v_tmpAMT      := v_dataSUMCur6.PAYAMT;

                --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                --寫入改匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                if v_tmpAMT > 0 then
                   insert into BAPAYRPTACCOUNT(  RPTTYP
                                                ,CPRNDATE
                                                ,PAYCODE
                                                ,ISSUYM
                                                ,PAYTYP
                                                ,CHKDATE
                                                ,BENEVTREL
                                                ,ACCOUNTSEQ
                                                ,SEQNO
                                                ,ACCOUNTNO
                                                ,ACCOUNTNAME
                                                ,PAYAMT
                                                ,PAYSEQNO
                                                --,NACHGMK
                                                ,NLWKMK
                                                ,ADWKMK
                                                ,PROCTIME
                                                ,ACCOUNTMEMO       --add by Angela 20130711
                                                ,OPPACCOUNTNO      --add by Angela 20130711
                                                ,OPPACCOUNTNAME    --add by Angela 20130711
                                                ,ACTTITLEAPCODE    --add by Angela 20130711
                                                ,DATACD            --add by Angela 20130711
                                                ,DECIDEAMT         --add by Angela 20130711
                                                ,CASHAMT           --add by Angela 20130711
                                                ,CUTAMT            --add by Angela 20130711
                                                ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                ,CNT               --add by Angela 20130711
                                                ,ACCOUNTTOPFMK     --add by Angela 20130731
                                      ) values (  '6'
                                                 ,v_i_cprndt
                                                 ,v_i_paycode
                                                 ,v_i_issuym
                                                 ,v_dataSUMCur6.PAYTYP
                                                 ,v_i_chkdate
                                                 ,''
                                                 ,v_ACCOUNTSEQ
                                                 ,v_count
                                                 ,v_ACCOUNTNO
                                                 ,v_ACCOUNTNAME
                                                 ,v_tmpAMT
                                                 ,''
                                                 --,''--NACHGMK
                                                 ,v_dataSUMCur6.NLWKMK
                                                 ,v_dataSUMCur6.ADWKMK
                                                 ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                 ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                 ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                 ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                 ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                 ,v_DATACD            --add by Angela 20130711
                                                 ,v_DECIDEAMT         --add by Angela 20130711
                                                 ,v_CASHAMT           --add by Angela 20130711
                                                 ,v_CUTAMT            --add by Angela 20130711
                                                 ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                 ,v_CNT               --add by Angela 20130711
                                                 ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                       );
                end if;
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(失能)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '改匯核定清單會計科目(失能)-資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
               v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_6_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_6_S
        PURPOSE:         產生改匯核定清單會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)

                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_6_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --改匯核定清單
        Cursor c_dataCur_SUMrpt6 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             -- 應付金額
                   NVL(SUM(OTHERBAMT), 0)  AS OTHERBAMT,          -- 另案扣減他保險
                   NVL(SUM(OFFSETAMT), 0)  AS OFFSETAMT,          -- 抵銷紓困
                   NVL(SUM(MITRATE), 0)    AS MITRATE,            -- 匯款匯費
                   PAYTYP,                                        -- 給付方式
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數      --add by Angela 20130711
                   NLWKMK,                                        -- 普職註記  --add by Angela 20130731
                   ADWKMK                                         -- 加職註記  --add by Angela 20130731
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '6'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY PAYTYP,NLWKMK,ADWKMK
             ORDER BY PAYTYP,NLWKMK,ADWKMK;

        Cursor c_dataCur_SUMrptAccount6(v_i_nlwkmk varChar2,v_i_adwkmk varChar2) is
            SELECT NVL(SUM(ISSUEAMT), 0)     AS ISSUEAMT,         -- 應付金額
                   NLWKMK,                                        -- 普職註記
                   ADWKMK                                         -- 加職註記
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '6'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NVL(TRIM(NLWKMK),' ') = NVL(TRIM(v_i_nlwkmk),' ')      --add by Angela 20130731
               AND NVL(TRIM(ADWKMK),' ') = NVL(TRIM(v_i_adwkmk),' ')      --add by Angela 20130731
             GROUP BY NLWKMK, ADWKMK                                      --Modify by Angela 20190927
             ORDER BY NLWKMK, ADWKMK;                                     --Modify by Angela 20190927

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_6_S';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --改匯核定清單會計科目
            for v_dataSUMCur6 in c_dataCur_SUMrpt6 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for v_dataSUMCurAccount6 in c_dataCur_SUMrptAccount6(v_dataSUMCur6.NLWKMK,v_dataSUMCur6.ADWKMK) Loop
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 0;
                    v_tmpAMT      := v_dataSUMCur6.ISSUEAMT;
                    if ((v_dataSUMCurAccount6.NLWKMK = '1') or (v_dataSUMCurAccount6.NLWKMK is null)) then
                        v_ACCOUNTNO   := '2362121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11054 A)
                        v_ACCOUNTNAME := '應付保管款－普通－本人死亡給付（年金）';
                    elsif ((v_dataSUMCurAccount6.NLWKMK = '2') And (v_dataSUMCurAccount6.ADWKMK = '1')) then
                        v_ACCOUNTNO   := '2362122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11054 4)
                        v_ACCOUNTNAME := '應付保管款－職災－本人死亡給付（年金）';
                    elsif ((v_dataSUMCurAccount6.NLWKMK = '2') And (v_dataSUMCurAccount6.ADWKMK = '2')) then
                        v_ACCOUNTNO   := '2362122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12054 5)
                        v_ACCOUNTNAME := '應付保管款－加職－本人死亡給付（年金）';
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                    v_OPPACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                    v_ACTTITLEAPCODE := 'KLA';
                    v_DATACD         := '';
                    v_DECIDEAMT      := v_tmpAMT;
                    v_CASHAMT        := v_tmpAMT;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '1';
                    v_CNT            := v_dataSUMCur6.DATAAMT;
                    v_ACCOUNTTOPFMK  := 'Y';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                    --寫入改匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '6'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,v_dataSUMCur6.PAYTYP
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,''
                                                     --,''--NACHGMK
                                                     ,v_dataSUMCur6.NLWKMK
                                                     ,v_dataSUMCur6.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;

                v_count       := v_count + 1;
                v_ACCOUNTSEQ  := 1;
                v_ACCOUNTNO   := '111212  00530 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：110212  0053  2)
                v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶';
                v_tmpAMT      := v_dataSUMCur6.PAYAMT;

                --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                --寫入改匯核定清單會計科目資料(借：保險給付，貸：銀行存款)
                if v_tmpAMT > 0 then
                   insert into BAPAYRPTACCOUNT(
                                                 RPTTYP
                                                ,CPRNDATE
                                                ,PAYCODE
                                                ,ISSUYM
                                                ,PAYTYP
                                                ,CHKDATE
                                                ,BENEVTREL
                                                ,ACCOUNTSEQ
                                                ,SEQNO
                                                ,ACCOUNTNO
                                                ,ACCOUNTNAME
                                                ,PAYAMT
                                                ,PAYSEQNO
                                                --,NACHGMK
                                                ,NLWKMK
                                                ,ADWKMK
                                                ,PROCTIME
                                                ,ACCOUNTMEMO       --add by Angela 20130711
                                                ,OPPACCOUNTNO      --add by Angela 20130711
                                                ,OPPACCOUNTNAME    --add by Angela 20130711
                                                ,ACTTITLEAPCODE    --add by Angela 20130711
                                                ,DATACD            --add by Angela 20130711
                                                ,DECIDEAMT         --add by Angela 20130711
                                                ,CASHAMT           --add by Angela 20130711
                                                ,CUTAMT            --add by Angela 20130711
                                                ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                ,CNT               --add by Angela 20130711
                                                ,ACCOUNTTOPFMK     --add by Angela 20130731
                                      ) values (
                                                 '6'
                                                 ,v_i_cprndt
                                                 ,v_i_paycode
                                                 ,v_i_issuym
                                                 ,v_dataSUMCur6.PAYTYP
                                                 ,v_i_chkdate
                                                 ,''
                                                 ,v_ACCOUNTSEQ
                                                 ,v_count
                                                 ,v_ACCOUNTNO
                                                 ,v_ACCOUNTNAME
                                                 ,v_tmpAMT
                                                 ,''
                                                 --,''--NACHGMK
                                                 ,v_dataSUMCur6.NLWKMK
                                                 ,v_dataSUMCur6.ADWKMK
                                                 ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                 ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                 ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                 ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                 ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                 ,v_DATACD            --add by Angela 20130711
                                                 ,v_DECIDEAMT         --add by Angela 20130711
                                                 ,v_CASHAMT           --add by Angela 20130711
                                                 ,v_CUTAMT            --add by Angela 20130711
                                                 ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                 ,v_CNT               --add by Angela 20130711
                                                 ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                       );
                end if;

                --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '改匯核定清單會計科目(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                   --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>改匯核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_6_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_7
        PURPOSE:         產生應收款立帳核定清單(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_7_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        --應收款立帳核定清單(老年)
         Cursor c_dataCur_SUMrpt7 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                              --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '7'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
             GROUP BY ISSUTYP, CHKDATE, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, CHKDATE, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_7_L';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收款立帳核定清單資料(老年)
            for v_dataSUMCur7 in c_dataCur_SUMrpt7 Loop

                  v_g_genFlag := 1;

                --寫入應收款立帳核定清單資料
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         --,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur7.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_dataSUMCur7.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur7.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur7.APNOAMT
                                         ,v_dataSUMCur7.DATAAMT
                                         ,v_dataSUMCur7.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur7.UNACPAMT
                                         ,v_dataSUMCur7.UNACPAMT
                                         ,v_i_payseqno  --指定核付序號
                                         ,''  --備註
                                         --,''  --普職互改註記
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單(老年)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '應收款立帳核定清單(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
               v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                    v_g_flag := '1';
                    v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_7_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_7_L
        PURPOSE:         產生應收款立帳核定清單會計科目(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_7_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --應收款立帳核定清單(老年)
        Cursor c_dataCur_SUMrpt7 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS UNACPAMT,           -- 應收金額
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數    add by 20130711 Angela
                   CHKDATE
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '7'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
             GROUP BY CHKDATE
             ORDER BY CHKDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_7_L';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收款立帳核定清單會計科目(老年)
            for v_dataSUMCur7 in c_dataCur_SUMrpt7 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur7.ISSUEAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_OPPACCOUNTNAME := '保險給付－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'FFG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur7.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_ACCOUNTNO   := '5171121 11111 0';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_ACCOUNTNAME := '保險給付－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur7.UNACPAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入應收款立帳核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (
                                                     '7'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,''
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收款立帳核定清單會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                     v_g_flag := '1';
                     v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_7_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_7_K
        PURPOSE:         產生應收款立帳核定清單(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_7_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        --應收款立帳核定清單(失能)
         Cursor c_dataCur_SUMrpt7 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                            --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '7'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO =  v_i_payseqno
               AND NACHGMK IS Null                                           -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_7_K';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收款立帳核定清單資料(失能)
            for v_dataSUMCur7 in c_dataCur_SUMrpt7 Loop

                  v_g_genFlag := 1;

                --寫入應收款立帳核定清單資料(失能)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur7.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_dataSUMCur7.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur7.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur7.APNOAMT
                                         ,v_dataSUMCur7.DATAAMT
                                         ,v_dataSUMCur7.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur7.UNACPAMT
                                         ,v_dataSUMCur7.UNACPAMT
                                         ,v_i_payseqno  --指定核付序號
                                         ,''  --備註
                                         ,v_dataSUMCur7.NLWKMK
                                         ,v_dataSUMCur7.ADWKMK
                                         ,v_dataSUMCur7.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單(失能)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收款立帳核定清單(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

               v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_7_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_7_K
        PURPOSE:         產生應收款立帳核定清單會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_7_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --應收款立帳核定清單(失能)
        Cursor c_dataCur_SUMrpt7 is
            SELECT NVL(SUM(DECODE(PAYKIND,'37',0,ISSUEAMT)), 0)   AS ISSUEAMTA,           -- 核定金額(失能年金)
                   NVL(SUM(DECODE(PAYKIND,'37',ISSUEAMT,0)), 0)   AS ISSUEAMTB,           -- 核定金額(失能補償金)
                   NVL(SUM(DECODE(PAYKIND,'37',0,UNACPAMT)), 0)   AS UNACPAMTA,           -- 應收金額(失能年金)
                   NVL(SUM(DECODE(PAYKIND,'37',UNACPAMT,0)), 0)   AS UNACPAMTB,           -- 應收金額(失能補償金)
                   NLWKMK,                                                                -- 普職註記
                   ADWKMK,                                                                -- 加職註記
                   NACHGMK,                                                               -- 普職互改註記
                   NVL(COUNT(*), 0)                               AS DATAAMT,             -- 筆數    add by 20130711 Angela
                   CHKDATE
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '7'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK IS NULL                                                         -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY CHKDATE, NLWKMK, ADWKMK, NACHGMK
             ORDER BY CHKDATE, NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_7_K';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收款立帳核定清單會計科目(失能)
            for v_dataSUMCur7 in c_dataCur_SUMrpt7 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur7.ISSUEAMTA;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                           if (v_dataSUMCur7.nlwkmk = '1' or trim(v_dataSUMCur7.nlwkmk) is null) then
                               v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                               v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                               v_OPPACCOUNTNO   := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                               v_OPPACCOUNTNAME := '保險給付－普通－失能給付（年金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '1') then
                               v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                               v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                               v_OPPACCOUNTNO   := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_OPPACCOUNTNAME := '保險給付－職災－失能給付（年金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '2') then
                               v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                               v_ACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                               v_OPPACCOUNTNO   := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_OPPACCOUNTNAME := '保險給付－加職－失能給付（年金）';    --add by 20130711 Angela
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '';
                           v_ACTTITLEAPCODE := 'FFG';
                           v_DATACD         := '1';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '1';
                           v_CNT            := v_dataSUMCur7.DATAAMT;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                       --else
                           -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                           /*if (SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '1') then
                                   v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                                   v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                           elsif  (SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '2') then
                                   v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                                   v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                           elsif  (SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '3') then
                                   v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                                   v_ACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                           end if;*/
                       --end if;
                    elsif i = 2 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur7.ISSUEAMTB;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                           if  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '1') then
                               v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                               v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                               v_OPPACCOUNTNO   := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                               v_OPPACCOUNTNAME := '保險給付－職災－失能給付（補償金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '2') then
                               v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                               v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                               v_OPPACCOUNTNO   := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                               v_OPPACCOUNTNAME := '保險給付－加職－失能給付（補償金）';    --add by 20130711 Angela
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '';
                           v_ACTTITLEAPCODE := 'FFG';
                           v_DATACD         := '1';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '1';
                           v_CNT            := v_dataSUMCur7.DATAAMT;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                          --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                          /* if ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '2' ) then
                                   v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                                   v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                           elsif (SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '3') then
                                   v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                                   v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                           end if;*/
                       --end if;
                    elsif i = 3 then
                       v_tmpAMT      := v_dataSUMCur7.UNACPAMTA;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                           if (v_dataSUMCur7.nlwkmk = '1' or trim(v_dataSUMCur7.nlwkmk) is null) then
                               v_ACCOUNTNO   := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                               v_ACCOUNTNAME := '保險給付－普通－失能給付（年金）';
                           elsif  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '1') then
                               v_ACCOUNTNO   := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_ACCOUNTNAME := '保險給付－職災－失能給付（年金）';
                           elsif  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '2') then
                               v_ACCOUNTNO   := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_ACCOUNTNAME := '保險給付－加職－失能給付（年金）';
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                           v_ACCOUNTMEMO    := '';
                           v_OPPACCOUNTNO   := '';
                           v_OPPACCOUNTNAME := '';
                           v_ACTTITLEAPCODE := '';
                           v_DATACD         := '';
                           v_DECIDEAMT      := 0;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '';
                           v_CNT            := 0;
                           v_ACCOUNTTOPFMK  := 'N';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                           /*if ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '1' ) then
                                   v_ACCOUNTNO   := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                   v_ACCOUNTNAME := '保險給付－普通－失能給付（年金）';
                           elsif ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '2' ) then
                                   v_ACCOUNTNO   := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                   v_ACCOUNTNAME := '保險給付－職災－失能給付（年金）';
                           elsif ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '3' ) then
                                   v_ACCOUNTNO   := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                   v_ACCOUNTNAME := '保險給付－加職－失能給付（年金）';
                           end if;    */
                      -- end if;
                    elsif i = 4 then
                       v_tmpAMT      := v_dataSUMCur7.UNACPAMTB;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                            if  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '1') then
                                v_ACCOUNTNO   := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                v_ACCOUNTNAME := '保險給付－職災－失能給付（補償金）';
                            elsif  (v_dataSUMCur7.nlwkmk = '2' and v_dataSUMCur7.adwkmk = '2') then
                                v_ACCOUNTNO   := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                v_ACCOUNTNAME := '保險給付－加職－失能給付（補償金）';
                            end if;
                            --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                            --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                            v_ACCOUNTMEMO    := '';
                            v_OPPACCOUNTNO   := '';
                            v_OPPACCOUNTNAME := '';
                            v_ACTTITLEAPCODE := '';
                            v_DATACD         := '';
                            v_DECIDEAMT      := 0;
                            v_CASHAMT        := 0;
                            v_CUTAMT         := 0;
                            v_ACCEPTPAYTYPE  := '';
                            v_CNT            := 0;
                            v_ACCOUNTTOPFMK  := 'N';
                            --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                            /*if  (   SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '2') then
                                    v_ACCOUNTNO   := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                    v_ACCOUNTNAME := '保險給付－職災－失能給付（補償金）';
                            elsif ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '3') then
                                    v_ACCOUNTNO   := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                    v_ACCOUNTNAME := '保險給付－加職－失能給付（補償金）';
                            end if;*/
                       --end if;
                    end if;

                    --寫入應收款立帳核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       v_count := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NACHGMK                       -- 2012/06/15 Mark By ChungYu 應收款立帳不區分普職互改
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '7'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,''
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_dataSUMCur7.NACHGMK
                                                     ,v_dataSUMCur7.NLWKMK
                                                     ,v_dataSUMCur7.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收款立帳核定清單會計科目(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_7_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_7_S
        PURPOSE:         產生應收款立帳核定清單(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_7_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        --應收款立帳核定清單(遺屬)
         Cursor c_dataCur_SUMrpt7 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                            --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                   ,PAYTYP                                                   --給付方式
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '7'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NACHGMK IS Null                                            -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY PAYTYP, ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY PAYTYP, ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_7_S';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收款立帳核定清單資料(遺屬)
            for v_dataSUMCur7 in c_dataCur_SUMrpt7 Loop

                  v_g_genFlag := 1;

                --寫入應收款立帳核定清單資料(遺屬)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur7.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur7.PAYTYP
                                         ,v_dataSUMCur7.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur7.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur7.APNOAMT
                                         ,v_dataSUMCur7.DATAAMT
                                         ,v_dataSUMCur7.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur7.UNACPAMT
                                         ,v_dataSUMCur7.UNACPAMT
                                         ,v_i_payseqno  --指定核付序號
                                         ,''  --備註
                                         ,v_dataSUMCur7.NLWKMK
                                         ,v_dataSUMCur7.ADWKMK
                                         ,v_dataSUMCur7.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單(遺屬)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收款立帳核定清單(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
              v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_7_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_7_S
        PURPOSE:         產生應收款立帳核定清單會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_7_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --應收款立帳核定清單(遺屬)
        Cursor c_dataCur_SUMrpt7 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,            -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS UNACPAMT,            -- 應收金額
                   NLWKMK,                                         -- 普職註記
                   ADWKMK,                                         -- 加職註記
                   NACHGMK,                                        -- 普職互改註記
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,             -- 筆數    add by 20130711 Angela
                   CHKDATE
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '7'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND PAYSEQNO = v_i_payseqno
               AND NACHGMK IS NULL                                 -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY CHKDATE, NLWKMK, ADWKMK, NACHGMK
             ORDER BY CHKDATE, NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_7_S';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收款立帳核定清單會計科目(遺屬)
            for v_dataSUMCur7 in c_dataCur_SUMrpt7 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur7.ISSUEAMT;

                       if (v_dataSUMCur7.NLWKMK = '1' or trim(v_dataSUMCur7.NLWKMK) is null) then
                           v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                           v_OPPACCOUNTNO   := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_OPPACCOUNTNAME := '保險給付－普通－本人死亡給付（年金）';    --add by 20130711 Angela
                       elsif  (v_dataSUMCur7.NLWKMK = '2' and v_dataSUMCur7.ADWKMK = '1') then
                           v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                           v_OPPACCOUNTNO   := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_OPPACCOUNTNAME := '保險給付－職災－本人死亡給付（年金）';    --add by 20130711 Angela
                       elsif  (v_dataSUMCur7.NLWKMK = '2' and v_dataSUMCur7.ADWKMK = '2') then
                           v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                           v_OPPACCOUNTNO   := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_OPPACCOUNTNAME := '保險給付－加職－本人死亡給付（年金）';    --add by 20130711 Angela
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_ACTTITLEAPCODE := 'FFG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur7.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_tmpAMT      := v_dataSUMCur7.UNACPAMT;
                       if (v_dataSUMCur7.NLWKMK = '1' or trim(v_dataSUMCur7.NLWKMK) is null) then
                           v_ACCOUNTNO   := '5171121 11054 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_ACCOUNTNAME := '保險給付－普通－本人死亡給付（年金）';
                       elsif  (v_dataSUMCur7.NLWKMK = '2' and v_dataSUMCur7.ADWKMK = '1') then
                           v_ACCOUNTNO   := '5171122 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_ACCOUNTNAME := '保險給付－職災－本人死亡給付（年金）';
                       elsif  (v_dataSUMCur7.NLWKMK = '2' and v_dataSUMCur7.ADWKMK = '2') then
                           v_ACCOUNTNO   := '5171122 12054 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_ACCOUNTNAME := '保險給付－加職－本人死亡給付（年金）';
                       end if;
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;
                    --寫入應收款立帳核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,NACHGMK                       -- 2012/06/15 Mark By ChungYu 應收款立帳不區分普職互改
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                          ) values (  '7'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,''
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     ,v_dataSUMCur7.NACHGMK
                                                     ,v_dataSUMCur7.NLWKMK
                                                     ,v_dataSUMCur7.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收款立帳核定清單會計科目資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_7_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_8_L
        PURPOSE:         產生應收已收核定清單(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_paydate       (varChar2)       --核付日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_8_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                     -- 應付金額

        --應收已收核定清單(老年)
        --目前僅針對退匯收回及止付出應收已收核定清單
        --因給付收回在撥付總表已呈現，故在應收已收核定清單不出，只出清冊
        Cursor c_dataCur_SUMrpt8 is
            SELECT  COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) AS ISSUEAMT                         --核定金額(A)
                   ,NVL(SUM(OTHERAAMT),0) AS OTHERAAMT                       --另案扣減同保險(B)
                   ,NVL(SUM(OTHERBAMT),0) AS OTHERBAMT                       --另案扣減他保險(C)
                   ,NVL(SUM(MITRATE),0) AS MITRATE                           --匯費(D)
                   ,NVL(SUM(OFFSETAMT),0) AS OFFSETAMT                       --抵銷紓困(E)
                   ,NVL(SUM(COMPENAMT),0) AS COMPENAMT                       --代扣補償金(F)
                   ,NVL(SUM(INHERITORAMT),0) AS INHERITORAMT                 --保留遺屬津貼(G)
                   ,NVL(SUM(ITRTTAX),0) AS ITRTTAX                           --代扣利息所得稅(H)
                   ,NVL(SUM(OTHERAMT),0) AS OTHERAMT                         --其他(I)
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '8'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND ISSUTYP <> 'F'
               AND ISSUTYP IN ('C','D')     --Modify by Angela 20131206
             GROUP BY ISSUTYP, CHKDATE, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, CHKDATE, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_8_L';
            v_g_genFlag := 0;
            v_g_flag := '0';
            --應收已收核定清單資料(老年)
            for v_dataSUMCur8 in c_dataCur_SUMrpt8 Loop
          --        v_payamt := 0;                            --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)
                  v_payamt := v_dataSUMCur8.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur8.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur8.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur8.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur8.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur8.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur8.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur8.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur8.OTHERAMT;       --  其他費用(I)

                  v_g_genFlag := 1;

                --寫入應收已收核定清單資料(老年)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         --,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur8.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_dataSUMCur8.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur8.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur8.APNOAMT
                                         ,v_dataSUMCur8.DATAAMT
                                         ,v_dataSUMCur8.ISSUEAMT
                                         ,v_dataSUMCur8.OTHERAAMT
                                         ,v_dataSUMCur8.OTHERBAMT
                                         ,v_dataSUMCur8.MITRATE
                                         ,v_dataSUMCur8.OFFSETAMT
                                         ,v_dataSUMCur8.COMPENAMT
                                         ,v_dataSUMCur8.INHERITORAMT
                                         ,v_dataSUMCur8.ITRTTAX
                                         ,v_dataSUMCur8.OTHERAMT
                                         ,v_payamt
                                         ,v_i_payseqno  --指定核付序號
                                         ,''  --備註
                                         --,''  --普職互改註記
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(老年)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收核定清單(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;

        end;
    --Procedure sp_BA_genPaySUMRPT_8_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_8_L
        PURPOSE:         產生應收已收核定清單會計科目

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_8_L (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單
        --目前僅針對退匯收回及止付出應收已收核定清單
        --因給付收回在撥付總表已呈現，故在應收已收核定清單不出，只出清冊
        Cursor c_dataCur_SUMrpt8 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           --核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,             --應收金額
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,            --筆數  add by 20130711 Angela
                   CHKDATE,
                   ISSUTYP                                        --核付分類  add by 20131206 Angela
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '8'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND PAYSEQNO = v_i_payseqno
               --AND ISSUTYP <> 'F'
               AND ISSUTYP IN ('C','D')     --Modify by Angela 20131206
             GROUP BY ISSUTYP,CHKDATE
             ORDER BY ISSUTYP,CHKDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_8_L';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收已收核定清單會計科目
            for v_dataSUMCur8 in c_dataCur_SUMrpt8 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_ACCOUNTNO   := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                       v_ACCOUNTNAME := '應付保管款－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur8.ISSUEAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --v_ACTTITLEAPCODE=GGG，乃是針對退匯收回及止付的案類代碼
                       --因給付收回在撥付總表已呈現，故在應收已收核定清單不出
                       --若日後需增列其他收回項目，v_ACTTITLEAPCODE需變動
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_OPPACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'GGG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur8.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur8.PAYAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入應收已收核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUTYP           --add by Angela 20131206
                                          ) values (  '8'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,v_i_issuym
                                                     ,''
                                                     ,v_i_chkdate
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_i_payseqno
                                                     --,''--NACHGMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_dataSUMCur8.ISSUTYP  --add by Angela 20131206
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
                '應收款立帳核定清單會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                 v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                     --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                        RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                        replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                        v_g_flag := '1';
                        v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_8_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_8_K
        PURPOSE:         產生應收已收核定清單(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_paydate       (varChar2)       --核付日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_8_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                     -- 應付金額

        --應收已收核定清單(失能)
        --目前僅針對退匯收回及止付出應收已收核定清單
        --因給付收回在撥付總表已呈現，故在應收已收核定清單不出，只出清冊
        Cursor c_dataCur_SUMrpt8 is
            SELECT  COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) AS ISSUEAMT                         --核定金額(A)
                   ,NVL(SUM(OTHERAAMT),0) AS OTHERAAMT                       --另案扣減同保險(B)
                   ,NVL(SUM(OTHERBAMT),0) AS OTHERBAMT                       --另案扣減他保險(C)
                   ,NVL(SUM(MITRATE),0) AS MITRATE                           --匯費(D)
                   ,NVL(SUM(OFFSETAMT),0) AS OFFSETAMT                       --抵銷紓困(E)
                   ,NVL(SUM(COMPENAMT),0) AS COMPENAMT                       --代扣補償金(F)
                   ,NVL(SUM(INHERITORAMT),0) AS INHERITORAMT                 --保留遺屬津貼(G)
                   ,NVL(SUM(ITRTTAX),0) AS ITRTTAX                           --代扣利息所得稅(H)
                   ,NVL(SUM(OTHERAMT),0) AS OTHERAMT                         --其他(I)
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '8'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND ISSUTYP <> 'F'
               AND ISSUTYP IN ('C','D')     --Modify by Angela 20131206
               AND PAYSEQNO =  v_i_payseqno
               AND NACHGMK IS Null                                            --普職互改要另外出
             GROUP BY ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_8_K';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收已收核定清單資料(失能)
            for v_dataSUMCur8 in c_dataCur_SUMrpt8 Loop
          --        v_payamt := 0;                            --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)
                  v_payamt := v_dataSUMCur8.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur8.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur8.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur8.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur8.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur8.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur8.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur8.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur8.OTHERAMT;       --  其他費用(I)

                  v_g_genFlag := 1;

                --寫入應收已收核定清單資料(失能)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur8.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_dataSUMCur8.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur8.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur8.APNOAMT
                                         ,v_dataSUMCur8.DATAAMT
                                         ,v_dataSUMCur8.ISSUEAMT
                                         ,v_dataSUMCur8.OTHERAAMT
                                         ,v_dataSUMCur8.OTHERBAMT
                                         ,v_dataSUMCur8.MITRATE
                                         ,v_dataSUMCur8.OFFSETAMT
                                         ,v_dataSUMCur8.COMPENAMT
                                         ,v_dataSUMCur8.INHERITORAMT
                                         ,v_dataSUMCur8.ITRTTAX
                                         ,v_dataSUMCur8.OTHERAMT
                                         ,v_payamt
                                         ,v_i_payseqno  --指定核付序號
                                         ,''  --備註
                                         ,v_dataSUMCur8.NLWKMK
                                         ,v_dataSUMCur8.ADWKMK
                                         ,v_dataSUMCur8.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(失能)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
                '應收已收核定清單(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                     --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                        RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                        replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                        v_g_flag := '1';
                        v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_8_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_8_K
        PURPOSE:         產生應收已收核定清單會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_8_K (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(失能)
        --目前僅針對退匯收回及止付出應收已收核定清單
        --因給付收回在撥付總表已呈現，故在應收已收核定清單不出，只出清冊
        Cursor c_dataCur_SUMrpt8 is
            SELECT NVL(SUM(Decode(PAYKIND,'37',0,ISSUEAMT)), 0) AS ISSUEAMTA, -- 核定金額(失能年金)
                   NVL(SUM(Decode(PAYKIND,'37',ISSUEAMT,0)), 0) AS ISSUEAMTB, -- 核定金額(失能補償金)
                   NVL(SUM(Decode(PAYKIND,'37',0,ISSUEAMT)), 0) AS PAYAMTA,   -- 應收金額(失能年金)
                   NVL(SUM(Decode(PAYKIND,'37',ISSUEAMT,0)), 0) AS PAYAMTB,   -- 應收金額(失能補償金)
                   NLWKMK,                                                    -- 普職註記
                   ADWKMK,                                                    -- 加職註記
                   NACHGMK,                                                   -- 普職互改註記
                   NVL(COUNT(*), 0) AS DATAAMT,                               -- 筆數    add by 20130711 Angela
                   CHKDATE,
                   ISSUTYP                                                    --核付分類  add by 20131206 Angela
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '8'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND ISSUTYP <> 'F'
               AND ISSUTYP IN ('C','D')     --Modify by Angela 20131206
               AND PAYSEQNO =  v_i_payseqno
           --    AND NACHGMK IS Null                                             --普職互改要另外出
             GROUP BY ISSUTYP,CHKDATE, NLWKMK, ADWKMK, NACHGMK
             ORDER BY ISSUTYP,CHKDATE, NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_8_K';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收已收核定清單會計科目(失能)
            for v_dataSUMCur8 in c_dataCur_SUMrpt8 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur8.ISSUEAMTA;
                       if (v_dataSUMCur8.NLWKMK = '1') or (v_dataSUMCur8.NLWKMK is null) then
                          v_ACCOUNTNO   := '2362121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11102 9)
                          v_ACCOUNTNAME := '應付保管款－普通－失能給付（年金）';
                          v_OPPACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                          v_OPPACCOUNTNAME := '其他應收款－普通－失能給付（年金）';      --add by 20130711 Angela
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '1') then
                          v_ACCOUNTNO   := '2362122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11102 2)
                          v_ACCOUNTNAME := '應付保管款－職災－失能給付（年金）';
                          v_OPPACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                          v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（年金）';      --add by 20130711 Angela
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '2') then
                          v_ACCOUNTNO   := '2362122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12102 3)
                          v_ACCOUNTNAME := '應付保管款－加職－失能給付（年金）';
                          v_OPPACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                          v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（年金）';      --add by 20130711 Angela
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --v_ACTTITLEAPCODE=GGG，乃是針對退匯收回及止付的案類代碼
                       --因給付收回在撥付總表已呈現，故在應收已收核定清單不出
                       --若日後需增列其他收回項目，v_ACTTITLEAPCODE需變動
                       v_ACCOUNTMEMO    := '';
                       v_ACTTITLEAPCODE := 'GGG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur8.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur8.ISSUEAMTB;
                       if (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '1') then
                          v_ACCOUNTNO   := '2362122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11101 4)
                          v_ACCOUNTNAME := '應付保管款－職災－失能給付（補償金）';
                          v_OPPACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                          v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';    --add by 20130711 Angela
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '2') then
                          v_ACCOUNTNO   := '2362122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12101 5)
                          v_ACCOUNTNAME := '應付保管款－加職－失能給付（補償金）';
                          v_OPPACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                          v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';    --add by 20130711 Angela
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --v_ACTTITLEAPCODE=GGG，乃是針對退匯收回及止付的案類代碼
                       --因給付收回在撥付總表已呈現，故在應收已收核定清單不出
                       --若日後需增列其他收回項目，v_ACTTITLEAPCODE需變動
                       v_ACCOUNTMEMO    := '';
                       v_ACTTITLEAPCODE := 'GGG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur8.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 3 then
                       v_tmpAMT      := v_dataSUMCur8.PAYAMTA;
                       if (v_dataSUMCur8.NLWKMK = '1') or (v_dataSUMCur8.NLWKMK is null) then
                          v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                          v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '1') then
                          v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                          v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '2') then
                          v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                          v_ACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 4 then
                       v_tmpAMT      := v_dataSUMCur8.PAYAMTB;
                       if (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '1') then
                          v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                          v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '2') then
                          v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                          v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;
                    --寫入應收已收核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(
                                                     RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUTYP           --add by Angela 20131206
                                          ) values (
                                                     '8'
                                                    ,v_i_cprndt
                                                    ,v_i_paycode
                                                    ,v_i_issuym
                                                    ,''
                                                    ,v_i_chkdate
                                                    ,''
                                                    ,v_ACCOUNTSEQ
                                                    ,v_count
                                                    ,v_ACCOUNTNO
                                                    ,v_ACCOUNTNAME
                                                    ,v_tmpAMT
                                                    ,v_i_payseqno
                                                    --,''--NACHGMK
                                                    ,v_dataSUMCur8.NLWKMK
                                                    ,v_dataSUMCur8.ADWKMK
                                                    ,v_dataSUMCur8.NACHGMK
                                                    ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                    ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                    ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                    ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,v_DATACD            --add by Angela 20130711
                                                    ,v_DECIDEAMT         --add by Angela 20130711
                                                    ,v_CASHAMT           --add by Angela 20130711
                                                    ,v_CUTAMT            --add by Angela 20130711
                                                    ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,v_CNT               --add by Angela 20130711
                                                    ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,v_dataSUMCur8.ISSUTYP  --add by Angela 20131206
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
                '應收款立帳核定清單會計科目(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                       --修改log作法 by TseHua 20180419
                        sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                          RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                          replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                          v_g_flag := '1';
                          v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_8_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_8_S
        PURPOSE:         產生應收已收核定清單(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_paydate       (varChar2)       --核付日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_8_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                     -- 應付金額

        --應收已收核定清單(遺屬)
        --目前僅針對退匯收回及止付出應收已收核定清單
        --因給付收回在撥付總表已呈現，故在應收已收核定清單不出，只出清冊
        Cursor c_dataCur_SUMrpt8 is
            SELECT  COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) AS ISSUEAMT                         --核定金額(A)
                   ,NVL(SUM(OTHERAAMT),0) AS OTHERAAMT                       --另案扣減同保險(B)
                   ,NVL(SUM(OTHERBAMT),0) AS OTHERBAMT                       --另案扣減他保險(C)
                   ,NVL(SUM(MITRATE),0) AS MITRATE                           --匯費(D)
                   ,NVL(SUM(OFFSETAMT),0) AS OFFSETAMT                       --抵銷紓困(E)
                   ,NVL(SUM(COMPENAMT),0) AS COMPENAMT                       --代扣補償金(F)
                   ,NVL(SUM(INHERITORAMT),0) AS INHERITORAMT                 --保留遺屬津貼(G)
                   ,NVL(SUM(ITRTTAX),0) AS ITRTTAX                           --代扣利息所得稅(H)
                   ,NVL(SUM(OTHERAMT),0) AS OTHERAMT                         --其他(I)
                   ,CHKDATE                                                  --(月)核定日期/應收立帳日期
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP
                   ,ISSUTYP                                                  --核付分類  add by 20131206 Angela                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '8'
               AND ISSUYM = v_i_issuym
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND ISSUTYP <> 'F'
               AND ISSUTYP IN ('C','D')     --Modify by Angela 20131206
               AND NACHGMK IS Null                                            --普職互改要另外出
             GROUP BY ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, CHKDATE, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_8_S';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --應收已收核定清單資料(遺屬)
            for v_dataSUMCur8 in c_dataCur_SUMrpt8 Loop
          --        v_payamt := 0;                            --  計算應付金額=(A)-(B)-(C)-(D)-(E)-(F)-(G)-(H)-(I)
                  v_payamt := v_dataSUMCur8.ISSUEAMT          --  核定金額(A)
                              - v_dataSUMCur8.OTHERAAMT       --  另案扣減(同類保險)金額(B)
                              - v_dataSUMCur8.OTHERBAMT       --  另案扣減(他類保險)金額(C)
                              - v_dataSUMCur8.MITRATE         --  匯款匯費(D)
                              - v_dataSUMCur8.OFFSETAMT       --  抵銷紓困費用(E)
                              - v_dataSUMCur8.COMPENAMT       --  代扣補償金(F)
                              - v_dataSUMCur8.INHERITORAMT    --  保留遺屬津貼(G)
                              - v_dataSUMCur8.ITRTTAX         --  代扣利息所得稅(H)
                              - v_dataSUMCur8.OTHERAMT;       --  其他費用(I)

                  v_g_genFlag := 1;

                --寫入應收已收核定清單資料(遺屬)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur8.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_dataSUMCur8.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur8.ISSUTYP
                                         ,v_i_issuym
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur8.APNOAMT
                                         ,v_dataSUMCur8.DATAAMT
                                         ,v_dataSUMCur8.ISSUEAMT
                                         ,v_dataSUMCur8.OTHERAAMT
                                         ,v_dataSUMCur8.OTHERBAMT
                                         ,v_dataSUMCur8.MITRATE
                                         ,v_dataSUMCur8.OFFSETAMT
                                         ,v_dataSUMCur8.COMPENAMT
                                         ,v_dataSUMCur8.INHERITORAMT
                                         ,v_dataSUMCur8.ITRTTAX
                                         ,v_dataSUMCur8.OTHERAMT
                                         ,v_payamt
                                         ,v_i_payseqno  --指定核付序號
                                         ,''  --備註
                                         ,v_dataSUMCur8.NLWKMK
                                         ,v_dataSUMCur8.ADWKMK
                                         ,v_dataSUMCur8.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(遺屬)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
                 '應收已收核定清單(遺屬)資料處理完成'||v_g_errMsg,replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                     --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                        RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                        replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                        v_g_flag := '1';
                        v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_8_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_8_S
        PURPOSE:         產生應收已收核定清單會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_8_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_payseqno            in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(遺屬)
        --目前僅針對退匯收回及止付出應收已收核定清單
        --因給付收回在撥付總表已呈現，故在應收已收核定清單不出，只出清冊
        Cursor c_dataCur_SUMrpt8 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,                       -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS PAYAMT,                         -- 應收金額
                   NLWKMK,                                                    -- 普職註記
                   ADWKMK,                                                    -- 加職註記
                   NACHGMK,                                                   -- 普職互改註記
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT,                        -- 筆數    add by 20130711 Angela
                   CHKDATE,
                   ISSUTYP                                                    --核付分類  add by 20131206 Angela
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '8'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND ISSUTYP <> 'F'
               AND ISSUTYP IN ('C','D')     --Modify by Angela 20131206
          --     AND PAYSEQNO =  v_i_payseqno
          --     AND NACHGMK IS Null                                             --普職互改要另外出
             GROUP BY ISSUTYP,CHKDATE, NLWKMK, ADWKMK, NACHGMK
             ORDER BY ISSUTYP,CHKDATE, NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_8_S';
            v_count     := 0;
            v_g_genFlag := 0;

            --應收已收核定清單會計科目(遺屬)
            for v_dataSUMCur8 in c_dataCur_SUMrpt8 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur8.ISSUEAMT;
                       if (v_dataSUMCur8.NLWKMK = '1') or (v_dataSUMCur8.NLWKMK is null) then
                          v_ACCOUNTNO   := '2362121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11054 A)
                          v_ACCOUNTNAME := '應付保管款－普通－本人死亡給付（年金）';
                          v_OPPACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                          v_OPPACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';    --add by 20130711 Angela
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '1') then
                          v_ACCOUNTNO   := '2362122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11054 4)
                          v_ACCOUNTNAME := '應付保管款－職災－本人死亡給付（年金）';
                          v_OPPACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                          v_OPPACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';    --add by 20130711 Angela
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '2') then
                          v_ACCOUNTNO   := '2362122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12054 5)
                          v_ACCOUNTNAME := '應付保管款－加職－本人死亡給付（年金）';
                          v_OPPACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                          v_OPPACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';    --add by 20130711 Angela
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --v_ACTTITLEAPCODE=GGG，乃是針對退匯收回及止付的案類代碼
                       --因給付收回在撥付總表已呈現，故在應收已收核定清單不出
                       --若日後需增列其他收回項目，v_ACTTITLEAPCODE需變動
                       v_ACCOUNTMEMO    := '';
                       v_ACTTITLEAPCODE := 'GGG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur8.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_tmpAMT      := v_dataSUMCur8.PAYAMT;
                       if (v_dataSUMCur8.NLWKMK = '1') or (v_dataSUMCur8.NLWKMK is null) then
                          v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                          v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '1') then
                          v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                          v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                       elsif (v_dataSUMCur8.NLWKMK = '2') And (v_dataSUMCur8.ADWKMK = '2') then
                          v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                          v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;
                    --寫入應收已收核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    --,NACHGMK
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUTYP           --add by Angela 20131206
                                          ) values (
                                                     '8'
                                                    ,v_i_cprndt
                                                    ,v_i_paycode
                                                    ,v_i_issuym
                                                    ,''
                                                    ,v_i_chkdate
                                                    ,''
                                                    ,v_ACCOUNTSEQ
                                                    ,v_count
                                                    ,v_ACCOUNTNO
                                                    ,v_ACCOUNTNAME
                                                    ,v_tmpAMT
                                                    ,v_i_payseqno
                                                    --,''--NACHGMK
                                                    ,v_dataSUMCur8.NLWKMK
                                                    ,v_dataSUMCur8.ADWKMK
                                                    ,v_dataSUMCur8.NACHGMK
                                                    ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                    ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                    ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                    ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,v_DATACD            --add by Angela 20130711
                                                    ,v_DECIDEAMT         --add by Angela 20130711
                                                    ,v_CASHAMT           --add by Angela 20130711
                                                    ,v_CUTAMT            --add by Angela 20130711
                                                    ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,v_CNT               --add by Angela 20130711
                                                    ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,v_dataSUMCur8.ISSUTYP  --add by Angela 20131206
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
                 '應收款立帳核定清單會計科目(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收款立帳核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_8_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_12_L
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的金額資料(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_12_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收核定清單(單筆退現收回)(老年)
        cursor c_dataCur_SUMRpt12 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '12'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_12_L';
            v_g_genFlag := 0;

            --應收已收核定清單(單筆退現收回)(老年)
            for v_dataSUMCur12 in c_dataCur_SUMRpt12 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur12.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur12.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur12.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur12.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur12.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur12.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur12.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur12.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur12.OTHERAMT;                        --其他費用(I)

                --寫入應收已收核定清單(單筆退現收回)(老年)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur12.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur12.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur12.ISSUTYP
                                        ,v_dataSUMCur12.ISSUYM
                                        ,v_dataSUMCur12.APNOAMT
                                        ,v_dataSUMCur12.DATAAMT
                                        ,v_dataSUMCur12.ISSUEAMT
                                        ,v_dataSUMCur12.OTHERAAMT
                                        ,v_dataSUMCur12.OTHERBAMT
                                        ,v_dataSUMCur12.MITRATE
                                        ,v_dataSUMCur12.OFFSETAMT
                                        ,v_dataSUMCur12.COMPENAMT
                                        ,v_dataSUMCur12.INHERITORAMT
                                        ,v_dataSUMCur12.ITRTTAX
                                        ,v_dataSUMCur12.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur12.APNO
                                        ,v_dataSUMCur12.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(老年)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收核定清單(單筆退現收回)(老年)處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(老年)-['||v_i_apno||']:'||v_g_errMsg);
                      --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                         RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(老年)-['||v_i_apno||']:'||v_g_errMsg,
                        replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

            end;
    --Procedure sp_BA_genPaySUMRPT_12_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_12_L
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的會計科目(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_12_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER                              := 0;
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(單筆退現收回)
        cursor c_dataCur_SUMRpt12 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT           --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT               --應收金額
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT             --筆數
                  ,t.CHKDATE                                     --核定日期
                  ,t.ISSUTYP                                     --核付分類
                  ,t.RPTTYP                                      --清冊別
                  ,t.ISSUYM                                      --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '12'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_12_L';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收核定清單(單筆退現收回)會計科目
            for v_dataSUMCur12 in c_dataCur_SUMRpt12 Loop
                v_count          := 0;
                v_g_genFlag      := 1;
                v_ACCOUNTSEQ     := null;
                v_ACCOUNTNO      := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTNAME    := '';
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_ACCOUNTNO   := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                        v_ACCOUNTNAME := '暫收及待結轉帳項－現─暫收款';
                        v_tmpAMT      := v_dataSUMCur12.ISSUEAMT;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_OPPACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                        v_ACTTITLEAPCODE := 'GVG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur12.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                        v_tmpAMT      := v_dataSUMCur12.PAYAMT;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單(單筆退現收回)會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur12.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur12.ISSUYM
                                                  ,''
                                                  ,v_i_acpdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur12.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目(老年)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '應收已收核定清單(單筆退現收回)會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_12_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_12_K
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的金額資料(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua



        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_12_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收核定清單(單筆退現收回)(失能)
        cursor c_dataCur_SUMRpt12 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '12'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_12_K';
            v_g_genFlag := 0;

            --應收已收核定清單(單筆退現收回)(失能)
            for v_dataSUMCur12 in c_dataCur_SUMRpt12 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur12.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur12.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur12.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur12.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur12.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur12.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur12.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur12.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur12.OTHERAMT;                        --其他費用(I)

                --寫入應收已收核定清單(單筆退現收回)(失能)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur12.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur12.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur12.ISSUTYP
                                        ,v_dataSUMCur12.ISSUYM
                                        ,v_dataSUMCur12.APNOAMT
                                        ,v_dataSUMCur12.DATAAMT
                                        ,v_dataSUMCur12.ISSUEAMT
                                        ,v_dataSUMCur12.OTHERAAMT
                                        ,v_dataSUMCur12.OTHERBAMT
                                        ,v_dataSUMCur12.MITRATE
                                        ,v_dataSUMCur12.OFFSETAMT
                                        ,v_dataSUMCur12.COMPENAMT
                                        ,v_dataSUMCur12.INHERITORAMT
                                        ,v_dataSUMCur12.ITRTTAX
                                        ,v_dataSUMCur12.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur12.NLWKMK
                                        ,v_dataSUMCur12.ADWKMK
                                        ,v_dataSUMCur12.NACHGMK
                                        ,v_dataSUMCur12.APNO
                                        ,v_dataSUMCur12.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(失能)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(失能)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收核定清單(單筆退現收回)(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(失能)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(失能)-['||v_i_apno||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPaySUMRPT_12_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_12_K
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的會計科目(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_12_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(單筆退現收回)
        cursor c_dataCur_SUMRpt12 is
            select nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as ISSUEAMTA   --核定金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as ISSUEAMTB   --核定金額(失能補償金)
                  ,nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as PAYAMTA     --應收金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as PAYAMTB     --應收金額(失能補償金)
                  ,t.NLWKMK                                                        --普職註記
                  ,t.ADWKMK                                                        --加職註記
                  ,t.NACHGMK                                                       --普職互改註記
                  ,nvl(count(*), 0) as DATAAMT                                     --筆數
                  ,t.CHKDATE                                                       --核定日期
                  ,t.ISSUTYP                                                       --核付分類
                  ,t.RPTTYP                                                        --清冊別
                  ,t.ISSUYM                                                        --核定年月
              FROM BAPAYRPTRECORD t
             where t.RPTTYP = '12'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_12_K';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收核定清單(單筆退現收回)
            for v_dataSUMCur12 in c_dataCur_SUMRpt12 Loop
                v_count       := 0;
                v_g_genFlag   := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur12.ISSUEAMTA;
                        if (v_dataSUMCur12.NLWKMK = '1') or (v_dataSUMCur12.NLWKMK is null) then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_OPPACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '1') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '2') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                            v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'GVG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur12.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur12.ISSUEAMTB;
                        if (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '1') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '2') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'GVG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur12.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 3 then
                        v_tmpAMT      := v_dataSUMCur12.PAYAMTA;
                        if (v_dataSUMCur12.NLWKMK = '1') or (v_dataSUMCur12.NLWKMK is null) then
                            v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '1') then
                            v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '2') then
                            v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME  := '其他應收款－加職－失能給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    elsif i = 4 then
                        v_tmpAMT      := v_dataSUMCur12.PAYAMTB;
                        if (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '1') then
                            v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '2') then
                            v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur12.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur12.ISSUYM
                                                  ,''
                                                  ,v_i_acpdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur12.NLWKMK
                                                  ,v_dataSUMCur12.ADWKMK
                                                  ,v_dataSUMCur12.NACHGMK
                                                  ,replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', '')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur12.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收核定清單(單筆退現收回)會計科目資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目-['||v_i_apno||']:'||v_g_errMsg);
                      --修改log作法 by TseHua 20180419
                        sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                         RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)會計科目-['||v_i_apno||']:'||v_g_errMsg,
                         replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


          end;
    --Procedure sp_BA_genPayACCOUNTRPT_12_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_12_S
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的金額資料(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_12_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收核定清單(單筆退現收回)(遺屬)
        cursor c_dataCur_SUMRpt12 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '12'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_12_S';
            v_g_genFlag := 0;

            --應收已收核定清單(單筆退現收回)(遺屬)
            for v_dataSUMCur12 in c_dataCur_SUMRpt12 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur12.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur12.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur12.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur12.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur12.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur12.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur12.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur12.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur12.OTHERAMT;                        --其他費用(I)

                --寫入應收已收核定清單(單筆退現收回)(遺屬)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur12.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur12.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur12.ISSUTYP
                                        ,v_dataSUMCur12.ISSUYM
                                        ,v_dataSUMCur12.APNOAMT
                                        ,v_dataSUMCur12.DATAAMT
                                        ,v_dataSUMCur12.ISSUEAMT
                                        ,v_dataSUMCur12.OTHERAAMT
                                        ,v_dataSUMCur12.OTHERBAMT
                                        ,v_dataSUMCur12.MITRATE
                                        ,v_dataSUMCur12.OFFSETAMT
                                        ,v_dataSUMCur12.COMPENAMT
                                        ,v_dataSUMCur12.INHERITORAMT
                                        ,v_dataSUMCur12.ITRTTAX
                                        ,v_dataSUMCur12.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur12.NLWKMK
                                        ,v_dataSUMCur12.ADWKMK
                                        ,v_dataSUMCur12.NACHGMK
                                        ,v_dataSUMCur12.APNO
                                        ,v_dataSUMCur12.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(遺屬)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(遺屬)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收核定清單(單筆退現收回)(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(遺屬)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(遺屬)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
        end;
    --Procedure sp_BA_genPaySUMRPT_12_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_12_S
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的會計科目(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_12_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO            BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO           BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME         BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE         BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                 BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT              BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT                BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                 BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE          BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                    BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK          BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(單筆退現收回)
        cursor c_dataCur_SUMRpt12 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT                       --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT                           --應收金額
                  ,t.NLWKMK                                                  --普職註記
                  ,t.ADWKMK                                                  --加職註記
                  ,t.NACHGMK                                                 --普職互改註記
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT                         --筆數
                  ,t.CHKDATE                                                 --核定日期
                  ,t.ISSUTYP                                                 --核付分類
                  ,t.RPTTYP                                                  --清冊別
                  ,t.ISSUYM                                                  --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '12'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_12_S';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收核定清單(單筆退現收回)
            for v_dataSUMCur12 in c_dataCur_SUMRpt12 Loop
                v_count     := 0;
                v_g_genFlag := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur12.ISSUEAMT;
                        if (v_dataSUMCur12.NLWKMK = '1') or (v_dataSUMCur12.NLWKMK is null) then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                            v_OPPACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '1') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                            v_OPPACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '2') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                            v_OPPACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                            v_OPPACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'GVG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur12.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_tmpAMT      := v_dataSUMCur12.PAYAMT;
                        if (v_dataSUMCur12.NLWKMK = '1') or (v_dataSUMCur12.NLWKMK is null) then
                            v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                            v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '1') then
                            v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                            v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur12.NLWKMK = '2') and (v_dataSUMCur12.ADWKMK = '2') then
                            v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                            v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur12.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur12.ISSUYM
                                                  ,''
                                                  ,v_i_acpdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur12.NLWKMK
                                                  ,v_dataSUMCur12.ADWKMK
                                                  ,v_dataSUMCur12.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur12.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收核定清單(單筆退現收回)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(遺屬)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退現收回)(遺屬)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPayACCOUNTRPT_12_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_13_L
        PURPOSE:         產生應收已收核定清單(單筆退匯收回)的金額資料(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_13_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收核定清單(單筆退匯收回)(老年)
        cursor c_dataCur_SUMRpt13 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '13'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_13_L';
            v_g_genFlag := 0;

            --應收已收核定清單(單筆退匯收回)(老年)
            for v_dataSUMCur13 in c_dataCur_SUMRpt13 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur13.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur13.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur13.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur13.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur13.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur13.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur13.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur13.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur13.OTHERAMT;                        --其他費用(I)

                --寫入應收已收核定清單(單筆退匯收回)(老年)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur13.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur13.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur13.ISSUTYP
                                        ,v_dataSUMCur13.ISSUYM
                                        ,v_dataSUMCur13.APNOAMT
                                        ,v_dataSUMCur13.DATAAMT
                                        ,v_dataSUMCur13.ISSUEAMT
                                        ,v_dataSUMCur13.OTHERAAMT
                                        ,v_dataSUMCur13.OTHERBAMT
                                        ,v_dataSUMCur13.MITRATE
                                        ,v_dataSUMCur13.OFFSETAMT
                                        ,v_dataSUMCur13.COMPENAMT
                                        ,v_dataSUMCur13.INHERITORAMT
                                        ,v_dataSUMCur13.ITRTTAX
                                        ,v_dataSUMCur13.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur13.APNO
                                        ,v_dataSUMCur13.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(老年)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收核定清單(單筆退匯收回)(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(老年)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPaySUMRPT_13_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_13_L
        PURPOSE:         產生應收已收核定清單(單筆退匯收回)的會計科目(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_13_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER                              := 0;
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(單筆退匯收回)
        cursor c_dataCur_SUMRpt13 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT           --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT               --應收金額
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT             --筆數
                  ,t.CHKDATE                                     --核定日期
                  ,t.ISSUTYP                                     --核付分類
                  ,t.RPTTYP                                      --清冊別
                  ,t.ISSUYM                                      --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '13'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_13_L';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收核定清單(單筆退匯收回)會計科目
            for v_dataSUMCur13 in c_dataCur_SUMRpt13 Loop
                v_count          := 0;
                v_g_genFlag      := 1;
                v_ACCOUNTSEQ     := null;
                v_ACCOUNTNO      := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTNAME    := '';
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_ACCOUNTNO   := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                        v_ACCOUNTNAME := '應付保管款－普通－老年給付（年金）';
                        v_tmpAMT      := v_dataSUMCur13.ISSUEAMT;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_OPPACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                        v_ACTTITLEAPCODE := 'GGG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur13.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                        v_tmpAMT      := v_dataSUMCur13.PAYAMT;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單(單筆退匯收回)會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur13.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur13.ISSUYM
                                                  ,''
                                                  ,v_i_acpdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur13.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)會計科目(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)會計科目(老年)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收核定清單(單筆退匯收回)會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>單筆退匯收回(單筆退現收回)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>單筆退匯收回(單筆退現收回)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_13_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_13_K
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的金額資料(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_13_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收核定清單(單筆退匯收回)(失能)
        cursor c_dataCur_SUMRpt13 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '13'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_13_K';
            v_g_genFlag := 0;

            --應收已收核定清單(單筆退匯收回)(失能)
            for v_dataSUMCur13 in c_dataCur_SUMRpt13 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur13.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur13.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur13.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur13.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur13.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur13.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur13.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur13.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur13.OTHERAMT;                        --其他費用(I)

                --寫入應收已收核定清單(單筆退匯收回)(失能)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur13.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur13.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur13.ISSUTYP
                                        ,v_dataSUMCur13.ISSUYM
                                        ,v_dataSUMCur13.APNOAMT
                                        ,v_dataSUMCur13.DATAAMT
                                        ,v_dataSUMCur13.ISSUEAMT
                                        ,v_dataSUMCur13.OTHERAAMT
                                        ,v_dataSUMCur13.OTHERBAMT
                                        ,v_dataSUMCur13.MITRATE
                                        ,v_dataSUMCur13.OFFSETAMT
                                        ,v_dataSUMCur13.COMPENAMT
                                        ,v_dataSUMCur13.INHERITORAMT
                                        ,v_dataSUMCur13.ITRTTAX
                                        ,v_dataSUMCur13.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur13.NLWKMK
                                        ,v_dataSUMCur13.ADWKMK
                                        ,v_dataSUMCur13.NACHGMK
                                        ,v_dataSUMCur13.APNO
                                        ,v_dataSUMCur13.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(失能)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(失能)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'0',
               '應收已收核定清單(單筆退匯收回)(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(失能)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(失能)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
        end;
    --Procedure sp_BA_genPaySUMRPT_13_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_13_K
        PURPOSE:         產生應收已收核定清單(單筆退匯收回)的會計科目(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_13_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(單筆退匯收回)
        cursor c_dataCur_SUMRpt13 is
            select nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as ISSUEAMTA   --核定金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as ISSUEAMTB   --核定金額(失能補償金)
                  ,nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as PAYAMTA     --應收金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as PAYAMTB     --應收金額(失能補償金)
                  ,t.NLWKMK                                                        --普職註記
                  ,t.ADWKMK                                                        --加職註記
                  ,t.NACHGMK                                                       --普職互改註記
                  ,nvl(count(*), 0) as DATAAMT                                     --筆數
                  ,t.CHKDATE                                                       --核定日期
                  ,t.ISSUTYP                                                       --核付分類
                  ,t.RPTTYP                                                        --清冊別
                  ,t.ISSUYM                                                        --核定年月
              FROM BAPAYRPTRECORD t
             where t.RPTTYP = '13'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_13_K';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收核定清單(單筆退匯收回)
            for v_dataSUMCur13 in c_dataCur_SUMRpt13 Loop
                v_count       := 0;
                v_g_genFlag   := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur13.ISSUEAMTA;
                        if (v_dataSUMCur13.NLWKMK = '1') or (v_dataSUMCur13.NLWKMK is null) then
                            v_ACCOUNTNO      := '2362121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11102 9)
                            v_ACCOUNTNAME    := '應付保管款－普通－失能給付（年金）';
                            v_OPPACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_OPPACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '1') then
                            v_ACCOUNTNO      := '2362122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11102 2)
                            v_ACCOUNTNAME    := '應付保管款－職災－失能給付（年金）';
                            v_OPPACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '2') then
                            v_ACCOUNTNO      := '2362122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12102 3)
                            v_ACCOUNTNAME    := '應付保管款－加職－失能給付（年金）';
                            v_OPPACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                            v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'GGG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur13.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur13.ISSUEAMTB;
                        if (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '1') then
                            v_ACCOUNTNO      := '2362122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11101 4)
                            v_ACCOUNTNAME    := '應付保管款－職災－失能給付（補償金）';
                            v_OPPACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '2') then
                            v_ACCOUNTNO      := '2362122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12101 5)
                            v_ACCOUNTNAME    := '應付保管款－加職－失能給付（補償金）';
                            v_OPPACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'GGG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur13.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 3 then
                        v_tmpAMT      := v_dataSUMCur13.PAYAMTA;
                        if (v_dataSUMCur13.NLWKMK = '1') or (v_dataSUMCur13.NLWKMK is null) then
                            v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '1') then
                            v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '2') then
                            v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                           v_ACCOUNTNAME  := '其他應收款－加職－失能給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    elsif i = 4 then
                        v_tmpAMT      := v_dataSUMCur13.PAYAMTB;
                        if (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '1') then
                            v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '2') then
                            v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur13.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur13.ISSUYM
                                                  ,''
                                                  ,v_i_acpdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur13.NLWKMK
                                                  ,v_dataSUMCur13.ADWKMK
                                                  ,v_dataSUMCur13.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur13.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)會計科目-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)會計科目-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收核定清單(單筆退匯收回)會計科目資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)會計科目-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                        RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)會計科目-['||v_i_apno||']:'||v_g_errMsg,
                        replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));



        end;
    --Procedure sp_BA_genPayACCOUNTRPT_13_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_13_S
        PURPOSE:         產生應收已收核定清單(單筆退現收回)的金額資料(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_13_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收核定清單(單筆退匯收回)(遺屬)
        cursor c_dataCur_SUMRpt13 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '13'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_13_S';
            v_g_genFlag := 0;

            --應收已收核定清單(單筆退匯收回)(遺屬)
            for v_dataSUMCur13 in c_dataCur_SUMRpt13 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur13.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur13.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur13.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur13.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur13.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur13.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur13.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur13.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur13.OTHERAMT;                        --其他費用(I)

                --寫入應收已收核定清單(單筆退匯收回)(遺屬)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur13.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur13.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur13.ISSUTYP
                                        ,v_dataSUMCur13.ISSUYM
                                        ,v_dataSUMCur13.APNOAMT
                                        ,v_dataSUMCur13.DATAAMT
                                        ,v_dataSUMCur13.ISSUEAMT
                                        ,v_dataSUMCur13.OTHERAAMT
                                        ,v_dataSUMCur13.OTHERBAMT
                                        ,v_dataSUMCur13.MITRATE
                                        ,v_dataSUMCur13.OFFSETAMT
                                        ,v_dataSUMCur13.COMPENAMT
                                        ,v_dataSUMCur13.INHERITORAMT
                                        ,v_dataSUMCur13.ITRTTAX
                                        ,v_dataSUMCur13.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur13.NLWKMK
                                        ,v_dataSUMCur13.ADWKMK
                                        ,v_dataSUMCur13.NACHGMK
                                        ,v_dataSUMCur13.APNO
                                        ,v_dataSUMCur13.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(遺屬)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(遺屬)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收核定清單(單筆退匯收回)(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(遺屬)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)(遺屬)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPaySUMRPT_13_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_13_S
        PURPOSE:         產生應收已收核定清單(單筆退匯收回)的會計科目(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_acpdate       (varChar2)       --已收日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_13_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_acpdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO            BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO           BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME         BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE         BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                 BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT              BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT                BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                 BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE          BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                    BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK          BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收核定清單(單筆退匯收回)
        cursor c_dataCur_SUMRpt13 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT                       --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT                           --應收金額
                  ,t.NLWKMK                                                  --普職註記
                  ,t.ADWKMK                                                  --加職註記
                  ,t.NACHGMK                                                 --普職互改註記
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT                         --筆數
                  ,t.CHKDATE                                                 --核定日期
                  ,t.ISSUTYP                                                 --核付分類
                  ,t.RPTTYP                                                  --清冊別
                  ,t.ISSUYM                                                  --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '13'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_acpdate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_13_S';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收核定清單(單筆退匯收回)
            for v_dataSUMCur13 in c_dataCur_SUMRpt13 Loop
                v_count     := 0;
                v_g_genFlag := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur13.ISSUEAMT;
                        if (v_dataSUMCur13.NLWKMK = '1') or (v_dataSUMCur13.NLWKMK is null) then
                            v_ACCOUNTNO      := '2362121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11054 A)
                            v_ACCOUNTNAME    := '應付保管款－普通－本人死亡給付（年金）';
                            v_OPPACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                            v_OPPACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '1') then
                            v_ACCOUNTNO      := '2362122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11054 4)
                            v_ACCOUNTNAME    := '應付保管款－職災－本人死亡給付（年金）';
                            v_OPPACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                            v_OPPACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '2') then
                            v_ACCOUNTNO      := '2362122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12054 5)
                            v_ACCOUNTNAME    := '應付保管款－加職－本人死亡給付（年金）';
                            v_OPPACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                            v_OPPACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'GGG';
                        v_DATACD         := '1';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur13.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_tmpAMT      := v_dataSUMCur13.PAYAMT;
                        if (v_dataSUMCur13.NLWKMK = '1') or (v_dataSUMCur13.NLWKMK is null) then
                            v_ACCOUNTNO   := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                            v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '1') then
                            v_ACCOUNTNO   := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                            v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（遺屬年金）';
                        elsif (v_dataSUMCur13.NLWKMK = '2') and (v_dataSUMCur13.ADWKMK = '2') then
                            v_ACCOUNTNO   := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                            v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（遺屬年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur13.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur13.ISSUYM
                                                  ,''
                                                  ,v_i_acpdate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur13.NLWKMK
                                                  ,v_dataSUMCur13.ADWKMK
                                                  ,v_dataSUMCur13.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur13.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收核定清單(單筆退匯收回)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收核定清單(單筆退匯收回)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPayACCOUNTRPT_13_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_14_L
        PURPOSE:         產生應收已收註銷清冊(單筆退現收回註銷)的金額資料(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_14_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收註銷清冊(單筆退現收回註銷)(老年)
        cursor c_dataCur_SUMRpt14 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '14'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_14_L';
            v_g_genFlag := 0;

            --應收已收註銷清冊(單筆退現收回註銷)(老年)
            for v_dataSUMCur14 in c_dataCur_SUMRpt14 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur14.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur14.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur14.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur14.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur14.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur14.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur14.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur14.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur14.OTHERAMT;                        --其他費用(I)

                --寫入應收已收註銷清冊(單筆退現收回註銷)(老年)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur14.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur14.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur14.ISSUTYP
                                        ,v_dataSUMCur14.ISSUYM
                                        ,v_dataSUMCur14.APNOAMT
                                        ,v_dataSUMCur14.DATAAMT
                                        ,v_dataSUMCur14.ISSUEAMT
                                        ,v_dataSUMCur14.OTHERAAMT
                                        ,v_dataSUMCur14.OTHERBAMT
                                        ,v_dataSUMCur14.MITRATE
                                        ,v_dataSUMCur14.OFFSETAMT
                                        ,v_dataSUMCur14.COMPENAMT
                                        ,v_dataSUMCur14.INHERITORAMT
                                        ,v_dataSUMCur14.ITRTTAX
                                        ,v_dataSUMCur14.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur14.APNO
                                        ,v_dataSUMCur14.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(老年)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退現收回註銷)(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(老年)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPaySUMRPT_14_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_14_L
        PURPOSE:         產生應收已收註銷清冊(單筆退現收回註銷)的會計科目(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_14_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER                              := 0;
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收註銷清冊(單筆退現收回註銷)
        cursor c_dataCur_SUMRpt14 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT           --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT               --應收金額
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT             --筆數
                  ,t.CHKDATE                                     --核定日期
                  ,t.ISSUTYP                                     --核付分類
                  ,t.RPTTYP                                      --清冊別
                  ,t.ISSUYM                                      --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '14'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_14_L';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收註銷清冊(單筆退現收回註銷)會計科目
            for v_dataSUMCur14 in c_dataCur_SUMRpt14 Loop
                v_count          := 0;
                v_g_genFlag      := 1;
                v_ACCOUNTSEQ     := null;
                v_ACCOUNTNO      := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTNAME    := '';
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                        v_tmpAMT      := v_dataSUMCur14.ISSUEAMT;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                        v_OPPACCOUNTNAME := '暫收及待結轉帳項－現─暫收款';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur14.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTNO   := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                        v_ACCOUNTNAME := '暫收及待結轉帳項－現─暫收款';
                        v_tmpAMT      := v_dataSUMCur14.PAYAMT;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收註銷清冊(單筆退現收回註銷)會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur14.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur14.ISSUYM
                                                  ,''
                                                  ,v_i_canceldate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur14.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目(老年)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收註銷清冊(單筆退現收回註銷)會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_14_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_14_K
        PURPOSE:         產生應收已收註銷清冊(單筆退現收回註銷)的金額資料(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_14_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收註銷清冊(單筆退現收回註銷)(失能)
        cursor c_dataCur_SUMRpt14 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '14'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_14_K';
            v_g_genFlag := 0;

            --應收已收註銷清冊(單筆退現收回註銷)(失能)
            for v_dataSUMCur14 in c_dataCur_SUMRpt14 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur14.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur14.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur14.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur14.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur14.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur14.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur14.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur14.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur14.OTHERAMT;                        --其他費用(I)

                --寫入應收已收註銷清冊(單筆退現收回註銷)(失能)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur14.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur14.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur14.ISSUTYP
                                        ,v_dataSUMCur14.ISSUYM
                                        ,v_dataSUMCur14.APNOAMT
                                        ,v_dataSUMCur14.DATAAMT
                                        ,v_dataSUMCur14.ISSUEAMT
                                        ,v_dataSUMCur14.OTHERAAMT
                                        ,v_dataSUMCur14.OTHERBAMT
                                        ,v_dataSUMCur14.MITRATE
                                        ,v_dataSUMCur14.OFFSETAMT
                                        ,v_dataSUMCur14.COMPENAMT
                                        ,v_dataSUMCur14.INHERITORAMT
                                        ,v_dataSUMCur14.ITRTTAX
                                        ,v_dataSUMCur14.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur14.NLWKMK
                                        ,v_dataSUMCur14.ADWKMK
                                        ,v_dataSUMCur14.NACHGMK
                                        ,v_dataSUMCur14.APNO
                                        ,v_dataSUMCur14.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(失能)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(失能)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收註銷清冊(單筆退現收回註銷)(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(失能)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(失能)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPaySUMRPT_14_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_14_K
        PURPOSE:         產生應收已收註銷清冊(單筆退現收回註銷)的會計科目(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_14_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收註銷清冊(單筆退現收回註銷)
        cursor c_dataCur_SUMRpt14 is
            select nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as ISSUEAMTA   --核定金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as ISSUEAMTB   --核定金額(失能補償金)
                  ,nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as PAYAMTA     --應收金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as PAYAMTB     --應收金額(失能補償金)
                  ,t.NLWKMK                                                        --普職註記
                  ,t.ADWKMK                                                        --加職註記
                  ,t.NACHGMK                                                       --普職互改註記
                  ,nvl(count(*), 0) as DATAAMT                                     --筆數
                  ,t.CHKDATE                                                       --核定日期
                  ,t.ISSUTYP                                                       --核付分類
                  ,t.RPTTYP                                                        --清冊別
                  ,t.ISSUYM                                                        --核定年月
              FROM BAPAYRPTRECORD t
             where t.RPTTYP = '14'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_14_K';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收註銷清冊(單筆退現收回註銷)
            for v_dataSUMCur14 in c_dataCur_SUMRpt14 Loop
                v_count       := 0;
                v_g_genFlag   := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur14.ISSUEAMTA;
                        if (v_dataSUMCur14.NLWKMK = '1') or (v_dataSUMCur14.NLWKMK is null) then
                            v_ACCOUNTNO      := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_ACCOUNTNAME    := '其他應收款－普通－失能給付（年金）';
                            v_OPPACCOUNTNO   := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '1') then
                            v_ACCOUNTNO      := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_ACCOUNTNAME    := '其他應收款－職災－失能給付（年金）';
                            v_OPPACCOUNTNO   := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '2') then
                            v_ACCOUNTNO      := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                            v_ACCOUNTNAME    := '其他應收款－加職－失能給付（年金）';
                            v_OPPACCOUNTNO   := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME := '暫收及待結轉帳項－現─暫收款';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur14.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur14.ISSUEAMTB;
                        if (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '1') then
                            v_ACCOUNTNO         := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_ACCOUNTNAME       := '其他應收款－職災－失能給付（補償金）';
                            v_OPPACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '2') then
                            v_ACCOUNTNO         := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_ACCOUNTNAME       := '其他應收款－加職－失能給付（補償金）';
                            v_OPPACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur14.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 3 then
                        v_tmpAMT      := v_dataSUMCur14.PAYAMTA;
                        if (v_dataSUMCur14.NLWKMK = '1') or (v_dataSUMCur14.NLWKMK is null) then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '1') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '2') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    elsif i = 4 then
                        v_tmpAMT      := v_dataSUMCur14.PAYAMTB;
                        if (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '1') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '2') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收註銷清冊(單筆退現收回註銷)會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur14.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur14.ISSUYM
                                                  ,''
                                                  ,v_i_canceldate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur14.NLWKMK
                                                  ,v_dataSUMCur14.ADWKMK
                                                  ,v_dataSUMCur14.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur14.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收註銷清冊(單筆退現收回註銷)會計科目資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)會計科目-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPayACCOUNTRPT_14_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_14_S
        PURPOSE:         產生應收已收註銷清冊(單筆退現收回註銷)的金額資料(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_14_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收註銷清冊(單筆退現收回註銷)(遺屬)
        cursor c_dataCur_SUMRpt14 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '14'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_14_S';
            v_g_genFlag := 0;

            --應收已收註銷清冊(單筆退現收回註銷)(遺屬)
            for v_dataSUMCur14 in c_dataCur_SUMRpt14 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur14.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur14.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur14.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur14.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur14.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur14.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur14.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur14.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur14.OTHERAMT;                        --其他費用(I)

                --寫入應收已收註銷清冊(單筆退現收回註銷)(遺屬)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur14.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur14.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur14.ISSUTYP
                                        ,v_dataSUMCur14.ISSUYM
                                        ,v_dataSUMCur14.APNOAMT
                                        ,v_dataSUMCur14.DATAAMT
                                        ,v_dataSUMCur14.ISSUEAMT
                                        ,v_dataSUMCur14.OTHERAAMT
                                        ,v_dataSUMCur14.OTHERBAMT
                                        ,v_dataSUMCur14.MITRATE
                                        ,v_dataSUMCur14.OFFSETAMT
                                        ,v_dataSUMCur14.COMPENAMT
                                        ,v_dataSUMCur14.INHERITORAMT
                                        ,v_dataSUMCur14.ITRTTAX
                                        ,v_dataSUMCur14.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur14.NLWKMK
                                        ,v_dataSUMCur14.ADWKMK
                                        ,v_dataSUMCur14.NACHGMK
                                        ,v_dataSUMCur14.APNO
                                        ,v_dataSUMCur14.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(遺屬)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(遺屬)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退現收回註銷)(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(遺屬)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)(遺屬)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPaySUMRPT_14_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_14_S
        PURPOSE:         產生應收已收註銷清冊(單筆退現收回註銷)的會計科目(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_14_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO            BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO           BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME         BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE         BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                 BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT              BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT                BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                 BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE          BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                    BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK          BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收註銷清冊(單筆退現收回註銷)
        cursor c_dataCur_SUMRpt14 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT                       --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT                           --應收金額
                  ,t.NLWKMK                                                  --普職註記
                  ,t.ADWKMK                                                  --加職註記
                  ,t.NACHGMK                                                 --普職互改註記
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT                         --筆數
                  ,t.CHKDATE                                                 --核定日期
                  ,t.ISSUTYP                                                 --核付分類
                  ,t.RPTTYP                                                  --清冊別
                  ,t.ISSUYM                                                  --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '14'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'E'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_14_S';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收註銷清冊(單筆退現收回註銷)
            for v_dataSUMCur14 in c_dataCur_SUMRpt14 Loop
                v_count     := 0;
                v_g_genFlag := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur14.ISSUEAMT;
                        if (v_dataSUMCur14.NLWKMK = '1') or (v_dataSUMCur14.NLWKMK is null) then
                            v_ACCOUNTNO         := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                            v_ACCOUNTNAME       := '其他應收款－普通－本人死亡給付（遺屬年金）';
                            v_OPPACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '1') then
                            v_ACCOUNTNO         := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                            v_ACCOUNTNAME       := '其他應收款－職災－本人死亡給付（遺屬年金）';
                            v_OPPACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '2') then
                            v_ACCOUNTNO         := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                            v_ACCOUNTNAME       := '其他應收款－加職－本人死亡給付（遺屬年金）';
                            v_OPPACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_OPPACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur14.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_tmpAMT      := v_dataSUMCur14.PAYAMT;
                        if (v_dataSUMCur14.NLWKMK = '1') or (v_dataSUMCur14.NLWKMK is null) then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '1') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        elsif (v_dataSUMCur14.NLWKMK = '2') and (v_dataSUMCur14.ADWKMK = '2') then
                            v_ACCOUNTNO      := '236X121 19   5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2825121 19    9)
                            v_ACCOUNTNAME    := '暫收及待結轉帳項－現─暫收款';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收核定清單會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur14.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur14.ISSUYM
                                                  ,''
                                                  ,v_i_canceldate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur14.NLWKMK
                                                  ,v_dataSUMCur14.ADWKMK
                                                  ,v_dataSUMCur14.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur14.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收註銷清冊(單筆退現收回註銷)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)-['||v_i_apno||']:'||v_g_errMsg);
                   --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退現收回註銷)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_14_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_15_L
        PURPOSE:         產生應收已收註銷清冊(單筆退匯收回註銷)的金額資料(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_15_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收註銷清冊(單筆退匯收回註銷)(老年)
        cursor c_dataCur_SUMRpt15 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '15'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_15_L';
            v_g_genFlag := 0;

            --應收已收註銷清冊(單筆退匯收回註銷)(老年)
            for v_dataSUMCur15 in c_dataCur_SUMRpt15 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur15.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur15.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur15.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur15.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur15.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur15.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur15.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur15.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur15.OTHERAMT;                        --其他費用(I)

                --寫入應收已收註銷清冊(單筆退匯收回註銷)(老年)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur15.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur15.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur15.ISSUTYP
                                        ,v_dataSUMCur15.ISSUYM
                                        ,v_dataSUMCur15.APNOAMT
                                        ,v_dataSUMCur15.DATAAMT
                                        ,v_dataSUMCur15.ISSUEAMT
                                        ,v_dataSUMCur15.OTHERAAMT
                                        ,v_dataSUMCur15.OTHERBAMT
                                        ,v_dataSUMCur15.MITRATE
                                        ,v_dataSUMCur15.OFFSETAMT
                                        ,v_dataSUMCur15.COMPENAMT
                                        ,v_dataSUMCur15.INHERITORAMT
                                        ,v_dataSUMCur15.ITRTTAX
                                        ,v_dataSUMCur15.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur15.APNO
                                        ,v_dataSUMCur15.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(老年)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '應收已收註銷清冊(單筆退匯收回註銷)(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(老年)-['||v_i_apno||']:'||v_g_errMsg,
                      replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPaySUMRPT_15_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_15_L
        PURPOSE:         產生應收已收註銷清冊(單筆退匯收回註銷)的會計科目(老年)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)

        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_15_L (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER                              := 0;
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收註銷清冊(單筆退匯收回註銷)
        cursor c_dataCur_SUMRpt15 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT           --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT               --應收金額
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT             --筆數
                  ,t.CHKDATE                                     --核定日期
                  ,t.ISSUTYP                                     --核付分類
                  ,t.RPTTYP                                      --清冊別
                  ,t.ISSUYM                                      --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '15'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_15_L';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收註銷清冊(單筆退匯收回註銷)會計科目
            for v_dataSUMCur15 in c_dataCur_SUMRpt15 Loop
                v_count          := 0;
                v_g_genFlag      := 1;
                v_ACCOUNTSEQ     := null;
                v_ACCOUNTNO      := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTNAME    := '';
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_ACCOUNTNO   := '113X121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                        v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                        v_tmpAMT      := v_dataSUMCur15.ISSUEAMT;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                        v_OPPACCOUNTNAME := '應付保管款－普通－老年給付（年金）';

                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur15.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTNO   := '2362121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11111 0)
                        v_ACCOUNTNAME := '應付保管款－普通－老年給付（年金）';
                        v_tmpAMT      := v_dataSUMCur15.PAYAMT;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收註銷清冊(單筆退匯收回註銷)會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur15.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur15.ISSUYM
                                                  ,''
                                                  ,v_i_canceldate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur15.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目(老年)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目(老年)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退匯收回註銷)會計科目(老年)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid ,'1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目(老年)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        end;
    --Procedure sp_BA_genPayACCOUNTRPT_15_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_15_K
        PURPOSE:         產生應收已收註銷清冊(單筆退匯收回註銷)的金額資料(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_15_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收註銷清冊(單筆退匯收回註銷)(失能)
        cursor c_dataCur_SUMRpt15 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '15'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_15_K';
            v_g_genFlag := 0;

            --應收已收註銷清冊(單筆退匯收回註銷)(失能)
            for v_dataSUMCur15 in c_dataCur_SUMRpt15 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur15.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur15.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur15.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur15.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur15.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur15.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur15.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur15.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur15.OTHERAMT;                        --其他費用(I)

                --寫入應收已收註銷清冊(單筆退匯收回註銷)(失能)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur15.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur15.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur15.ISSUTYP
                                        ,v_dataSUMCur15.ISSUYM
                                        ,v_dataSUMCur15.APNOAMT
                                        ,v_dataSUMCur15.DATAAMT
                                        ,v_dataSUMCur15.ISSUEAMT
                                        ,v_dataSUMCur15.OTHERAAMT
                                        ,v_dataSUMCur15.OTHERBAMT
                                        ,v_dataSUMCur15.MITRATE
                                        ,v_dataSUMCur15.OFFSETAMT
                                        ,v_dataSUMCur15.COMPENAMT
                                        ,v_dataSUMCur15.INHERITORAMT
                                        ,v_dataSUMCur15.ITRTTAX
                                        ,v_dataSUMCur15.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur15.NLWKMK
                                        ,v_dataSUMCur15.ADWKMK
                                        ,v_dataSUMCur15.NACHGMK
                                        ,v_dataSUMCur15.APNO
                                        ,v_dataSUMCur15.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(失能)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(失能)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退匯收回註銷)(失能)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(失能)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(失能)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPaySUMRPT_15_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_15_K
        PURPOSE:         產生應收已收註銷清冊(單筆退匯收回註銷)的會計科目(失能)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_15_K (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO           BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO          BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME        BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE        BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT             BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT               BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE         BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                   BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK         BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收註銷清冊(單筆退匯收回註銷)
        cursor c_dataCur_SUMRpt15 is
            select nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as ISSUEAMTA   --核定金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as ISSUEAMTB   --核定金額(失能補償金)
                  ,nvl(sum(decode(t.PAYKIND,'37',0,t.ISSUEAMT)), 0) as PAYAMTA     --應收金額(失能年金)
                  ,nvl(sum(decode(t.PAYKIND,'37',t.ISSUEAMT,0)), 0) as PAYAMTB     --應收金額(失能補償金)
                  ,t.NLWKMK                                                        --普職註記
                  ,t.ADWKMK                                                        --加職註記
                  ,t.NACHGMK                                                       --普職互改註記
                  ,nvl(count(*), 0) as DATAAMT                                     --筆數
                  ,t.CHKDATE                                                       --核定日期
                  ,t.ISSUTYP                                                       --核付分類
                  ,t.RPTTYP                                                        --清冊別
                  ,t.ISSUYM                                                        --核定年月
              FROM BAPAYRPTRECORD t
             where t.RPTTYP = '15'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_15_K';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收註銷清冊(單筆退匯收回註銷)
            for v_dataSUMCur15 in c_dataCur_SUMRpt15 Loop
                v_count       := 0;
                v_g_genFlag   := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur15.ISSUEAMTA;
                        if (v_dataSUMCur15.NLWKMK = '1') or (v_dataSUMCur15.NLWKMK is null) then
                            v_ACCOUNTNO         := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                            v_ACCOUNTNAME       := '其他應收款－普通－失能給付（年金）';
                            v_OPPACCOUNTNO      := '2362121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11102 9)
                            v_OPPACCOUNTNAME    := '應付保管款－普通－失能給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '1') then
                            v_ACCOUNTNO         := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                            v_ACCOUNTNAME       := '其他應收款－職災－失能給付（年金）';
                            v_OPPACCOUNTNO      := '2362122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11102 2)
                            v_OPPACCOUNTNAME    := '應付保管款－職災－失能給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '2') then
                            v_ACCOUNTNO         := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                            v_ACCOUNTNAME       := '其他應收款－加職－失能給付（年金）';
                            v_OPPACCOUNTNO      := '2362122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12102 3)
                            v_OPPACCOUNTNAME    := '應付保管款－加職－失能給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur15.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur15.ISSUEAMTB;
                        if (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '1') then
                            v_ACCOUNTNO      := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                            v_ACCOUNTNAME    := '其他應收款－職災－失能給付（補償金）';
                            v_OPPACCOUNTNO   := '2362122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11101 4)
                            v_OPPACCOUNTNAME := '應付保管款－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '2') then
                            v_ACCOUNTNO      := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                            v_ACCOUNTNAME    := '其他應收款－加職－失能給付（補償金）';
                            v_OPPACCOUNTNO   := '2362122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12101 5)
                            v_OPPACCOUNTNAME := '應付保管款－加職－失能給付（補償金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur15.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 3 then
                        v_tmpAMT      := v_dataSUMCur15.PAYAMTA;
                        if (v_dataSUMCur15.NLWKMK = '1') or (v_dataSUMCur15.NLWKMK is null) then
                            v_ACCOUNTNO      := '2362121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11102 9)
                            v_ACCOUNTNAME    := '應付保管款－普通－失能給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '1') then
                            v_ACCOUNTNO      := '2362122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11102 2)
                            v_ACCOUNTNAME    := '應付保管款－職災－失能給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '2') then
                            v_ACCOUNTNO      := '2362122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12102 3)
                            v_ACCOUNTNAME    := '應付保管款－加職－失能給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    elsif i = 4 then
                        v_tmpAMT      := v_dataSUMCur15.PAYAMTB;
                        if (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '1') then
                            v_ACCOUNTNO   := '2362122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11101 4)
                            v_ACCOUNTNAME := '應付保管款－職災－失能給付（補償金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '2') then
                            v_ACCOUNTNO   := '2362122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12101 5)
                            v_ACCOUNTNAME := '應付保管款－加職－失能給付（補償金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收註銷清冊(單筆退匯收回註銷)
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur15.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur15.ISSUYM
                                                  ,''
                                                  ,v_i_canceldate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur15.NLWKMK
                                                  ,v_dataSUMCur15.ADWKMK
                                                  ,v_dataSUMCur15.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur15.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退匯收回註銷)會計科目資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)會計科目-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_15_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_15_S
        PURPOSE:         產生應收已收註銷清冊(單筆退匯收回註銷)的金額資料(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPaySUMRPT_15_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is
        v_payamt                BAPAYRPTSUM.PAYAMT%TYPE := 0;                 --核定金額

        --應收已收註銷清冊(單筆退匯收回註銷)(遺屬)
        cursor c_dataCur_SUMRpt15 is
            select count(distinct t.APNO) as APNOAMT                          --件數
                  ,count(*) as DATAAMT                                        --筆數
                  ,nvl(sum(t.ISSUEAMT),0) as ISSUEAMT                         --核定金額(A)
                  ,nvl(sum(t.OTHERAAMT),0) as OTHERAAMT                       --另案扣減同保險(B)
                  ,nvl(sum(t.OTHERBAMT),0) as OTHERBAMT                       --另案扣減他保險(C)
                  ,nvl(sum(t.MITRATE),0) as MITRATE                           --匯費(D)
                  ,nvl(sum(t.OFFSETAMT),0) as OFFSETAMT                       --抵銷紓困(E)
                  ,nvl(sum(t.COMPENAMT),0) as COMPENAMT                       --代扣補償金(F)
                  ,nvl(sum(t.INHERITORAMT),0) as INHERITORAMT                 --保留遺屬津貼(G)
                  ,nvl(sum(t.ITRTTAX),0) as ITRTTAX                           --代扣利息所得稅(H)
                  ,nvl(sum(t.OTHERAMT),0) as OTHERAMT                         --其他(I)
                  ,t.ISSUTYP                                                  --核付分類
                  ,t.CHKDATE                                                  --(月)核定日期/應收立帳日期/應收已收日期
                  ,t.CPRNDATE                                                 --印表日期
                  ,t.RPTTYP                                                   --清冊別
                  ,t.ISSUYM                                                   --核定年月
                  ,t.NLWKMK                                                   --普職註記
                  ,t.ADWKMK                                                   --加職註記
                  ,t.NACHGMK                                                  --普職互改註記
                  ,t.APNO                                                     --受理編號
                  ,t.SEQNO                                                    --受款人序
              from BAPAYRPTRECORD t
             where t.RPTTYP = '15'
               and t.APNO = v_i_apno
               and t.SEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
               and t.NACHGMK is null
             group by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.SEQNO,t.ISSUTYP,t.CHKDATE,t.CPRNDATE,t.RPTTYP,t.ISSUYM,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_15_S';
            v_g_genFlag := 0;

            --應收已收註銷清冊(單筆退匯收回註銷)(遺屬)
            for v_dataSUMCur15 in c_dataCur_SUMRpt15 Loop
                v_g_genFlag := 1;

                v_payamt := v_dataSUMCur15.ISSUEAMT                         --核定金額(A)
                          - v_dataSUMCur15.OTHERAAMT                        --另案扣減(同類保險)金額(B)
                          - v_dataSUMCur15.OTHERBAMT                        --另案扣減(他類保險)金額(C)
                          - v_dataSUMCur15.MITRATE                          --匯款匯費(D)
                          - v_dataSUMCur15.OFFSETAMT                        --抵銷紓困費用(E)
                          - v_dataSUMCur15.COMPENAMT                        --代扣補償金(F)
                          - v_dataSUMCur15.INHERITORAMT                     --保留遺屬津貼(G)
                          - v_dataSUMCur15.ITRTTAX                          --代扣利息所得稅(H)
                          - v_dataSUMCur15.OTHERAMT;                        --其他費用(I)

                --寫入應收已收註銷清冊(單筆退匯收回註銷)(遺屬)
                insert into BAPAYRPTSUM (RPTTYP
                                        ,CPRNDATE
                                        ,CHKDATE
                                        ,PAYCODE
                                        ,ISSUTYP
                                        ,ISSUYM
                                        ,APNOAMT
                                        ,DATAAMT
                                        ,ISSUEAMT
                                        ,OTHERAAMT
                                        ,OTHERBAMT
                                        ,MITRATE
                                        ,OFFSETAMT
                                        ,COMPENAMT
                                        ,INHERITORAMT
                                        ,ITRTTAX
                                        ,OTHERAMT
                                        ,PAYAMT
                                        ,NLWKMK
                                        ,ADWKMK
                                        ,NACHGMK
                                        ,APNO
                                        ,APSEQNO
                                        ,PROCTIME
                                       ) values (
                                         v_dataSUMCur15.RPTTYP
                                        ,v_i_cprndt
                                        ,v_dataSUMCur15.CHKDATE
                                        ,substr(v_i_apno,1,1)
                                        ,v_dataSUMCur15.ISSUTYP
                                        ,v_dataSUMCur15.ISSUYM
                                        ,v_dataSUMCur15.APNOAMT
                                        ,v_dataSUMCur15.DATAAMT
                                        ,v_dataSUMCur15.ISSUEAMT
                                        ,v_dataSUMCur15.OTHERAAMT
                                        ,v_dataSUMCur15.OTHERBAMT
                                        ,v_dataSUMCur15.MITRATE
                                        ,v_dataSUMCur15.OFFSETAMT
                                        ,v_dataSUMCur15.COMPENAMT
                                        ,v_dataSUMCur15.INHERITORAMT
                                        ,v_dataSUMCur15.ITRTTAX
                                        ,v_dataSUMCur15.OTHERAMT
                                        ,v_payamt
                                        ,v_dataSUMCur15.NLWKMK
                                        ,v_dataSUMCur15.ADWKMK
                                        ,v_dataSUMCur15.NACHGMK
                                        ,v_dataSUMCur15.APNO
                                        ,v_dataSUMCur15.SEQNO
                                        ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                       );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(遺屬)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(遺屬)-['||v_i_apno||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退匯收回註銷)(遺屬)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(遺屬)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid ,'1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)(遺屬)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPaySUMRPT_15_S End


    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_15_S
        PURPOSE:         產生應收已收註銷清冊(單筆退匯收回註銷)的會計科目(遺屬)

        PARAMETER(IN):  *v_i_apno          (varChar2)       --受理編號
                        *v_i_seqno         (varChar2)       --受理人序
                        *v_i_canceldate    (varChar2)       --註銷日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2013/12/17  Angela Wu    Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
    Procedure sp_BA_genPayACCOUNTRPT_15_S (
        v_i_apno                in      varChar2,
        v_i_seqno               in      varChar2,
        v_i_canceldate          in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2
    ) is

        v_count                 NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO             BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME           BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ            BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT                BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO            BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO           BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME         BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE         BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD                 BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT              BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT                BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT                 BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE          BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT                    BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK          BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --回寫PFM&PFD時所需資訊 End-->

        --應收已收註銷清冊(單筆退匯收回註銷)
        cursor c_dataCur_SUMRpt15 is
            select nvl(sum(t.ISSUEAMT), 0) as ISSUEAMT                       --核定金額
                  ,nvl(sum(t.PAYAMT), 0) as PAYAMT                           --應收金額
                  ,t.NLWKMK                                                  --普職註記
                  ,t.ADWKMK                                                  --加職註記
                  ,t.NACHGMK                                                 --普職互改註記
                  ,nvl(sum(t.DATAAMT), 0) as DATAAMT                         --筆數
                  ,t.CHKDATE                                                 --核定日期
                  ,t.ISSUTYP                                                 --核付分類
                  ,t.RPTTYP                                                  --清冊別
                  ,t.ISSUYM                                                  --核定年月
              from BAPAYRPTSUM t
             where t.RPTTYP = '15'
               and t.APNO = v_i_apno
               and t.APSEQNO = v_i_seqno
               and t.CHKDATE = v_i_canceldate
               and t.CPRNDATE = v_i_cprndt
               and t.ISSUTYP = 'D'
             group by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK
             order by t.APNO,t.APSEQNO,t.RPTTYP,t.ISSUYM,t.ISSUTYP,t.CHKDATE,t.NLWKMK,t.ADWKMK,t.NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_15_S';
            v_count      := 0;
            v_g_genFlag  := 0;

            --應收已收註銷清冊(單筆退匯收回註銷)
            for v_dataSUMCur15 in c_dataCur_SUMRpt15 Loop
                v_count     := 0;
                v_g_genFlag := 1;
                v_ACCOUNTSEQ  := null;
                v_ACCOUNTNO   := '';
                v_ACCOUNTNAME := '';

                --回寫PFM&PFD時所需資訊 Start-->
                v_ACCOUNTMEMO    := '';
                v_OPPACCOUNTNO   := '';
                v_OPPACCOUNTNAME := '';
                v_ACTTITLEAPCODE := '';
                v_DATACD         := '';
                v_DECIDEAMT      := 0;
                v_CASHAMT        := 0;
                v_CUTAMT         := 0;
                v_ACCEPTPAYTYPE  := '';
                v_CNT            := 0;
                v_ACCOUNTTOPFMK  := 'N';
                --回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur15.ISSUEAMT;
                        if (v_dataSUMCur15.NLWKMK = '1') or (v_dataSUMCur15.NLWKMK is null) then
                            v_ACCOUNTNO         := '113X121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                            v_ACCOUNTNAME       := '其他應收款－普通－本人死亡給付（遺屬年金）';
                            v_OPPACCOUNTNO      := '2362121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11054 A)
                            v_OPPACCOUNTNAME    := '應付保管款－普通－本人死亡給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '1') then
                            v_ACCOUNTNO         := '113X122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                            v_ACCOUNTNAME       := '其他應收款－職災－本人死亡給付（遺屬年金）';
                            v_OPPACCOUNTNO      := '2362122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11054 4)
                            v_OPPACCOUNTNAME    := '應付保管款－職災－本人死亡給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '2') then
                            v_ACCOUNTNO         := '113X122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                            v_ACCOUNTNAME       := '其他應收款－加職－本人死亡給付（遺屬年金）';
                            v_OPPACCOUNTNO      := '2362122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12054 5)
                            v_OPPACCOUNTNAME    := '應付保管款－加職－本人死亡給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊 Start-->
                        v_ACCOUNTMEMO    := '';
                        v_ACTTITLEAPCODE := 'FGJ';
                        v_DATACD         := '';
                        v_DECIDEAMT      := v_tmpAMT;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '1';
                        v_CNT            := v_dataSUMCur15.DATAAMT;
                        v_ACCOUNTTOPFMK  := 'Y';
                        --回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                        v_tmpAMT      := v_dataSUMCur15.PAYAMT;
                        if (v_dataSUMCur15.NLWKMK = '1') or (v_dataSUMCur15.NLWKMK is null) then
                            v_ACCOUNTNO      := '2362121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822121 11054 A)
                            v_ACCOUNTNAME    := '應付保管款－普通－本人死亡給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '1') then
                            v_ACCOUNTNO      := '2362122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 11054 4)
                            v_ACCOUNTNAME    := '應付保管款－職災－本人死亡給付（年金）';
                        elsif (v_dataSUMCur15.NLWKMK = '2') and (v_dataSUMCur15.ADWKMK = '2') then
                            v_ACCOUNTNO      := '2362122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：2822122 12054 5)
                            v_ACCOUNTNAME    := '應付保管款－加職－本人死亡給付（年金）';
                        end if;

                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) Start-->
                        v_ACCOUNTMEMO    := '';
                        v_OPPACCOUNTNO   := '';
                        v_OPPACCOUNTNAME := '';
                        v_ACTTITLEAPCODE := '';
                        v_DATACD         := '';
                        v_DECIDEAMT      := 0;
                        v_CASHAMT        := 0;
                        v_CUTAMT         := 0;
                        v_ACCEPTPAYTYPE  := '';
                        v_CNT            := 0;
                        v_ACCOUNTTOPFMK  := 'N';
                        --回寫PFM&PFD時所需資訊(資訊已在另一方表示，故不回寫(將回寫資訊清空)) End-->
                    end if;

                    --寫入應收已收註銷清冊(單筆退匯收回註銷)會計科目資料
                    if v_tmpAMT > 0 then
                        insert into BAPAYRPTACCOUNT(RPTTYP
                                                   ,CPRNDATE
                                                   ,PAYCODE
                                                   ,ISSUYM
                                                   ,PAYTYP
                                                   ,CHKDATE
                                                   ,BENEVTREL
                                                   ,ACCOUNTSEQ
                                                   ,SEQNO
                                                   ,ACCOUNTNO
                                                   ,ACCOUNTNAME
                                                   ,PAYAMT
                                                   ,NLWKMK
                                                   ,ADWKMK
                                                   ,NACHGMK
                                                   ,PROCTIME
                                                   ,ACCOUNTMEMO
                                                   ,OPPACCOUNTNO
                                                   ,OPPACCOUNTNAME
                                                   ,ACTTITLEAPCODE
                                                   ,DATACD
                                                   ,DECIDEAMT
                                                   ,CASHAMT
                                                   ,CUTAMT
                                                   ,ACCEPTPAYTYPE
                                                   ,CNT
                                                   ,ACCOUNTTOPFMK
                                                   ,ISSUTYP
                                                   ,APNO
                                                   ,APSEQNO
                                                  ) values (
                                                   v_dataSUMCur15.RPTTYP
                                                  ,v_i_cprndt
                                                  ,substr(v_i_apno,1,1)
                                                  ,v_dataSUMCur15.ISSUYM
                                                  ,''
                                                  ,v_i_canceldate
                                                  ,''
                                                  ,v_ACCOUNTSEQ
                                                  ,v_count
                                                  ,v_ACCOUNTNO
                                                  ,v_ACCOUNTNAME
                                                  ,v_tmpAMT
                                                  ,v_dataSUMCur15.NLWKMK
                                                  ,v_dataSUMCur15.ADWKMK
                                                  ,v_dataSUMCur15.NACHGMK
                                                  ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                  ,v_ACCOUNTMEMO
                                                  ,v_OPPACCOUNTNO
                                                  ,v_OPPACCOUNTNAME
                                                  ,v_ACTTITLEAPCODE
                                                  ,v_DATACD
                                                  ,v_DECIDEAMT
                                                  ,v_CASHAMT
                                                  ,v_CUTAMT
                                                  ,v_ACCEPTPAYTYPE
                                                  ,v_CNT
                                                  ,v_ACCOUNTTOPFMK
                                                  ,v_dataSUMCur15.ISSUTYP
                                                  ,v_i_apno
                                                  ,v_i_seqno
                                                 );
                    end if;

                    --回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)-['||v_i_apno||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)-['||v_i_apno||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
               '應收已收註銷清冊(單筆退匯收回註銷)資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));


        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)-['||v_i_apno||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>應收已收註銷清冊(單筆退匯收回註銷)-['||v_i_apno||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_15_S End
    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_16
        PURPOSE:         產生轉催核定清單的會計科目

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_16_L (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        --轉催核定清單(老年)
         Cursor c_dataCur_SUMrpt16 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                              --應收金額
                   ,ISSUTYP                                                 --(月)核定日期/應收立帳日期
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '16'
               AND PAYDATE = v_i_procYm
               AND CHKDATE = v_i_cprndt
               AND APNO LIKE (v_i_paycode||'%')
             GROUP BY ISSUTYP,  CPRNDATE, RPTTYP
             ORDER BY ISSUTYP,  CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_16_L';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉催核定清單(老年)
            for v_dataSUMCur16 in c_dataCur_SUMrpt16 Loop
                  v_g_genFlag := 1;
                --寫入轉催核定清單資料
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,RPTNOTE
                                         ,PROCTIME
                                         ,ISSUYM
                                         ,CHKDATE
                                         ,PAYDATE
                                ) values (
                                          v_dataSUMCur16.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_i_paycode
                                         ,v_dataSUMCur16.ISSUTYP
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur16.APNOAMT
                                         ,v_dataSUMCur16.DATAAMT
                                         ,v_dataSUMCur16.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur16.UNACPAMT
                                         ,v_dataSUMCur16.UNACPAMT
                                         ,''  --備註
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                         ,v_i_procym
                                         ,v_i_cprndt
                                         ,v_i_procym
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(老年)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉催核定清單(老年)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                    v_g_flag := '1';
                    v_o_flag := v_g_flag; */
        end;
    --Procedure sp_BA_genPaySUMRPT_16_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_16_L
        PURPOSE:         產生轉催核定清單會計科目(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_16_L (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --轉催核定清單會計科目(老年)
        Cursor c_dataCur_SUMrpt16 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS UNACPAMT,           -- 應收金額
                     NVL(SUM(DATAAMT), 0)    AS DATAAMT,            -- 筆數    add by 20130711 Angela
                    CPRNDATE
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '16'
               AND PAYCODE = v_i_paycode
               AND ISSUYM = v_i_procym
               AND CHKDATE = v_i_cprndt
             GROUP BY CPRNDATE
             ORDER BY CPRNDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_16_L';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉催核定清單會計科目(老年)
            for v_dataSUMCur16 in c_dataCur_SUMrpt16 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_ACCOUNTNO   := '1812121 11111 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME := '催收款－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '1178121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_OPPACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'FHG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur16.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_ACCOUNTNO   := '1178121 11111 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_ACCOUNTNAME := '其他應收款－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入轉催核定清單會計科目資料
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,PAYTYP
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUYM
                                                    ,CHKDATE

                                          ) values (
                                                     '16'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,''
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_i_procYm
                                                     ,v_i_cprndt
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
           /* insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉催核定清單會計科目(老年)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));

                     v_g_flag := '1';
                     v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_16_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_16_K
        PURPOSE:         產生轉催核定清單(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_16_K (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        --轉催核定清單(失能)
         Cursor c_dataCur_SUMrpt16 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                            --應收金額
                   ,ISSUTYP                                                  --(月)核定日期/應收立帳日期
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '16'
               AND PAYDATE = v_i_procYm
               AND CHKDATE = v_i_cprndt
               AND NACHGMK IS NULL
               AND APNO LIKE (v_i_paycode||'%')                        -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_16_K';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉催核定清單(失能)
            for v_dataSUMCur16 in c_dataCur_SUMrpt16 Loop

                v_g_genFlag := 1;

                --寫入轉催核定清單資料(失能)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                         ,ISSUYM
                                         ,CHKDATE
                                         ,PAYDATE
                                ) values (
                                          v_dataSUMCur16.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_i_paycode
                                         ,v_dataSUMCur16.ISSUTYP
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur16.APNOAMT
                                         ,v_dataSUMCur16.DATAAMT
                                         ,v_dataSUMCur16.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur16.UNACPAMT
                                         ,v_dataSUMCur16.UNACPAMT
                                         ,''  --備註
                                         ,v_dataSUMCur16.NLWKMK
                                         ,v_dataSUMCur16.ADWKMK
                                         ,v_dataSUMCur16.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                         ,v_i_procym
                                         ,v_i_cprndt
                                         ,v_i_procym
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(失能)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
           /* insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉催核定清單(失能)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPaySUMRPT_16_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_16_K
        PURPOSE:         產生轉催核定清單會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_16_K (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --轉催核定清單(失能)
        Cursor c_dataCur_SUMrpt16 is
            SELECT NVL(SUM(DECODE(PAYKIND,'37',0,ISSUEAMT)), 0)   AS ISSUEAMTA,           -- 核定金額(失能年金)
                   NVL(SUM(DECODE(PAYKIND,'37',ISSUEAMT,0)), 0)   AS ISSUEAMTB,           -- 核定金額(失能補償金)
                   NVL(SUM(DECODE(PAYKIND,'37',0,UNACPAMT)), 0)   AS UNACPAMTA,           -- 應收金額(失能年金)
                   NVL(SUM(DECODE(PAYKIND,'37',UNACPAMT,0)), 0)   AS UNACPAMTB,           -- 應收金額(失能補償金)
                   NLWKMK,                                                                -- 普職註記
                   ADWKMK,                                                                -- 加職註記
                   NACHGMK,                                                               -- 普職互改註記
                   NVL(COUNT(*), 0)                               AS DATAAMT             -- 筆數    add by 20130711 Angela
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '16'
               AND PAYCODE = v_i_paycode
               AND PAYDATE = v_i_procym
               AND CHKDATE = v_i_cprndt
               AND NACHGMK IS NULL                                            -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY  NLWKMK, ADWKMK, NACHGMK
             ORDER BY  NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_16_K';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉催核定清單會計科目(失能)
            for v_dataSUMCur16 in c_dataCur_SUMrpt16 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMTA;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                           if (v_dataSUMCur16.nlwkmk = '1' or trim(v_dataSUMCur16.nlwkmk) is null) then
                               v_ACCOUNTNO   := '1812121 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                               v_ACCOUNTNAME := '催收款－普通－失能給付（年金）';
                               v_OPPACCOUNTNO   := '1178121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                               v_OPPACCOUNTNAME := '其他應收款－普通－失能給付（年金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '1') then
                               v_ACCOUNTNO   := '1812122 11102 6';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                               v_ACCOUNTNAME := '催收款－職災－失能給付（年金）';
                               v_OPPACCOUNTNO   := '1178122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（年金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '2') then
                               v_ACCOUNTNO   := '1812122 12102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                               v_ACCOUNTNAME := '催收款－加職－失能給付（年金）';
                               v_OPPACCOUNTNO   := '1178122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（年金）';    --add by 20130711 Angela
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '';
                           v_ACTTITLEAPCODE := 'FHG';
                           v_DATACD         := '1';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '1';
                           v_CNT            := v_dataSUMCur16.DATAAMT;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                       --else
                           -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                          /* if (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '1') then
                                   v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                                   v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                           elsif  (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '2') then
                                   v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                                   v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                           elsif  (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '3') then
                                   v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                                   v_ACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                           end if;*/
                       --end if;
                    elsif i = 2 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMTB;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur16.NACHGMK) is null) then
                           if  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '1') then
                               v_ACCOUNTNO   := '1812122 11101 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                               v_ACCOUNTNAME := '催收款－職災－失能給付（補償金）';
                               v_OPPACCOUNTNO   := '1178122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                               v_OPPACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '2') then
                               v_ACCOUNTNO   := '1812122 12101 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                               v_ACCOUNTNAME := '催收款－加職－失能給付（補償金）';
                               v_OPPACCOUNTNO   := '1178122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                               v_OPPACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';    --add by 20130711 Angela
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '';
                           v_ACTTITLEAPCODE := 'FHG';
                           v_DATACD         := '1';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '1';
                           v_CNT            := v_dataSUMCur16.DATAAMT;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                          --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                           /*if ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '2' ) then
                                   v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                                   v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                           elsif (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '3') then
                                   v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                                   v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                           end if;*/
                       --end if;
                    elsif i = 3 then
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMTA;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur16.NACHGMK) is null) then
                           if (v_dataSUMCur16.nlwkmk = '1' or trim(v_dataSUMCur16.nlwkmk) is null) then
                               v_ACCOUNTNO   := '1178121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                               v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                           elsif  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '1') then
                               v_ACCOUNTNO   := '1178122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                           elsif  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '2') then
                               v_ACCOUNTNO   := '1178122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_ACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                           v_ACCOUNTMEMO    := '';
                           v_OPPACCOUNTNO   := '';
                           v_OPPACCOUNTNAME := '';
                           v_ACTTITLEAPCODE := '';
                           v_DATACD         := '';
                           v_DECIDEAMT      := 0;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '';
                           v_CNT            := 0;
                           v_ACCOUNTTOPFMK  := 'N';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                           /*if ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '1' ) then
                                   v_ACCOUNTNO   := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                   v_ACCOUNTNAME := '保險給付－普通－失能給付（年金）';
                           elsif ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '2' ) then
                                   v_ACCOUNTNO   := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                   v_ACCOUNTNAME := '保險給付－職災－失能給付（年金）';
                           elsif ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '3' ) then
                                   v_ACCOUNTNO   := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                   v_ACCOUNTNAME := '保險給付－加職－失能給付（年金）';
                           end if;    */
                      -- end if;
                    elsif i = 4 then
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMTB;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                            if  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '1') then
                                v_ACCOUNTNO   := '1178122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                            elsif  (v_dataSUMCur16.nlwkmk = '2' and v_dataSUMCur16.adwkmk = '2') then
                                v_ACCOUNTNO   := '1178122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                            end if;
                            --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                            --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                            v_ACCOUNTMEMO    := '';
                            v_OPPACCOUNTNO   := '';
                            v_OPPACCOUNTNAME := '';
                            v_ACTTITLEAPCODE := '';
                            v_DATACD         := '';
                            v_DECIDEAMT      := 0;
                            v_CASHAMT        := 0;
                            v_CUTAMT         := 0;
                            v_ACCEPTPAYTYPE  := '';
                            v_CNT            := 0;
                            v_ACCOUNTTOPFMK  := 'N';
                            --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                            /*if  (   SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '2') then
                                    v_ACCOUNTNO   := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                    v_ACCOUNTNAME := '保險給付－職災－失能給付（補償金）';
                            elsif ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '3') then
                                    v_ACCOUNTNO   := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                    v_ACCOUNTNAME := '保險給付－加職－失能給付（補償金）';
                            end if;*/
                       --end if;
                    end if;

                    --寫入應收款立帳核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       v_count := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,PAYTYP
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    --,PAYSEQNO
                                                    ,NACHGMK                       -- 2012/06/15 Mark By ChungYu 應收款立帳不區分普職互改
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUYM
                                                    ,CHKDATE
                                          ) values (  '16'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,''
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_dataSUMCur16.NACHGMK
                                                     ,v_dataSUMCur16.NLWKMK
                                                     ,v_dataSUMCur16.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_i_procYm
                                                     ,v_i_cprndt
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            v_o_flag := v_g_genFlag;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉催核定清單(失能)會計科目資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
               v_o_flag := v_g_flag;*/
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));

                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_16_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_16_S
        PURPOSE:         產生轉催核定清單(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_16_S (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        --轉催核定清單(遺屬)
         Cursor c_dataCur_SUMrpt16 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                            --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                   ,PAYTYP                                                   --給付方式
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '16'
               AND APNO LIKE (v_i_paycode||'%')
               AND PAYDATE = v_i_procYm
               AND CHKDATE = v_i_cprndt
               --AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND NACHGMK IS Null                                            -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY PAYTYP, ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY PAYTYP, ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_16_S';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉催核定清單資料(遺屬)
            for v_dataSUMCur16 in c_dataCur_SUMrpt16 Loop

                  v_g_genFlag := 1;

                --寫入轉催核定清單資料(遺屬)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                         ,ISSUYM
                                         ,PAYDATE
                                         ,CHKDATE
                                ) values (
                                          '16'
                                         ,v_i_cprndt
                                         ,v_dataSUMCur16.PAYTYP
                                         ,v_i_paycode
                                         ,v_dataSUMCur16.ISSUTYP
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur16.APNOAMT
                                         ,v_dataSUMCur16.DATAAMT
                                         ,v_dataSUMCur16.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur16.UNACPAMT
                                         ,v_dataSUMCur16.UNACPAMT
                                         ,''  --備註
                                         ,v_dataSUMCur16.NLWKMK
                                         ,v_dataSUMCur16.ADWKMK
                                         ,v_dataSUMCur16.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                         ,v_i_procym
                                         ,v_i_procym
                                         ,v_i_cprndt
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
           /* insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉催核定清單(遺屬)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /* insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPaySUMRPT_16_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_16_S
        PURPOSE:         產生轉催核定清單會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_16_S (
        v_i_paycode             in      varChar2,
        v_i_procYm              in      varChar2,
        v_i_cprndt              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --轉催核定清單(遺屬)
        Cursor c_dataCur_SUMrpt16 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,            -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS UNACPAMT,            -- 應收金額
                   NLWKMK,                                         -- 普職註記
                   ADWKMK,                                         -- 加職註記
                   NACHGMK,                                        -- 普職互改註記
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT             -- 筆數    add by 20130711 Angela
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '16'
               AND PAYCODE = v_i_paycode
               AND PAYDATE  = v_i_procYm
               AND CHKDATE = v_i_cprndt
               --AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               --AND PAYSEQNO = v_i_payseqno
               AND NACHGMK IS NULL                                 -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY NLWKMK, ADWKMK, NACHGMK
             ORDER BY NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_16_S';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉催核定清單會計科目(遺屬)
            for v_dataSUMCur16 in c_dataCur_SUMrpt16 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMT;

                       if (v_dataSUMCur16.NLWKMK = '1' or trim(v_dataSUMCur16.NLWKMK) is null) then
                           v_ACCOUNTNO   := '1812121 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := '催收款－普通－本人死亡給付（年金）';
                           v_OPPACCOUNTNO   := '1178121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_OPPACCOUNTNAME := '其他應收款－普通－本人死亡給付（年金）';    --add by 20130711 Angela
                       elsif  (v_dataSUMCur16.NLWKMK = '2' and v_dataSUMCur16.ADWKMK = '1') then
                           v_ACCOUNTNO   := '1812122 11054 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := '催收款－職災－本人死亡給付（年金）';
                           v_OPPACCOUNTNO   := '1178122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_OPPACCOUNTNAME := '其他應收款－職災－本人死亡給付（年金）';    --add by 20130711 Angela
                       elsif  (v_dataSUMCur16.NLWKMK = '2' and v_dataSUMCur16.ADWKMK = '2') then
                           v_ACCOUNTNO   := '1812122 12054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := '催收款－加職－本人死亡給付（年金）';
                           v_OPPACCOUNTNO   := '1178122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_OPPACCOUNTNAME := '其他應收款－加職－本人死亡給付（年金）';    --add by 20130711 Angela
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_ACTTITLEAPCODE := 'FHG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur16.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_tmpAMT      := v_dataSUMCur16.UNACPAMT;
                       if (v_dataSUMCur16.NLWKMK = '1' or trim(v_dataSUMCur16.NLWKMK) is null) then
                           v_ACCOUNTNO   := '1178121 11054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_ACCOUNTNAME := '其他應收款－普通－本人死亡給付（年金）';
                       elsif  (v_dataSUMCur16.NLWKMK = '2' and v_dataSUMCur16.ADWKMK = '1') then
                           v_ACCOUNTNO   := '1178122 11054 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_ACCOUNTNAME := '其他應收款－職災－本人死亡給付（年金）';
                       elsif  (v_dataSUMCur16.NLWKMK = '2' and v_dataSUMCur16.ADWKMK = '2') then
                           v_ACCOUNTNO   := '1178122 12054 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_ACCOUNTNAME := '其他應收款－加職－本人死亡給付（年金）';
                       end if;
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;
                    --寫入轉催核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,PAYTYP
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,NACHGMK                       -- 2012/06/15 Mark By ChungYu 應收款立帳不區分普職互改
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUYM
                                                    ,CHKDATE
                                          ) values (  '16'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,''
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_dataSUMCur16.NACHGMK
                                                     ,v_dataSUMCur16.NLWKMK
                                                     ,v_dataSUMCur16.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_i_procYm
                                                     ,v_i_cprndt
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉催核定清單會計科目(遺屬)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉催核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_16_S End

 /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_17
        PURPOSE:         產生轉呆核定清單的會計科目

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_17_L (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        --轉呆核定清單(老年)
         Cursor c_dataCur_SUMrpt17 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                              --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '17'
               AND APNO LIKE (v_i_paycode||'%')
               AND CHKDATE = v_i_cprndt
               AND PAYDATE = v_i_deadyy
             GROUP BY ISSUTYP,  CPRNDATE, RPTTYP
             ORDER BY ISSUTYP,  CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_17_L';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉呆核定清單(老年)
            for v_dataSUMCur17 in c_dataCur_SUMrpt17 Loop
                v_g_genFlag := 1;

                --寫入轉呆核定清單資料
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,RPTNOTE
                                         ,PROCTIME
                                         ,ISSUYM
                                         ,CHKDATE
                                         ,PAYDATE
                                ) values (
                                          v_dataSUMCur17.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_i_paycode
                                         ,v_dataSUMCur17.ISSUTYP
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur17.APNOAMT
                                         ,v_dataSUMCur17.DATAAMT
                                         ,v_dataSUMCur17.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur17.UNACPAMT
                                         ,v_dataSUMCur17.UNACPAMT
                                         ,''  --備註
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                         ,v_i_deadyy
                                         ,v_i_cprndt
                                         ,v_i_deadyy
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(老年)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉呆核定清單(老年)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
                    v_g_flag := '1';
                    v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPaySUMRPT_17_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_17_L
        PURPOSE:         產生轉呆核定清單會計科目(老年)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_17_L (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --轉呆核定清單會計科目(老年)
        Cursor c_dataCur_SUMrpt17 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS UNACPAMT,           -- 應收金額
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT            -- 筆數    add by 20130711 Angela
              FROM BAPAYRPTSUM B
             WHERE RPTTYP = '17'
               AND PAYCODE = v_i_paycode
               --AND CPRNDATE = v_i_cprndt    --add by Angela 20130731
               AND ISSUYM = v_i_deadyy
               AND CHKDATE = v_i_cprndt
              -- AND PAYSEQNO = v_i_payseqno
             GROUP BY CPRNDATE
             ORDER BY CPRNDATE;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_17_L';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉呆核定清單會計科目(老年)
            for v_dataSUMCur17 in c_dataCur_SUMrpt17 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_ACCOUNTNO   := '1813121 1     1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11111 8)
                       v_ACCOUNTNAME := '備抵呆帳－催收款－勞給普-現';
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '1812121 11111 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_OPPACCOUNTNAME := '催收款－普通－老年給付（年金）';
                       v_ACTTITLEAPCODE := 'FJG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur17.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                    elsif i = 2 then
                       v_ACCOUNTNO   := '1812121 11111 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11111 2)
                       v_ACCOUNTNAME := '催收款－普通－老年給付（年金）';
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMT;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;

                    --寫入轉呆核定清單會計科目資料
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,PAYTYP
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUYM
                                                    ,CHKDATE
                                          ) values (
                                                     '17'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,''
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_i_deadyy
                                                     ,v_i_cprndt
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(老年)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(老年)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
           /* insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉呆核定清單會計科目(老年)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(老年)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/

        end;
    --Procedure sp_BA_genPayACCOUNTRPT_17_L End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_17_K
        PURPOSE:         產生轉呆核定清單(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_17_K (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        --轉呆核定清單(失能)
         Cursor c_dataCur_SUMrpt17 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                            --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '17'
               AND APNO LIKE (v_i_paycode||'%')
               AND PAYDATE = v_i_deadyy
               AND CHKDATE = v_i_cprndt
               AND NACHGMK IS NULL                                -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_17_K';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉呆核定清單(失能)
            for v_dataSUMCur17 in c_dataCur_SUMrpt17 Loop
                v_g_genFlag := 1;

                --寫入轉呆核定清單資料(失能)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                         ,ISSUYM
                                         ,CHKDATE
                                         ,PAYDATE
                                ) values (
                                          v_dataSUMCur17.RPTTYP
                                         ,v_i_cprndt
                                         ,''
                                         ,v_i_paycode
                                         ,v_dataSUMCur17.ISSUTYP
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur17.APNOAMT
                                         ,v_dataSUMCur17.DATAAMT
                                         ,v_dataSUMCur17.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur17.UNACPAMT
                                         ,v_dataSUMCur17.UNACPAMT
                                         ,''  --備註
                                         ,v_dataSUMCur17.NLWKMK
                                         ,v_dataSUMCur17.ADWKMK
                                         ,v_dataSUMCur17.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                         ,v_i_deadyy
                                         ,v_i_cprndt
                                         ,v_i_deadyy
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉呆核定清單(失能)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));;*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                   /* insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';*/
        end;
    --Procedure sp_BA_genPaySUMRPT_17_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_17_K
        PURPOSE:         產生轉呆核定清單會計科目(失能)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_17_K (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --轉呆核定清單(失能)
        Cursor c_dataCur_SUMrpt17 is
            SELECT NVL(SUM(DECODE(PAYKIND,'37',0,ISSUEAMT)), 0)   AS ISSUEAMTA,           -- 核定金額(失能年金)
                   NVL(SUM(DECODE(PAYKIND,'37',ISSUEAMT,0)), 0)   AS ISSUEAMTB,           -- 核定金額(失能補償金)
                   NVL(SUM(DECODE(PAYKIND,'37',0,UNACPAMT)), 0)   AS UNACPAMTA,           -- 應收金額(失能年金)
                   NVL(SUM(DECODE(PAYKIND,'37',UNACPAMT,0)), 0)   AS UNACPAMTB,           -- 應收金額(失能補償金)
                   NLWKMK,                                                                -- 普職註記
                   ADWKMK,                                                                -- 加職註記
                   NACHGMK,                                                               -- 普職互改註記
                   NVL(COUNT(*), 0)                               AS DATAAMT             -- 筆數    add by 20130711 Angela
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '17'
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_cprndt
               AND PAYDATE = v_i_deadyy
               AND NACHGMK IS NULL                                               -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY  NLWKMK, ADWKMK, NACHGMK
             ORDER BY  NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_17_K';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉呆核定清單會計科目(失能)
            for v_dataSUMCur17 in c_dataCur_SUMrpt17 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..4 LOOP
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMTA;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur17.NACHGMK) is null) then
                           if (v_dataSUMCur17.nlwkmk = '1' or trim(v_dataSUMCur17.nlwkmk) is null) then
                               v_ACCOUNTNO   := '1813121 1     1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                               v_ACCOUNTNAME := '備抵呆帳－催收款－勞給普－現';
                               v_OPPACCOUNTNO   := '1813121 1     1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                               v_OPPACCOUNTNAME := '催收款－普通－失能給付（年金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '1') then
                               v_ACCOUNTNO   := '1813121 1     5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                               v_ACCOUNTNAME := '備抵呆帳－催收款－勞給職－現';
                               v_OPPACCOUNTNO   := '1812122 11102 6';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_OPPACCOUNTNAME := '催收款－職災－失能給付（年金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '2') then
                               v_ACCOUNTNO   := '1813121 1     5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                               v_ACCOUNTNAME := '備抵呆帳－催收款－勞給職－現';
                               v_OPPACCOUNTNO   := '1812122 12102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_OPPACCOUNTNAME := '催收款－加職－失能給付（年金）';    --add by 20130711 Angela
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '';
                           v_ACTTITLEAPCODE := 'FJG';
                           v_DATACD         := '1';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '1';
                           v_CNT            := v_dataSUMCur17.DATAAMT;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                       --else
                           -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                           /*if (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '1') then
                                   v_ACCOUNTNO   := '113X121 11102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11102 7)
                                   v_ACCOUNTNAME := '其他應收款－普通－失能給付（年金）';
                           elsif  (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '2') then
                                   v_ACCOUNTNO   := '113X122 11102 A';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11102 A)
                                   v_ACCOUNTNAME := '其他應收款－職災－失能給付（年金）';
                           elsif  (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '3') then
                                   v_ACCOUNTNO   := '113X122 12102 1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12102 1)
                                   v_ACCOUNTNAME := '其他應收款－加職－失能給付（年金）';
                           end if;*/
                       --end if;
                    elsif i = 2 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMTB;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur16.NACHGMK) is null) then
                           if  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '1') then
                               v_ACCOUNTNO   := '1813121 1     5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                               v_ACCOUNTNAME := '備抵呆帳－催收款－勞給職－現';
                               v_OPPACCOUNTNO   := '1812122 11101 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                               v_OPPACCOUNTNAME := '催收款－職災－失能給付（補償金）';    --add by 20130711 Angela
                           elsif  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '2') then
                               v_ACCOUNTNO   := '1813121 1     5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                               v_ACCOUNTNAME := '備抵呆帳－催收款－勞給職－現';
                               v_OPPACCOUNTNO   := '1812122 12101 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                               v_OPPACCOUNTNAME := '催收款－加職－失能給付（補償金）';    --add by 20130711 Angela
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           v_ACCOUNTMEMO    := '';
                           v_ACTTITLEAPCODE := 'FJG';
                           v_DATACD         := '1';
                           v_DECIDEAMT      := v_tmpAMT;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '1';
                           v_CNT            := v_dataSUMCur17.DATAAMT;
                           v_ACCOUNTTOPFMK  := 'Y';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                          --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                          /* if ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '2' ) then
                                   v_ACCOUNTNO   := '113X122 11101 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11101 2)
                                   v_ACCOUNTNAME := '其他應收款－職災－失能給付（補償金）';
                           elsif (SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '3') then
                                   v_ACCOUNTNO   := '113X122 12101 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12101 3)
                                   v_ACCOUNTNAME := '其他應收款－加職－失能給付（補償金）';
                           end if;*/
                       --end if;
                    elsif i = 3 then
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMTA;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur16.NACHGMK) is null) then
                           if (v_dataSUMCur17.nlwkmk = '1' or trim(v_dataSUMCur17.nlwkmk) is null) then
                               v_ACCOUNTNO   := '1813121 1     1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                               v_ACCOUNTNAME := '催收款－普通－失能給付（年金）';
                           elsif  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '1') then
                               v_ACCOUNTNO   := '1812122 11102 6';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                               v_ACCOUNTNAME := '催收款－職災－失能給付（年金）';
                           elsif  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '2') then
                               v_ACCOUNTNO   := '1812122 12102 7';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                               v_ACCOUNTNAME := '催收款－加職－失能給付（年金）';
                           end if;

                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                           --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                           v_ACCOUNTMEMO    := '';
                           v_OPPACCOUNTNO   := '';
                           v_OPPACCOUNTNAME := '';
                           v_ACTTITLEAPCODE := '';
                           v_DATACD         := '';
                           v_DECIDEAMT      := 0;
                           v_CASHAMT        := 0;
                           v_CUTAMT         := 0;
                           v_ACCEPTPAYTYPE  := '';
                           v_CNT            := 0;
                           v_ACCOUNTTOPFMK  := 'N';
                           --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                           /*if ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '1' ) then
                                   v_ACCOUNTNO   := '5171121 11102 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11102 1)
                                   v_ACCOUNTNAME := '保險給付－普通－失能給付（年金）';
                           elsif ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '2' ) then
                                   v_ACCOUNTNO   := '5171122 11102 2';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11102 5)
                                   v_ACCOUNTNAME := '保險給付－職災－失能給付（年金）';
                           elsif ( SUBSTR(v_dataSUMCur16.NACHGMK,1,1) = '3' ) then
                                   v_ACCOUNTNO   := '5171122 12102 3';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12102 6)
                                   v_ACCOUNTNAME := '保險給付－加職－失能給付（年金）';
                           end if;    */
                      -- end if;
                    elsif i = 4 then
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMTB;
                       --2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
                       --if (trim(v_dataSUMCur7.NACHGMK) is null) then
                            if  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '1') then
                                v_ACCOUNTNO   := '1812122 11101 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                v_ACCOUNTNAME := '催收款－職災－失能給付（補償金）';
                            elsif  (v_dataSUMCur17.nlwkmk = '2' and v_dataSUMCur17.adwkmk = '2') then
                                v_ACCOUNTNO   := '1812122 12101 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                v_ACCOUNTNAME := '催收款－加職－失能給付（補償金）';
                            end if;
                            --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                            --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                            v_ACCOUNTMEMO    := '';
                            v_OPPACCOUNTNO   := '';
                            v_OPPACCOUNTNAME := '';
                            v_ACTTITLEAPCODE := '';
                            v_DATACD         := '';
                            v_DECIDEAMT      := 0;
                            v_CASHAMT        := 0;
                            v_CUTAMT         := 0;
                            v_ACCEPTPAYTYPE  := '';
                            v_CNT            := 0;
                            v_ACCOUNTTOPFMK  := 'N';
                            --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                       --else
                            /*if  (   SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '2') then
                                    v_ACCOUNTNO   := '5171122 11101 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11101 7)
                                    v_ACCOUNTNAME := '保險給付－職災－失能給付（補償金）';
                            elsif ( SUBSTR(v_dataSUMCur7.NACHGMK,1,1) = '3') then
                                    v_ACCOUNTNO   := '5171122 12101 5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12101 8)
                                    v_ACCOUNTNAME := '保險給付－加職－失能給付（補償金）';
                            end if;*/
                       --end if;
                    end if;

                    --寫入應收款立帳核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       v_count := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,PAYTYP
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,NACHGMK                       -- 2012/06/15 Mark By ChungYu 應收款立帳不區分普職互改
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUYM
                                                    ,CHKDATE
                                          ) values (  '17'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,''
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_dataSUMCur17.NACHGMK
                                                     ,v_dataSUMCur17.NLWKMK
                                                     ,v_dataSUMCur17.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_i_deadyy
                                                     ,v_i_cprndt
                           );
                    end if;

                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉呆核定清單(失能)會計科目資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
               v_o_flag := v_g_flag;*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(失能)會計科目資料處理完成-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_17_K End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_17_S
        PURPOSE:         產生轉呆核定清單(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua


        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_17_S (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        --轉呆核定清單(遺屬)
         Cursor c_dataCur_SUMrpt17 is
             SELECT COUNT(DISTINCT APNO) AS APNOAMT                          --件數
                   ,COUNT(*) AS DATAAMT                                      --筆數
                   ,NVL(SUM(ISSUEAMT),0) ISSUEAMT                            --核定金額
                   ,NVL(SUM(UNACPAMT),0) UNACPAMT                            --應收金額
                   ,ISSUTYP                                                  --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                             --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                             --(1~5；依照給付核定檔月核案件類別)
                   ,PAYTYP                                                   --給付方式
                   ,NLWKMK                                                   --普職註記
                   ,ADWKMK                                                   --加職註記
                   ,NACHGMK                                                  --普職互改註記
                   ,CPRNDATE                                                 --
                   ,RPTTYP                                                   --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
              FROM BAPAYRPTRECORD
             WHERE RPTTYP = '17'
               AND APNO LIKE (v_i_paycode||'%')
               AND PAYDATE = v_i_deadyy
               AND CHKDATE = v_i_cprndt
               AND NACHGMK IS NULL
               --AND CPRNDATE = v_i_cprndt                                -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY PAYTYP, ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP
             ORDER BY PAYTYP, ISSUTYP, NLWKMK, ADWKMK, NACHGMK, CPRNDATE, RPTTYP;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_17_S';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉呆核定清單資料(遺屬)
            for v_dataSUMCur17 in c_dataCur_SUMrpt17 Loop

                  v_g_genFlag := 1;

                --寫入轉呆清單資料(遺屬)
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,UNACPAMT
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,NACHGMK
                                         ,PROCTIME
                                         ,ISSUYM
                                         ,CHKDATE
                                         ,PAYDATE
                                ) values (
                                          v_dataSUMCur17.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur17.PAYTYP
                                         ,v_i_paycode
                                         ,v_dataSUMCur17.ISSUTYP
                                         ,''  --受益人與事故者關係
                                         ,v_dataSUMCur17.APNOAMT
                                         ,v_dataSUMCur17.DATAAMT
                                         ,v_dataSUMCur17.ISSUEAMT
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,0
                                         ,v_dataSUMCur17.UNACPAMT
                                         ,v_dataSUMCur17.UNACPAMT
                                         ,''  --備註
                                         ,v_dataSUMCur17.NLWKMK
                                         ,v_dataSUMCur17.ADWKMK
                                         ,v_dataSUMCur17.NACHGMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                         ,v_i_deadyy
                                         ,v_i_cprndt
                                         ,v_i_deadyy
                );
            end Loop;


            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉呆核定清單(遺屬)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /* insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
    --Procedure sp_BA_genPaySUMRPT_17_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_17_S
        PURPOSE:         產生轉呆核定清單會計科目(遺屬)

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_payseqno      (varChar2)       --欄位值：1為第一次出媒體
                                                                    ：2為第二次出媒體(僅出失能國並勞36案部份)
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id 2014/10/16 Add by Zehua
        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗 2014/10/16 Add by Zehua

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2012/03/15  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_17_S (
        v_i_paycode             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_deadyy              in      varChar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;

        --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
        v_ACCOUNTMEMO      BAPAYRPTACCOUNT.ACCOUNTMEMO%TYPE    := '';
        v_OPPACCOUNTNO     BAPAYRPTACCOUNT.OPPACCOUNTNO%TYPE   := '';
        v_OPPACCOUNTNAME   BAPAYRPTACCOUNT.OPPACCOUNTNAME%TYPE := '';
        v_ACTTITLEAPCODE   BAPAYRPTACCOUNT.ACTTITLEAPCODE%TYPE := '';
        v_DATACD           BAPAYRPTACCOUNT.DATACD%TYPE         := '';
        v_DECIDEAMT        BAPAYRPTACCOUNT.DECIDEAMT%TYPE      := 0;
        v_CASHAMT          BAPAYRPTACCOUNT.CASHAMT%TYPE        := 0;
        v_CUTAMT           BAPAYRPTACCOUNT.CUTAMT%TYPE         := '';
        v_ACCEPTPAYTYPE    BAPAYRPTACCOUNT.ACCEPTPAYTYPE%TYPE  := '';
        v_CNT              BAPAYRPTACCOUNT.CNT%TYPE            := 0;
        v_ACCOUNTTOPFMK    BAPAYRPTACCOUNT.ACCOUNTTOPFMK%TYPE  := 'N';
        --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

        --轉呆核定清單(遺屬)
        Cursor c_dataCur_SUMrpt17 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,            -- 核定金額
                   NVL(SUM(PAYAMT), 0)     AS UNACPAMT,            -- 應收金額
                   NLWKMK,                                         -- 普職註記
                   ADWKMK,                                         -- 加職註記
                   NACHGMK,                                        -- 普職互改註記
                   NVL(SUM(DATAAMT), 0)    AS DATAAMT             -- 筆數    add by 20130711 Angela
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '17'
               AND PAYCODE = v_i_paycode
               AND ISSUYM = v_i_deadyy
               AND CHKDATE = v_i_cprndt
               AND NACHGMK IS NULL                          -- 2012/08/08 給付處詹小姐提出，普職互改不出(因為已經在撥付總表呈現過)
             GROUP BY  NLWKMK, ADWKMK, NACHGMK
             ORDER BY  NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_17_S';
            v_count     := 0;
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --轉呆核定清單會計科目(遺屬)
            for v_dataSUMCur17 in c_dataCur_SUMrpt17 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                  v_ACCOUNTMEMO    := '';
                  v_OPPACCOUNTNO   := '';
                  v_OPPACCOUNTNAME := '';
                  v_ACTTITLEAPCODE := '';
                  v_DATACD         := '';
                  v_DECIDEAMT      := 0;
                  v_CASHAMT        := 0;
                  v_CUTAMT         := 0;
                  v_ACCEPTPAYTYPE  := '';
                  v_CNT            := 0;
                  v_ACCOUNTTOPFMK  := 'N';
                  --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->

                for i in 1..2 LOOP
                    v_count       := v_count + 1;
                    v_ACCOUNTSEQ  := 1;
                    if i = 1 then
                       v_ACCOUNTSEQ  := 0;
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMT;

                       if (v_dataSUMCur17.NLWKMK = '1' or trim(v_dataSUMCur17.NLWKMK) is null) then
                           v_ACCOUNTNO   := '1813121 1     1';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178121 11054 9)
                           v_ACCOUNTNAME := '備抵呆帳－催收款－勞給普－現';
                           v_OPPACCOUNTNO   := '1812121 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_OPPACCOUNTNAME := '催收款－普通－本人死亡給付（年金）';    --add by 20130711 Angela
                       elsif  (v_dataSUMCur17.NLWKMK = '2' and v_dataSUMCur17.ADWKMK = '1') then
                           v_ACCOUNTNO   := '1813121 1     5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 11054 2)
                           v_ACCOUNTNAME := '備抵呆帳－催收款－勞給職－現';
                           v_OPPACCOUNTNO   := '1812122 11054 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_OPPACCOUNTNAME := '催收款－職災－本人死亡給付（年金）';    --add by 20130711 Angela
                       elsif  (v_dataSUMCur17.NLWKMK = '2' and v_dataSUMCur17.ADWKMK = '2') then
                           v_ACCOUNTNO   := '1813121 1     5';  --Modify by Angela 20141225 配合104年會計科目轉換(原：1178122 12054 3)
                           v_ACCOUNTNAME := '備抵呆帳－催收款－勞給職－現';
                           v_OPPACCOUNTNO   := '1812122 12054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_OPPACCOUNTNAME := '催收款－加職－本人死亡給付（年金）';    --add by 20130711 Angela
                       end if;

                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       v_ACCOUNTMEMO    := '';
                       v_ACTTITLEAPCODE := 'FJG';
                       v_DATACD         := '1';
                       v_DECIDEAMT      := v_tmpAMT;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '1';
                       v_CNT            := v_dataSUMCur17.DATAAMT;
                       v_ACCOUNTTOPFMK  := 'Y';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    elsif i = 2 then
                       v_tmpAMT      := v_dataSUMCur17.UNACPAMT;
                       if (v_dataSUMCur17.NLWKMK = '1' or trim(v_dataSUMCur17.NLWKMK) is null) then
                           v_ACCOUNTNO   := '1812121 11054 4';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509121 11054 3)
                           v_ACCOUNTNAME := '催收款－普通－本人死亡給付（年金）';
                       elsif  (v_dataSUMCur17.NLWKMK = '2' and v_dataSUMCur17.ADWKMK = '1') then
                           v_ACCOUNTNO   := '1812122 11054 8';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 11054 7)
                           v_ACCOUNTNAME := '催收款－職災－本人死亡給付（年金）';
                       elsif  (v_dataSUMCur17.NLWKMK = '2' and v_dataSUMCur17.ADWKMK = '2') then
                           v_ACCOUNTNO   := '1812122 12054 9';  --Modify by Angela 20141225 配合104年會計科目轉換(原：5509122 12054 8)
                           v_ACCOUNTNAME := '催收款－加職－本人死亡給付（年金）';
                       end if;
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                       --回寫PFM&PFD的資訊已在另一方表示，故不回寫(將回寫資訊清空)
                       v_ACCOUNTMEMO    := '';
                       v_OPPACCOUNTNO   := '';
                       v_OPPACCOUNTNAME := '';
                       v_ACTTITLEAPCODE := '';
                       v_DATACD         := '';
                       v_DECIDEAMT      := 0;
                       v_CASHAMT        := 0;
                       v_CUTAMT         := 0;
                       v_ACCEPTPAYTYPE  := '';
                       v_CNT            := 0;
                       v_ACCOUNTTOPFMK  := 'N';
                       --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                    end if;
                    --寫入轉呆核定清單會計科目資料(借：保險給付，貸：銀行存款)
                    if v_tmpAMT > 0 then
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,PAYTYP
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,NACHGMK                       -- 2012/06/15 Mark By ChungYu 應收款立帳不區分普職互改
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,PROCTIME
                                                    ,ACCOUNTMEMO       --add by Angela 20130711
                                                    ,OPPACCOUNTNO      --add by Angela 20130711
                                                    ,OPPACCOUNTNAME    --add by Angela 20130711
                                                    ,ACTTITLEAPCODE    --add by Angela 20130711
                                                    ,DATACD            --add by Angela 20130711
                                                    ,DECIDEAMT         --add by Angela 20130711
                                                    ,CASHAMT           --add by Angela 20130711
                                                    ,CUTAMT            --add by Angela 20130711
                                                    ,ACCEPTPAYTYPE     --add by Angela 20130711
                                                    ,CNT               --add by Angela 20130711
                                                    ,ACCOUNTTOPFMK     --add by Angela 20130731
                                                    ,ISSUYM
                                                    ,CHKDATE
                                          ) values (  '17'
                                                     ,v_i_cprndt
                                                     ,v_i_paycode
                                                     ,''
                                                     ,''
                                                     ,v_ACCOUNTSEQ
                                                     ,v_count
                                                     ,v_ACCOUNTNO
                                                     ,v_ACCOUNTNAME
                                                     ,v_tmpAMT
                                                     ,v_dataSUMCur17.NACHGMK
                                                     ,v_dataSUMCur17.NLWKMK
                                                     ,v_dataSUMCur17.ADWKMK
                                                     ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                                                     ,v_ACCOUNTMEMO       --add by Angela 20130711
                                                     ,v_OPPACCOUNTNO      --add by Angela 20130711
                                                     ,v_OPPACCOUNTNAME    --add by Angela 20130711
                                                     ,v_ACTTITLEAPCODE    --add by Angela 20130711
                                                     ,v_DATACD            --add by Angela 20130711
                                                     ,v_DECIDEAMT         --add by Angela 20130711
                                                     ,v_CASHAMT           --add by Angela 20130711
                                                     ,v_CUTAMT            --add by Angela 20130711
                                                     ,v_ACCEPTPAYTYPE     --add by Angela 20130711
                                                     ,v_CNT               --add by Angela 20130711
                                                     ,v_ACCOUNTTOPFMK     --add by Angela 20130731
                                                     ,v_i_deadyy
                                                     ,v_i_cprndt
                           );
                    end if;
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 Start-->
                    v_ACCOUNTMEMO    := '';
                    v_OPPACCOUNTNO   := '';
                    v_OPPACCOUNTNAME := '';
                    v_ACTTITLEAPCODE := '';
                    v_DATACD         := '';
                    v_DECIDEAMT      := 0;
                    v_CASHAMT        := 0;
                    v_CUTAMT         := 0;
                    v_ACCEPTPAYTYPE  := '';
                    v_CNT            := 0;
                    v_ACCOUNTTOPFMK  := 'N';
                    --add by Angela 20130711 回寫PFM&PFD時所需資訊 End-->
                end Loop;
            end Loop;
            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(遺屬)-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(遺屬)-['||v_i_paycode||']-NoData');
            end if;
            --LOG BATCHJOB detail Add By Zehua 20140722
            /*insert into BABATCHJOBDTL
              (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
            values
              (BAJOBDTLID.Nextval,
               v_i_bajobid,
               '0',
               '轉呆核定清單會計科目(遺屬)資料處理完成',
               replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));*/
               v_o_flag := v_g_genFlag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg);
                    --LOG BATCHJOB detail Add By Zehua 20140722
                    /*insert into BABATCHJOBDTL
                      (BAJOBDTLID, BAJOBID, FLAG, FLAGMSG, FLAGTIME)
                    values
                      (BAJOBDTLID.Nextval,
                       v_i_bajobid,
                       '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>轉呆核定清單會計科目(遺屬)-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp,'yyyyMMddHH24missxff'), '.', ''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;*/
        end;
        --Procedure sp_BA_genPayACCOUNTRPT_17_S End

   /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_19_S
        PURPOSE:         產生保留遺屬年金計息存儲核定清單

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2017/09/11  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPaySUMRPT_19_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_payamt   BAPAYRPTSUM.PAYAMT%TYPE      := 0;                      -- 應付金額

        --保留遺屬年金計息存儲核定清單
        Cursor c_dataCur_SUMrpt1 is
            SELECT
                   COUNT(DISTINCT T.APNO) AS APNOAMT,                           --件數
                   COUNT(*) AS DATAAMT,                                         --筆數
                   NVL(SUM(T.ISSUEAMT), 0)  AS ISSUEAMT,                        --核定金額(A)
                   0                        AS OTHERAAMT,                       --另案扣減同保險(B)
                   0                        AS OTHERBAMT,                       --另案扣減他保險(C)
                   0                        AS MITRATE,                         --匯費(D)
                   0                        AS OFFSETAMT,                       --抵銷紓困(E)
                   0                        AS COMPENAMT,                       --代扣補償金(F)                        (失能無代扣補償金)
                   NVL(SUM(T.INHERITORAMT), 0) AS INHERITORAMT,                 --保留遺屬津貼(G)
                   0                        AS ITRTTAX,                         --代扣利息所得稅(H)
                   0                        AS OTHERAMT,                        --其他(I)
                   T.ISSUTYP,                                                   --核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                                --0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                                                                                --(1~5；依照給付核定檔月核案件類別)
                   T.PAYTYP,                                                    --給付方式
                   T.CHKDATE,                                                   --(月)核定日期/應收立帳日期
                   T.NLWKMK,                                                    --普職註記
                   T.ADWKMK,                                                    --加職註記
                   T.NACHGMK,                                                   --普職互改註記
                   T.CPRNDATE,                                                  --
                   T.RPTTYP,                                                    --清冊別 1-月核定撥付總表、5-(退匯核定清單)、6-(改匯核定清單)、7-(應收款立帳核定清單)、8-(應收已收核定清單)
                   T.PAYSEQNO                                                   --1為第一次出媒體，2為第二次出媒體(僅出失能國並勞36案部份)
              FROM BAPAYRPTRECORD T
             WHERE T.RPTTYP = '19'
               AND T.ISSUYM = v_i_issuym
               AND T.APNO LIKE (v_i_paycode||'%')
               AND T.CHKDATE = v_i_chkdate
               AND T.CPRNDATE = v_i_cprndt
               AND T.PAYTYP IS Not Null
             GROUP BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, NACHGMK, RPTTYP, PAYSEQNO
             ORDER BY PAYTYP, ISSUTYP, CHKDATE, CPRNDATE, NLWKMK, ADWKMK, NACHGMK, RPTTYP, PAYSEQNO;

       begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPaySUMRPT_19_S';
            v_g_genFlag := 0;
            v_g_flag    := '0';
            --保留遺屬年金計息存儲核定清單
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop

                  v_payamt := v_dataSUMCur1.ISSUEAMT;         --  核定金額(A)

                  v_g_genFlag := 1;

                --寫入保留遺屬年金計息存儲核定清單
                insert into BAPAYRPTSUM ( RPTTYP
                                         ,CPRNDATE
                                         ,PAYTYP
                                         ,CHKDATE
                                         ,PAYCODE
                                         ,ISSUTYP
                                         ,ISSUYM
                                         ,BENEVTREL
                                         ,APNOAMT
                                         ,DATAAMT
                                         ,ISSUEAMT
                                         ,OTHERAAMT
                                         ,OTHERBAMT
                                         ,MITRATE
                                         ,OFFSETAMT
                                         ,COMPENAMT
                                         ,INHERITORAMT
                                         ,ITRTTAX
                                         ,OTHERAMT
                                         ,PAYAMT
                                         ,PAYSEQNO
                                         ,RPTNOTE
                                         ,NLWKMK
                                         ,ADWKMK
                                         ,PROCTIME
                                ) values (
                                          v_dataSUMCur1.RPTTYP
                                         ,v_i_cprndt
                                         ,v_dataSUMCur1.PAYTYP
                                         ,v_dataSUMCur1.CHKDATE
                                         ,v_i_paycode
                                         ,v_dataSUMCur1.ISSUTYP
                                         ,v_i_issuym
                                         ,''
                                         ,v_dataSUMCur1.APNOAMT
                                         ,v_dataSUMCur1.DATAAMT
                                         ,v_dataSUMCur1.ISSUEAMT
                                         ,v_dataSUMCur1.OTHERAAMT
                                         ,v_dataSUMCur1.OTHERBAMT
                                         ,v_dataSUMCur1.MITRATE
                                         ,v_dataSUMCur1.OFFSETAMT
                                         ,v_dataSUMCur1.COMPENAMT
                                         ,v_dataSUMCur1.INHERITORAMT
                                         ,v_dataSUMCur1.ITRTTAX
                                         ,v_dataSUMCur1.OTHERAMT
                                         ,v_payamt
                                         ,'1'
                                         ,''   --備註
                                         ,v_dataSUMCur1.NLWKMK
                                         ,v_dataSUMCur1.ADWKMK
                                         ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                );
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單-['||v_i_paycode||']-NoData');
            end if;

            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,  '0',
               '保留遺屬年金計息存儲核定清單資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
            v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                      sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));

                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genSUMPayRPT_19_S End

    /********************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_19_S
        PURPOSE:         產生保留遺屬年金計息存儲核定清單會計科目

        PARAMETER(IN):  *v_i_issuym        (varChar2)       --核定年月
                        *v_i_paycode       (varChar2)       --給付別
                        *v_i_chkdate       (varChar2)       --核定日期
                        *v_i_cprndt        (varChar2)       --列印日期(清單印表日期)
                        *v_i_bajobid       (varChar2)       --線上批次id

        PARAMETER(OUT):
                        *v_o_flag          (varChar2)       --傳出值 0:成功；1:失敗

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver   Date        Author       Description
        ----  ----------  -----------  ----------------------------------------------
        1.0   2017/09/11  ChungYu Lin  Created this procedure.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/

    Procedure sp_BA_genPayACCOUNTRPT_19_S (
        v_i_issuym              in      varChar2,
        v_i_paycode             in      varChar2,
        v_i_chkdate             in      varChar2,
        v_i_cprndt              in      varChar2,
        v_i_bajobid             in      varchar2,
        v_o_flag                out     varchar2
    ) is

        v_count            NUMBER          := 0;                         -- 筆數
        v_ACCOUNTNO        BAPAYRPTACCOUNT.ACCOUNTNO%TYPE      := '';
        v_ACCOUNTNAME      BAPAYRPTACCOUNT.ACCOUNTNAME%TYPE    := '';
        v_ACCOUNTSEQ       BAPAYRPTACCOUNT.ACCOUNTSEQ%TYPE     := null;
        v_tmpAMT           BAPAYRPTACCOUNT.PAYAMT%TYPE         := 0;


        --保留遺屬年金計息存儲核定清單(遺屬)
        Cursor c_dataCur_SUMrpt1 is
            SELECT NVL(SUM(ISSUEAMT), 0)   AS ISSUEAMT,           -- 核定金額(遺屬年金)
                   0                       AS PAYAMT,             -- 應付金額
                   0                       AS OTHERBAMT,          -- 另案扣減他保險
                   0                       AS OFFSETAMT,          -- 抵銷紓困
                   0                       AS MITRATE,            -- 匯款匯費
                   NVL(SUM(INHERITORAMT), 0) AS INHERITORAMT,     -- 計息存儲金額
                   PAYTYP,                                        -- 給付方式
                   ISSUTYP,                                       -- 核付分類1-新案、2-續發案、3-不給付案、4-結案(死亡)、5-補發案
                                                                  -- 0-應收未收、A-改匯、B-退匯、C-止付、D-退匯收回、E-退回現金收回、F-給付收回
                   NLWKMK,                                        -- 普職註記
                   ADWKMK,                                        -- 加職註記
                   NACHGMK                                        -- 普職互改註記
              FROM BAPAYRPTSUM
             WHERE RPTTYP = '19'
               AND ISSUYM = v_i_issuym
               AND PAYCODE = v_i_paycode
               AND CHKDATE = v_i_chkdate
               AND CPRNDATE = v_i_cprndt
               AND NACHGMK is null
               AND PAYTYP Is Not null
             GROUP BY PAYTYP, ISSUTYP, NLWKMK, ADWKMK, NACHGMK
             ORDER BY PAYTYP, ISSUTYP, NLWKMK, ADWKMK, NACHGMK;

        begin
            v_g_ProgName := 'PKG_BA_genPayRPTSUMAccount.sp_BA_genPayACCOUNTRPT_19_S';
            v_count      := 0;
            v_g_genFlag  := 0;
            v_g_flag     := '0';
            --月核定撥付總表資料(遺屬)
            for v_dataSUMCur1 in c_dataCur_SUMrpt1 Loop
                  v_count     := 0;
                  v_g_genFlag := 1;
                  v_ACCOUNTSEQ  := null;
                  v_ACCOUNTNO   := '';
                  v_ACCOUNTNAME := '';

                for i in 1..2 LOOP
                    if i = 1 then
                        v_ACCOUNTSEQ  := 0;
                        v_tmpAMT      := v_dataSUMCur1.ISSUEAMT;
                        v_ACCOUNTNO   := '111212  00531  8';
                        v_ACCOUNTNAME := '銀行存款－土地銀行台北分行13986-2帳戶（保留遺屬津貼年金）';
                    elsif i = 2 then
                        v_ACCOUNTSEQ     := 1;
                        v_ACCOUNTNO   := '2362121‧17‧6';
                        v_ACCOUNTNAME := '應付保管款－信託負債（年金）';
                        v_tmpAMT      := v_dataSUMCur1.INHERITORAMT;
                    end if;

                    --寫入月核定撥付總表會計科目資料(借：保險給付，貸：銀行存款)(遺屬)
                    if v_tmpAMT > 0 then
                       v_count       := v_count + 1;
                       insert into BAPAYRPTACCOUNT(  RPTTYP
                                                    ,CPRNDATE
                                                    ,PAYCODE
                                                    ,ISSUYM
                                                    ,PAYTYP
                                                    ,CHKDATE
                                                    ,BENEVTREL
                                                    ,ACCOUNTSEQ
                                                    ,SEQNO
                                                    ,ACCOUNTNO
                                                    ,ACCOUNTNAME
                                                    ,PAYAMT
                                                    ,PAYSEQNO
                                                    ,ISSUTYP
                                                    ,NLWKMK
                                                    ,ADWKMK
                                                    ,NACHGMK
                                                    ,PROCTIME
                                          ) values (
                                                    '19'
                                                    ,v_i_cprndt
                                                    ,v_i_paycode
                                                    ,v_i_issuym
                                                    ,v_dataSUMCur1.PAYTYP
                                                    ,v_i_chkdate
                                                    ,''
                                                    ,v_ACCOUNTSEQ
                                                    ,v_count
                                                    ,v_ACCOUNTNO
                                                    ,v_ACCOUNTNAME
                                                    ,v_tmpAMT
                                                    ,'1'
                                                    ,v_dataSUMCur1.ISSUTYP
                                                    ,v_dataSUMCur1.NLWKMK
                                                    ,v_dataSUMCur1.ADWKMK
                                                    ,''
                                                    ,to_Char(Sysdate,'YYYYMMDDHH24MISS')
                           );
                    end if;
                end Loop;
            end Loop;

            if v_g_genFlag>0 then
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單會計科目-['||v_i_paycode||']');
            else
                dbms_output.put_line(RPAD(v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單會計科目-['||v_i_paycode||']-NoData');
            end if;
            --修改log作法 by TseHua 20180419
            sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid, '0',
              '保留遺屬年金計息存儲核定清單會計科目資料處理完成',replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
             v_o_flag := v_g_flag;
        exception
            when others
                then
                    v_g_errMsg := SQLErrm;
                    dbms_output.put_line(RPAD('**Err:'||v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單會計科目-['||v_i_paycode||']:'||v_g_errMsg);
                    --修改log作法 by TseHua 20180419
                    sp_ba_recbatchjobdtl(BAJOBDTLID.NEXTVAL, v_i_bajobid,'1',
                       RPAD('**Err:'||v_g_ProgName,85,'-')||'>>保留遺屬年金計息存儲核定清單會計科目-['||v_i_paycode||']:'||v_g_errMsg,
                       replace(to_char(systimestamp, 'yyyyMMddHH24missxff'),'.',''));
                       v_g_flag := '1';
                       v_o_flag := v_g_flag;
        end;
    --Procedure sp_BA_genPayACCOUNTRPT_19_S End


    -- function fn_BA_transIssuTypSTR
    /******************************************************************************
        PROJECT:         BLI-BaWeb 勞保年金給付系統
        NAME:            fn_BA_transCaseTypSTR
        PURPOSE:         核付分類代碼轉中文字串

        PARAMETER(IN):  *v_IssuTyp         (varChar2)       --欲核付分類代碼

        PARAMETER(OUT):  v_return          (varChar2)       --已轉換之日期

        USAGE:
        I/O   (Type)Object Name
        ----  -----------------------------------------------------------------------

        REVISIONS:
        Ver        Date        Author           Description
        ---------  ----------  ---------------  -------------------------------------
        1.0        2012/03/21  ChungYu Lin      Created this function.

        NOTES:
        1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

    ********************************************************************************/
     function fn_BA_transIssuTypSTR
     (
         v_IssuTyp      in     varChar2
     ) return varchar2

       as
          v_tmpStr       varChar2(15);

       begin

         v_tmpStr := '';
         if trim(v_IssuTyp) is Not Null then
            case trim(v_IssuTyp)
                 when '1' then v_tmpStr := '新案';
                 when '2' then v_tmpStr := '續發案';
                 when '3' then v_tmpStr := '不給付案';
                 when '4' then v_tmpStr := '結案';
                 when '5' then v_tmpStr := '補發案';
                 when '6' then v_tmpStr := '暫緩給付案';
                 when 'A' then v_tmpStr := '改匯';
                 when 'B' then v_tmpStr := '退匯';
                 when 'C' then v_tmpStr := '止付';
                 when 'D' then v_tmpStr := '退匯收回';
                 when 'E' then v_tmpStr := '退回現金收回';
                 when 'F' then v_tmpStr := '給付收回';
            end case;

         end if;

       return v_tmpStr;

     end;
     -- function fn_BA_transIssuTypSTR

    -- function fn_BA_transNAChgTypSTR
/******************************************************************************
    PROJECT:         BLI-BaWeb 勞保年金給付系統
    NAME:            fn_BA_transNAChgTypSTR
    PURPOSE:         普職互改註記代碼轉中文字串

    PARAMETER(IN):  *v_IssuTyp         (varChar2)       --欲核付分類代碼

    PARAMETER(OUT):  v_return          (varChar2)       --已轉換之日期

    USAGE:
    I/O   (Type)Object Name
    ----  -----------------------------------------------------------------------

    REVISIONS:
    Ver        Date        Author           Description
    ---------  ----------  ---------------  -------------------------------------
    1.0        2012/03/21  ChungYu Lin      Created this function.

    NOTES:
    1.於上方的PARAMETER(IN)中,打"*"者為必傳入之參數值。

********************************************************************************/
     function fn_BA_transNAChgTypSTR
     (
         v_NAChgTyp      in     varChar2
     ) return varchar2

       as
          v_tmpStr       varChar2(15);

       begin

         v_tmpStr := '';
         if trim(v_NAChgTyp) is Not Null then
            case trim(v_NAChgTyp)
                 when '12' then v_tmpStr := '普改職';
                 when '13' then v_tmpStr := '普改加職';
                 when '21' then v_tmpStr := '職改普';
                 when '23' then v_tmpStr := '職改加職';
                 when '31' then v_tmpStr := '加職改普';
                 when '32' then v_tmpStr := '加職改職';
            end case;
         end if;

       return v_tmpStr;

     end;
     -- function fn_BA_transNAChgTypSTR

End;
/

